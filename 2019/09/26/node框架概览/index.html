<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><title>浅析node | blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="YP's Blog"><meta name="description" content="导言Koa2和Koa1的区别，和express的区别？异步流程控制Express 采用 callback 来处理异步，Koa v1 采用 generator，Koa v2 采用 async/await。generator 和 async/await 使用同步的写法来处理异步，明显好于 callback 和 promise，async/await 在语义化上又要比 generator 更强。错误处理"><meta name="keywords" content="web"><meta property="og:type" content="article"><meta property="og:title" content="浅析node"><meta property="og:url" content="http://localhost:4000/2019/09/26/node框架概览/index.html"><meta property="og:site_name" content="blog"><meta property="og:description" content="导言Koa2和Koa1的区别，和express的区别？异步流程控制Express 采用 callback 来处理异步，Koa v1 采用 generator，Koa v2 采用 async/await。generator 和 async/await 使用同步的写法来处理异步，明显好于 callback 和 promise，async/await 在语义化上又要比 generator 更强。错误处理"><meta property="og:locale" content="default"><meta property="og:image" content="https://i.loli.net/2019/09/26/ZH2TNdJCfyxn9LW.png"><meta property="og:updated_time" content="2020-07-06T06:21:54.627Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="浅析node"><meta name="twitter:description" content="导言Koa2和Koa1的区别，和express的区别？异步流程控制Express 采用 callback 来处理异步，Koa v1 采用 generator，Koa v2 采用 async/await。generator 和 async/await 使用同步的写法来处理异步，明显好于 callback 和 promise，async/await 在语义化上又要比 generator 更强。错误处理"><meta name="twitter:image" content="https://i.loli.net/2019/09/26/ZH2TNdJCfyxn9LW.png"><link rel="icon" href="/favicon.ico"><link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"><script src="/js/pace.min.js"></script></head></html><body><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">YP&#39;s Blog</span></a><nav id="header-menu-nav" class="right"><a href="/"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/archives"><i class="fa fa-archive"></i> <span>全部</span> </a><a href="/categories/AI/"><i class="fa fa-AI"></i> <span>AI</span> </a><a href="/categories/前端/"><i class="fa fa-前端"></i> <span>前端</span> </a><a href="/categories/计算机/"><i class="fa fa-计算机"></i> <span>计算机</span> </a><a href="/categories/语言/"><i class="fa fa-语言"></i> <span>语言</span> </a><a href="/categories/专题/"><i class="fa fa-专题"></i> <span>专题</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>YP&#39;s Blog</h2></div><div id="header-description"><h3>一个专注前端智能化开发的技术博客</h3></div></div><nav class="header-nav"><div class="social"><a title="Blog" target="_blank" href="https://iloveyou11.github.io/"><i class="fa fa-home fa-2x"></i></a> <a title="Github" target="_blank" href="https://github.com/iloveyou11"><i class="fa fa-github fa-2x"></i></a></div></nav></div></div></header><div class="outer"><section id="main" class="body-wrap"><article id="post-node框架概览" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">浅析node</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/前端/">前端</a></li><li><i class="fa fa-calendar"></i> 2019-09-26</li><li><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span></li></ul></div><div style="margin-top:10px"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i> <span class="post-meta-item-text">字数统计: </span><span class="post-count">2.5k字</span> </span></span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i> <span class="post-meta-item-text">阅读时长: </span><span class="post-count">11分</span></span></span></div></header><div class="article-entry post-content" itemprop="articleBody"><div id="toc"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#导言"><span class="toc-text">导言</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#koa"><span class="toc-text">koa</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#快速搭建项目"><span class="toc-text">快速搭建项目</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#koa洋葱模型"><span class="toc-text">koa洋葱模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#koa常用中间件"><span class="toc-text">koa常用中间件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#request和req的区别"><span class="toc-text">request和req的区别</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#koa项目的webpack配置"><span class="toc-text">koa项目的webpack配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#调试webpack"><span class="toc-text">调试webpack</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vscode调试"><span class="toc-text">vscode调试</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#如何更新npm包"><span class="toc-text">如何更新npm包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#整合中间件"><span class="toc-text">整合中间件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#webpack-config分离与合并"><span class="toc-text">webpack config分离与合并</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#项目可优化部分"><span class="toc-text">项目可优化部分</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NodeMailer邮件服务"><span class="toc-text">NodeMailer邮件服务</span></a></li></ol></div><a id="more"></a><h4 id="导言"><a href="#导言" class="headerlink" title="导言"></a>导言</h4><p>Koa2和Koa1的区别，和express的区别？</p><ol><li>异步流程控制<br>Express 采用 callback 来处理异步，Koa v1 采用 generator，Koa v2 采用 async/await。<br>generator 和 async/await 使用同步的写法来处理异步，明显好于 callback 和 promise，async/await 在语义化上又要比 generator 更强。</li><li>错误处理<br>Express 使用 callback 捕获异常，对于深层次的异常捕获不了，Koa 使用 try catch，能更好地解决异常捕获。</li></ol><h4 id="koa"><a href="#koa" class="headerlink" title="koa"></a>koa</h4><h5 id="快速搭建项目"><a href="#快速搭建项目" class="headerlink" title="快速搭建项目"></a>快速搭建项目</h5><p>首先需要安装koa，新建js文件即可运行web服务：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Koa = require(&apos;koa&apos;);</span><br><span class="line">const app = new Koa();</span><br><span class="line"></span><br><span class="line">app.use(async ctx =&gt; &#123;</span><br><span class="line">  ctx.body = &apos;Hello World&apos;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(3000);</span><br></pre></td></tr></table></figure><p>或者可以直接使用koa提供的脚手架创建项目。</p><h5 id="koa洋葱模型"><a href="#koa洋葱模型" class="headerlink" title="koa洋葱模型"></a>koa洋葱模型</h5><p>经典的洋葱模型图：<br><img src="https://i.loli.net/2019/09/26/ZH2TNdJCfyxn9LW.png" alt="洋葱模型.png"></p><ol><li>一个请求到一旦到后端，就开始接触洋葱的最外层。</li><li>遇到一个next()，就进入下一层。不过值得提醒的是，异步函数的next(),与同步函数的next(),不是在同一个空间的，我们可以假想一个“异步空间栈”，后入先出。</li><li>什么时候到洋葱中心？就是遇到的第一个没有next的中间件,或者遇到一个中间件报错，就会把这个中间件当成中心，因为遇到错误了，不会再继续往里面走。这个时候，就开始向洋葱的外层开始走了。如果第一个中间件就没有next，直接返回的。那么就不存在洋葱模型。</li><li>一层一层外面走的时候，就先走位所有的同步中间件，再依次走“异步空间栈”的中间件。<h5 id="koa常用中间件"><a href="#koa常用中间件" class="headerlink" title="koa常用中间件"></a>koa常用中间件</h5></li></ol><p>【koa-views】<br>koa-views对需要进行视图模板渲染的应用是个不可缺少的中间件，支持ejs, nunjucks等众多模板引擎。</p><p>【koa-json】<br>JSON pretty-printed response middleware</p><p>【koa-router】<br>koa-router提供了全面的路由功能，比如类似Express的app.get/post/put的写法，URL命名参数、路由命名、支持加载多个中间件、嵌套路由等</p><p>【koa-bodyparser】<br>POST数据处理,koa.js并没有内置Request Body的解析器，当我们需要解析请求体时需要加载额外的中间件，官方提供的koa-bodyparser是个很不错的选择<br>支持x-www-form-urlencoded, application/json等格式的请求体，但不支持form-data的请求体，需要借助 formidable 这个库<br>也可以直接使用 koa-body 或 koa-better-body,import koaBody from ‘koa-body’;</p><p>【koa-session】<br>HTTP是无状态协议，为了保持用户状态，我们一般使用Session会话，koa-session提供了这样的功能，既支持将会话信息存储在本地Cookie，也支持存储在如Redis, MongoDB这样的外部存储设备。</p><p>【koa-jwt】<br>随着网站前后端分离方案的流行，越来越多的网站从Session Base转为使用Token Base，JWT(Json Web Tokens)作为一个开放的标准被很多网站采用，koa-jwt这个中间件使用JWT认证HTTP请求。</p><p>【@koa/cors】<br>解决跨域问题</p><p>【koa-helmet】<br>网络安全得到越来越多的重视，helmet 通过增加如Strict-Transport-Security, X-Frame-Options, X-Frame-Options等HTTP头提高Express应用程序的安全性，koa-helmet为koa程序提供了类似的功能，参考Node.js安全清单。</p><p>【koa-static】<br>Node.js除了处理动态请求，也可以用作类似Nginx的静态文件服务，在本地开发时特别方便<br>可用于加载前端文件或后端Fake数据，可结合 koa-compress 和 koa-mount 使用。</p><p>【koa-compose】<br>合并中间件，简化app.use的写法</p><p>【koa-compress】<br>当响应体比较大时，我们一般会启用类似Gzip的压缩技术减少传输内容，koa-compress提供了这样的功能，可根据需要进行灵活的配置。</p><p>【koa-logger】<br>koa-logger提供了输出请求日志的功能，包括请求的url、状态码、响应时间、响应体大小等信息，对于调试和跟踪应用程序特别有帮助，koa-bunyan-logger 提供了更丰富的功能。</p><p>【koa-onerror】<br>捕获错误<br>const onerror=require(‘koa-onerror’)<br>onerror(app)</p><p>还有很多，可根据项目需求自行探索……</p><h5 id="request和req的区别"><a href="#request和req的区别" class="headerlink" title="request和req的区别"></a>request和req的区别</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctx.req——Node 的 request 对象.</span><br><span class="line">ctx.res——Node 的 response 对象.</span><br><span class="line">ctx.request——koa 的 Request 对象.</span><br><span class="line">ctx.response——koa 的 Response 对象.</span><br></pre></td></tr></table></figure><h4 id="koa项目的webpack配置"><a href="#koa项目的webpack配置" class="headerlink" title="koa项目的webpack配置"></a>koa项目的webpack配置</h4><p>配置webpack进行打包（支持es6语法、统一打包为1个文件）</p><p>首先需要安装的开发依赖：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;devDependencies&quot;: &#123;</span><br><span class="line">    &quot;@babel/core&quot;: &quot;^7.6.2&quot;,</span><br><span class="line">    &quot;@babel/node&quot;: &quot;^7.6.2&quot;,</span><br><span class="line">    &quot;@babel/preset-env&quot;: &quot;^7.6.2&quot;,</span><br><span class="line">    &quot;babel-loader&quot;: &quot;^8.0.6&quot;,</span><br><span class="line">    &quot;clean-webpack-plugin&quot;: &quot;^3.0.0&quot;,</span><br><span class="line">    &quot;cross-env&quot;: &quot;^6.0.0&quot;,</span><br><span class="line">    &quot;nodemon&quot;: &quot;^1.19.2&quot;,</span><br><span class="line">    &quot;webpack&quot;: &quot;^4.41.0&quot;,</span><br><span class="line">    &quot;webpack-cli&quot;: &quot;^3.3.9&quot;,</span><br><span class="line">    &quot;webpack-node-externals&quot;: &quot;^1.7.2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>webpack.config.js 配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">const nodeExternals = require(&apos;webpack-node-externals&apos;)</span><br><span class="line">const &#123;</span><br><span class="line">    CleanWebpackPlugin</span><br><span class="line">&#125; = require(&apos;clean-webpack-plugin&apos;)</span><br><span class="line"></span><br><span class="line">const config = &#123;</span><br><span class="line">    target: &apos;node&apos;,</span><br><span class="line">    mode: &apos;development&apos;,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        server: path.join(__dirname, &apos;./app.js&apos;)</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &apos;[name].bundle.js&apos;,</span><br><span class="line">        path: path.join(__dirname, &apos;./dist&apos;)</span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: &apos;eval-source-map&apos;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: /\.(js|jsx)$/,</span><br><span class="line">            use: &#123;</span><br><span class="line">                loader: &apos;babel-loader&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            exclude: [path.join(__dirname, &apos;./node_modules&apos;)]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    externals: [nodeExternals()],</span><br><span class="line">    plugins: [</span><br><span class="line">        new CleanWebpackPlugin()</span><br><span class="line">    ],</span><br><span class="line">    node: &#123;</span><br><span class="line">        console: true,</span><br><span class="line">        global: true,</span><br><span class="line">        process: true,</span><br><span class="line">        Buffer: true,</span><br><span class="line">        __filename: true,</span><br><span class="line">        __dirname: true,</span><br><span class="line">        setImmediate: true,</span><br><span class="line">        path: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = config</span><br></pre></td></tr></table></figure><p>.babelrc 配置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;presets&quot;: [</span><br><span class="line">    [</span><br><span class="line">      &quot;@babel/preset-env&quot;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;targets&quot;: &#123;</span><br><span class="line">          &quot;node&quot;: &quot;current&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行<code>npx webpack</code>即可打包，也可配置<code>&quot;build&quot;: &quot;webpack&quot;</code>，运行<code>npm run build</code></p><p>运行<code>nodemon --exec babel-node app.js</code>即可实现开发热加载，也可配置<code>&quot;watch&quot;: &quot;nodemon --exec babel-node app.js&quot;</code>，运行<code>npm run watch</code></p><h5 id="调试webpack"><a href="#调试webpack" class="headerlink" title="调试webpack"></a>调试webpack</h5><p><code>npx node --inspect-brk .\node_modules\.bin\webpack --inline --progress</code>,<br>打开<code>chrome://inspect/#devices</code>，点击<code>inspect</code>，即可进行调试。</p><p>同样可配置<code>&quot;webpack:debug&quot;: &quot;npx node --inspect-brk .\\node_modules\\.bin\\webpack --inline --progress&quot;</code>，运行<code>npm run webpack:debug</code>即可。</p><h5 id="vscode调试"><a href="#vscode调试" class="headerlink" title="vscode调试"></a>vscode调试</h5><ol><li>添加配置</li><li>可选择“node”、“nodemon”……等调试脚本</li><li>修改配置内容（文件启动入口等）<br>举个栗子：</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&quot;configurations&quot;: [&#123;</span><br><span class="line">  &quot;type&quot;: &quot;node&quot;,</span><br><span class="line">  &quot;request&quot;: &quot;launch&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;nodemon&quot;,</span><br><span class="line">  // 命令所在入口</span><br><span class="line">  &quot;runtimeExecutable&quot;:</span><br><span class="line">  &quot;$&#123;workspaceFolder&#125;/node_modules/.bin/nodemon&quot;,</span><br><span class="line">  // 调试文件</span><br><span class="line">  &quot;program&quot;: &quot;$&#123;workspaceFolder&#125;/app.js&quot;,</span><br><span class="line">  &quot;restart&quot;: true,</span><br><span class="line">  &quot;console&quot;: &quot;integratedTerminal&quot;,</span><br><span class="line">  &quot;internalConsoleOptions&quot;: &quot;neverOpen&quot;,</span><br><span class="line">  // 使用babel-node支持ES6语法</span><br><span class="line">  &quot;runtimeArgs&quot;: [&quot;--exec&quot;, &quot;babel-node&quot;]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><ol start="4"><li>在vscode中打断点，进行断点调试即可</li></ol><h5 id="如何更新npm包"><a href="#如何更新npm包" class="headerlink" title="如何更新npm包"></a>如何更新npm包</h5><p>使用<code>npm-check-updates</code>，<code>npm install -g npm-check-updates</code>全局安装后，使用<code>ncu</code>检查当前<code>package.json</code>中是否存在可更新的npm包，运行<code>ncu -u</code>即可更新包版本。</p><h5 id="整合中间件"><a href="#整合中间件" class="headerlink" title="整合中间件"></a>整合中间件</h5><p>使用<code>koa-compose</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import compose from &apos;koa-compose&apos;</span><br><span class="line"></span><br><span class="line">const middlewares = compose([</span><br><span class="line">    helmet(),</span><br><span class="line">    koaBody(),</span><br><span class="line">    cors(),</span><br><span class="line">    bodyparser(&#123;</span><br><span class="line">        enableTypes: [&apos;json&apos;, &apos;form&apos;, &apos;text&apos;]</span><br><span class="line">    &#125;),</span><br><span class="line">    json(),</span><br><span class="line">    mystatic(__dirname + &apos;/public&apos;),</span><br><span class="line">    views(__dirname + &apos;/views&apos;, &#123;</span><br><span class="line">        extension: &apos;ejs&apos;</span><br><span class="line">    &#125;),</span><br><span class="line">    router()</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">app.use(middlewares)</span><br></pre></td></tr></table></figure><p><strong>tips</strong>：以上为ES6语法，启动时应采用<code>babel-node</code>，如运行<code>nodemon --exec babel-node app.js</code>即可</p><h5 id="webpack-config分离与合并"><a href="#webpack-config分离与合并" class="headerlink" title="webpack config分离与合并"></a>webpack config分离与合并</h5><p>按照开发环境和生产环境可以配置出不同的 webpack config 文件，因此需要将其分离更加组织管理。</p><p>我们可以建立config文件，存放<code>webpack.config.base.js</code> <code>webpack.config.dev.js</code> <code>webpack.config.prod.js</code>三个文件，需要使用到<code>webpack-merge</code>插件，下面逐一介绍：</p><p>【webpack.config.base.js】</p><p>DefinePlugin中定义一些全局常量，以便代码中使用，如下，添加了process.env常量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">const path = require(&apos;path&apos;)</span><br><span class="line">const nodeExternals = require(&apos;webpack-node-externals&apos;)</span><br><span class="line">const &#123;CleanWebpackPlugin&#125; = require(&apos;clean-webpack-plugin&apos;)</span><br><span class="line">const webpack = require(&apos;webpack&apos;)</span><br><span class="line"></span><br><span class="line">const config = &#123;</span><br><span class="line">    target: &apos;node&apos;,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        server: path.join(__dirname, &apos;./app.js&apos;)</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: &apos;[name].bundle.js&apos;,</span><br><span class="line">        path: path.join(__dirname, &apos;./dist&apos;)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: /\.(js|jsx)$/,</span><br><span class="line">            use: &#123;</span><br><span class="line">                loader: &apos;babel-loader&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            exclude: [path.join(__dirname, &apos;./node_modules&apos;)]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    externals: [nodeExternals()],</span><br><span class="line">    plugins: [</span><br><span class="line">        new CleanWebpackPlugin(),</span><br><span class="line">        // 新增</span><br><span class="line">        // 创建process.env常量</span><br><span class="line">        new webpack.DefinePlugin(&#123;</span><br><span class="line">            &apos;process.env&apos;: &#123;</span><br><span class="line">                NODE_ENV: (process.env.NODE_ENV === &apos;production&apos; || process.env.NODE_ENV === &apos;prod&apos;) ? &quot;&apos;production&apos;&quot; : &quot;&apos;development&apos;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    node: &#123;</span><br><span class="line">        console: true,</span><br><span class="line">        global: true,</span><br><span class="line">        process: true,</span><br><span class="line">        Buffer: true,</span><br><span class="line">        __filename: true,</span><br><span class="line">        __dirname: true,</span><br><span class="line">        setImmediate: true,</span><br><span class="line">        path: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = config</span><br></pre></td></tr></table></figure><p>【webpack.config.dev.js】</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">const webpackMerge = require(&apos;webpack-merge&apos;)</span><br><span class="line">const baseConfig = require(&apos;./webpack.config.base&apos;)</span><br><span class="line"></span><br><span class="line">const config = webpackMerge(baseConfig, &#123;</span><br><span class="line">    devtool: &apos;eval-source-map&apos;,</span><br><span class="line">    mode: &apos;development&apos;,</span><br><span class="line">    stats: &#123;</span><br><span class="line">        children: false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports = config</span><br></pre></td></tr></table></figure><p>【webpack.config.prod.js】</p><p>terser-webpack-plugin是进行js压缩的插件，详见<a href="https://webpack.js.org/plugins/terser-webpack-plugin/#root" target="_blank" rel="noopener">TerserWebpackPlugin</a>，其中有详细的配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">const webpackMerge = require(&apos;webpack-merge&apos;)</span><br><span class="line">const baseConfig = require(&apos;./webpack.config.base&apos;)</span><br><span class="line">const TerserPlugin = require(&apos;terser-webpack-plugin&apos;);</span><br><span class="line"></span><br><span class="line">const config = webpackMerge(baseConfig, &#123;</span><br><span class="line">    devtool: &apos;eval-source-map&apos;,</span><br><span class="line">    mode: &apos;production&apos;,</span><br><span class="line">    stats: &#123;</span><br><span class="line">        children: false,</span><br><span class="line">        warnings: false</span><br><span class="line">    &#125;,</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        minimize: true,</span><br><span class="line">        minimizer: [new TerserPlugin()],</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">module.exports = config</span><br></pre></td></tr></table></figure><h5 id="项目可优化部分"><a href="#项目可优化部分" class="headerlink" title="项目可优化部分"></a>项目可优化部分</h5><p>1、提取公共模块，使用 <a href="https://webpack.js.org/plugins/split-chunks-plugin/" target="_blank" rel="noopener">SplitChunksPlugin</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">  //...</span><br><span class="line">  optimization: &#123;</span><br><span class="line">    splitChunks: &#123;</span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        commons: &#123;</span><br><span class="line">          name: &apos;commons&apos;,</span><br><span class="line">          chunks: &apos;initial&apos;,</span><br><span class="line">          minChunks: 2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>使用<code>cross-env NODE_ENV=production webpack --config config/webpack.config.prod.js</code>进行打包，或者在package.json中配置命令亦可。</p><p>2、另外在koa项目中，不建议在routes路由内部写大量的业务逻辑代码，而是将其提炼为单独controller，使用函数控制路由内部实现。</p><p>3、在app.js中，判断当前环境为生产环境时，进行中间件压缩，需要使用到<code>koa-compress</code>模块。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import compress from &apos;koa-compress&apos;</span><br><span class="line">const isDev = process.env.NODE_ENV === &apos;production&apos; ? false : true</span><br><span class="line">// 生产环境下压缩中间件</span><br><span class="line">if (!isDev) &#123;</span><br><span class="line">    app.use(compress())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/iloveyou11/koa-webpack" target="_blank" rel="noopener">github demo地址（koa的webpack配置）</a></p><h4 id="NodeMailer邮件服务"><a href="#NodeMailer邮件服务" class="headerlink" title="NodeMailer邮件服务"></a>NodeMailer邮件服务</h4><p>我们可以使用nodemailer模块实现发送邮件的服务。<br><code>npm install nodemailer</code>进行安装即可。</p><p>基础示例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line">const nodemailer = require(&apos;nodemailer&apos;);</span><br><span class="line">async function main() &#123;</span><br><span class="line">    let transporter = nodemailer.createTransport(&#123;</span><br><span class="line">        host: &apos;smtp.qq.com&apos;,</span><br><span class="line">        port: 587,</span><br><span class="line">        secure: false, //</span><br><span class="line">        auth: &#123;</span><br><span class="line">            user: &apos;xxx@qq.com&apos;, //发送人邮箱</span><br><span class="line">            pass: &apos;xxx&apos; //授权码</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    let info = await transporter.sendMail(&#123;</span><br><span class="line">        from: &apos;&quot;name&quot; &lt;xx@qq.com&gt;&apos;, // 发送人姓名和邮箱</span><br><span class="line">        to: &apos;xx@qq.com&apos;, //接收人邮箱</span><br><span class="line">        subject: &apos;Hello&apos;,</span><br><span class="line">        text: &apos;你爱我吗&apos;,</span><br><span class="line">        html: &apos;&lt;b&gt;你爱我吗？&lt;/b&gt;&apos;</span><br><span class="line">    &#125;);</span><br><span class="line">    console.log(&apos;Message sent: %s&apos;, info.messageId);</span><br><span class="line">&#125;</span><br><span class="line">main().catch(console.error);</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><div class="post-share"><a href="javascript:;" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2019/09/26/node框架概览/&title=《浅析node》 — blog&pic=/images/banner.jpg" data-title="微博"><i class="fa fa-weibo"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信"><i class="fa fa-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://localhost:4000/2019/09/26/node框架概览/&title=《浅析node》 — blog&source=一个专注前端智能化开发技术的网站" data-title="QQ"><i class="fa fa-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2019/09/26/node框架概览/" data-title="Facebook"><i class="fa fa-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《浅析node》 — blog&url=http://localhost:4000/2019/09/26/node框架概览/&via=http://localhost:4000" data-title="Twitter"><i class="fa fa-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://localhost:4000/2019/09/26/node框架概览/" data-title="Google+"><i class="fa fa-google-plus"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:;" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=http://localhost:4000/2019/09/26/node框架概览/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"></ul></footer></div></article><aside class="post-toc-pos post-toc-top" id="post-toc"><nav class="post-toc-wrap"><ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#导言"><span class="post-toc-text">导言</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#koa"><span class="post-toc-text">koa</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#快速搭建项目"><span class="post-toc-text">快速搭建项目</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#koa洋葱模型"><span class="post-toc-text">koa洋葱模型</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#koa常用中间件"><span class="post-toc-text">koa常用中间件</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#request和req的区别"><span class="post-toc-text">request和req的区别</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#koa项目的webpack配置"><span class="post-toc-text">koa项目的webpack配置</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#调试webpack"><span class="post-toc-text">调试webpack</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#vscode调试"><span class="post-toc-text">vscode调试</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#如何更新npm包"><span class="post-toc-text">如何更新npm包</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#整合中间件"><span class="post-toc-text">整合中间件</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#webpack-config分离与合并"><span class="post-toc-text">webpack config分离与合并</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#项目可优化部分"><span class="post-toc-text">项目可优化部分</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#NodeMailer邮件服务"><span class="post-toc-text">NodeMailer邮件服务</span></a></li></ol></nav></aside><nav id="article-nav"><a href="/2019/10/10/对于大前端的思考/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 对于大前端的思考 </span></a><a href="/2019/09/25/react框架详解/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">深入理解react</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="lv-container" data-id="city" data-uid="MTAyMC81MDE5Mi8yNjY4Mg=="><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><p><span id="busuanzi_container_site_uv" style="display:none">总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">总访问量：<span id="busuanzi_value_site_pv"></span></span></p><p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a> &copy; 2020 Yang Pei<br></p></div></div></footer><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script>var mihoConfig={root:"http://localhost:4000",animate:"false",isHome:"false",share:"true"}</script><div class="sidebar"><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/AI/">AI</a><a class="category-link" href="/categories/专题/">专题</a><a class="category-link" href="/categories/前端/">前端</a><a class="category-link" href="/categories/计算机/">计算机</a><a class="category-link" href="/categories/语言/">语言</a></div><div id="sidebar-menu-box-tags"></div></div><a href="javascript:;" class="sidebar-menu-box-close">&times;</a></div>ß<div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">Menus</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/archives"><i class="fa fa-archive"></i><span>全部</span></a></li><li><a href="/categories/AI/"><i class="fa fa-AI"></i><span>AI</span></a></li><li><a href="/categories/前端/"><i class="fa fa-前端"></i><span>前端</span></a></li><li><a href="/categories/计算机/"><i class="fa fa-计算机"></i><span>计算机</span></a></li><li><a href="/categories/语言/"><i class="fa fa-语言"></i><span>语言</span></a></li><li><a href="/categories/专题/"><i class="fa fa-专题"></i><span>专题</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">Tags</span><div id="mobile-header-container-tags"></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:;"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><script src="/js/pop-img.js"></script><script>$(".article-entry p img").popImg()</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({model:{jsonPath:"/live2dw/assets/Epsilon2.1.model.json"},display:{position:"right",width:150,height:300},mobile:{show:!1},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/",tagMode:!1})</script></body>