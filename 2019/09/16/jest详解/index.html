<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>前端自动化测试——jest必会 | blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="YP's Blog">
  
  <meta name="description" content="简介常见前端自动化测试框架：  Jasmine Mocha+Chai Jest  引入jest测试，则一定要针对模块进行测试 jest作用：  单元测试（模块测试） 集成测试（多个模块测试）  npx jest --init会生成jest.config.js配置文件 npx jest --coverage会自动生成测试覆盖率说明 package.json  jest –watch 修改了哪个文件，">
<meta name="keywords" content="web">
<meta property="og:type" content="article">
<meta property="og:title" content="前端自动化测试——jest必会">
<meta property="og:url" content="http://localhost:4000/2019/09/16/jest详解/index.html">
<meta property="og:site_name" content="blog">
<meta property="og:description" content="简介常见前端自动化测试框架：  Jasmine Mocha+Chai Jest  引入jest测试，则一定要针对模块进行测试 jest作用：  单元测试（模块测试） 集成测试（多个模块测试）  npx jest --init会生成jest.config.js配置文件 npx jest --coverage会自动生成测试覆盖率说明 package.json  jest –watch 修改了哪个文件，">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-07-04T05:57:59.528Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="前端自动化测试——jest必会">
<meta name="twitter:description" content="简介常见前端自动化测试框架：  Jasmine Mocha+Chai Jest  引入jest测试，则一定要针对模块进行测试 jest作用：  单元测试（模块测试） 集成测试（多个模块测试）  npx jest --init会生成jest.config.js配置文件 npx jest --coverage会自动生成测试覆盖率说明 package.json  jest –watch 修改了哪个文件，">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">YP Blog</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        YP Blog
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个专注 WEB 开发的技术博客
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="Blog" target="_blank" href="https://iloveyou11.github.io/">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="https://github.com/iloveyou11">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-jest详解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      前端自动化测试——jest必会
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/前端/">前端</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2019-09-16
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p><strong>常见前端自动化测试框架：</strong></p>
<ol>
<li>Jasmine</li>
<li>Mocha+Chai</li>
<li>Jest</li>
</ol>
<p>引入jest测试，则一定要针对模块进行测试</p>
<p><strong>jest作用：</strong></p>
<ol>
<li>单元测试（模块测试）</li>
<li>集成测试（多个模块测试）</li>
</ol>
<p><code>npx jest --init</code><br>会生成jest.config.js配置文件</p>
<p><code>npx jest --coverage</code><br>会自动生成测试覆盖率说明</p>
<p><strong>package.json</strong></p>
<ol>
<li>jest –watch 修改了哪个文件，重新运行那个文件的测试用例</li>
<li>jest –watchAll 修改了任意文件，重新运行所有文件的测试用例</li>
</ol>
<h4 id="jest语法基础"><a href="#jest语法基础" class="headerlink" title="jest语法基础"></a>jest语法基础</h4><h5 id="常用匹配器"><a href="#常用匹配器" class="headerlink" title="常用匹配器"></a>常用匹配器</h5><p><strong>1. boolean</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">toBe 相当于 === ，要完全相等才匹配（ 包括引用地址）</span><br><span class="line">toEqual 只匹配内容</span><br><span class="line">toBeNull 匹配null</span><br><span class="line">toBeUndefined 匹配undefined</span><br><span class="line">toBeDefined 匹配已定义</span><br><span class="line">toBeTruthy 转化为boolean是否为true</span><br><span class="line">toBeFalsy 转化为boolean是否为false</span><br><span class="line">not 非</span><br></pre></td></tr></table></figure>

<p><strong>2. number</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">toBeGreaterThan 大于</span><br><span class="line">toBeLessThan 小于</span><br><span class="line">toBeGreaterThanOrEqual 大于等于</span><br><span class="line">toBeLessThanOrEqual 小于等于</span><br><span class="line">toBeCloseTo 计算浮点数可使用，因为浮点数会出现小数溢出</span><br></pre></td></tr></table></figure>

<p><strong>3. string</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toMatch 正则表达式或字符串</span><br></pre></td></tr></table></figure>

<p><strong>4. array、set</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toContain 数组包含某个值</span><br></pre></td></tr></table></figure>

<p><strong>5. 异常</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toThrow 函数抛出异常</span><br></pre></td></tr></table></figure>

<h5 id="模式切换"><a href="#模式切换" class="headerlink" title="模式切换"></a>模式切换</h5><p>合理地使用这些模式，能够让测试变得更加地灵活、好用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Watch Usage</span><br><span class="line"> › Press f to run only failed tests.</span><br><span class="line"> › Press o to only run tests related to changed files.  </span><br><span class="line"> // 需要使用git来管理代码</span><br><span class="line"> // 以检测变化的文件</span><br><span class="line"> // jest --watch表示直接进入o模式</span><br><span class="line"> › Press p to filter by a filename regex pattern.</span><br><span class="line"> › Press t to filter by a test name regex pattern.</span><br><span class="line"> › Press q to quit watch mode.</span><br><span class="line"> › Press Enter to trigger a test run.</span><br></pre></td></tr></table></figure>

<h5 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h5><p><strong>1. 回调函数</strong></p>
<p>处理异步函数测试，需要使用done，在异步回调中加入done函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchData = <span class="function">(<span class="params">fn</span>) =&gt;</span> &#123;</span><br><span class="line">    axios.get(<span class="string">'http://www.dell-lee.com/react/api/demo.json'</span>).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        fn(res.data)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test(<span class="string">'fetchData'</span>, (done) =&gt; &#123;</span><br><span class="line">    fetchData(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        expect(data).toEqual(&#123;</span><br><span class="line">            success: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">        done()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>promise<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fetchData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> axios.get(<span class="string">'http://www.dell-lee.com/react/api/demo1.json'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法1</span></span><br><span class="line"><span class="comment">// 测试内容</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> fetchData().then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        expect(res.data).toEqual(&#123;</span><br><span class="line">            success: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 测试404，记得一定要加expect.assertions(1)保证下面一定执行1个expect</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, () =&gt; &#123;</span><br><span class="line">    expect.assertions(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> fetchData().catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">        expect(e.toString().indexOf(<span class="string">'404'</span>) &gt; <span class="number">-1</span>).toBe(<span class="literal">true</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法2</span></span><br><span class="line"><span class="comment">// 测试内容</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> expect(fetchData()).resolves.toMatchObject(&#123;</span><br><span class="line">        data: &#123;</span><br><span class="line">            success: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 测试404</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> expect(fetchData()).rejects.toThrow()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法3</span></span><br><span class="line"><span class="comment">// 测试内容</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> expect(fetchData()).resolves.toMatchObject(&#123;</span><br><span class="line">        data: &#123;</span><br><span class="line">            success: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 测试404</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> expect(fetchData()).rejects.toThrow()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法4</span></span><br><span class="line"><span class="comment">// 测试内容</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> fetchData()</span><br><span class="line">    expect(res.data).toEqual(&#123;</span><br><span class="line">        success: <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 测试404</span></span><br><span class="line">test(<span class="string">'fetchData'</span>, <span class="keyword">async</span>() =&gt; &#123;</span><br><span class="line">    expect.assertions(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> fetchData()</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        expect(e.toString().indexOf(<span class="string">'404'</span>) &gt; <span class="number">-1</span>).toBe(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h5 id="钩子函数"><a href="#钩子函数" class="headerlink" title="钩子函数"></a>钩子函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">beforeAll：在所有测试用例之前执行</span><br><span class="line">beforeEach：在每个测试用例之前执行</span><br><span class="line">afterAll：在所有测试用例之后执行</span><br><span class="line">afterEach：在每个测试用例之后执行</span><br><span class="line"></span><br><span class="line">beforeEach(() =&gt; &#123;</span><br><span class="line">  initializeCityDatabase();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">afterEach(() =&gt; &#123;</span><br><span class="line">  clearCityDatabase();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">beforeAll(() =&gt; &#123;</span><br><span class="line">  return initializeCityDatabase();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">afterAll(() =&gt; &#123;</span><br><span class="line">  return clearCityDatabase();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h5><p>这样可以使结构看起来更为清晰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">describe(&apos;outer&apos;, () =&gt; &#123;</span><br><span class="line">  describe(&apos;describe inner 1&apos;, () =&gt; &#123;</span><br><span class="line">    console.log(&apos;describe inner 1&apos;);</span><br><span class="line">    test(&apos;test 1&apos;, () =&gt; &#123;</span><br><span class="line">      console.log(&apos;test for describe inner 1&apos;);</span><br><span class="line">      expect(true).toEqual(true);</span><br><span class="line">    &#125;);</span><br><span class="line">    test(&apos;test 2&apos;, () =&gt; &#123;</span><br><span class="line">      console.log(&apos;test for describe inner 2);</span><br><span class="line">      expect(true).toEqual(true);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  describe(&apos;describe inner 2&apos;, () =&gt; &#123;</span><br><span class="line">    test(&apos;test1 for describe inner 2&apos;, () =&gt; &#123;</span><br><span class="line">      console.log(&apos;test for describe inner 2&apos;);</span><br><span class="line">      expect(false).toEqual(false);</span><br><span class="line">    &#125;);</span><br><span class="line">    test(&apos;test2 for describe inner 2&apos;, () =&gt; &#123;</span><br><span class="line">      console.log(&apos;test for describe inner 2&apos;);</span><br><span class="line">      expect(false).toEqual(false);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>test.only是指只执行那一个测试用例</p>
<h5 id="mock文件"><a href="#mock文件" class="headerlink" title="mock文件"></a>mock文件</h5><p>使用jest对axios做一个模拟，这样就不会去请求真正的数据，因为每次调用接口很耗费时间，假若要做大量的ajax测试，则会耗费很长的时间才能完成测试，而前端不需要在意接口返回的内容（此部分由后端完成接口测试），只在意接口是否成功请求，因此采用mock函数可以解决此问题。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">// demo.js</span><br><span class="line"></span><br><span class="line">import axios from &quot;axios&quot;;</span><br><span class="line">export const runCb = (cb) =&gt; &#123;</span><br><span class="line">    cb()</span><br><span class="line">&#125;</span><br><span class="line">export const getData = () =&gt; &#123;</span><br><span class="line">    return axios.get(&apos;/api&apos;).then(res =&gt; res.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// demo.test.js</span><br><span class="line"></span><br><span class="line">import &#123;</span><br><span class="line">    runCb,</span><br><span class="line">    getData</span><br><span class="line">&#125; from &apos;./demo&apos;</span><br><span class="line">import axios from &apos;axios&apos;;</span><br><span class="line">jest.mock(&apos;axios&apos;) //使用jest对axios做一个模拟，这样就不会去请求真正的数据了</span><br><span class="line"></span><br><span class="line">//   mock函数，</span><br><span class="line">//   1、捕获函数的调用；</span><br><span class="line">//   2、自由地设置返回结果；</span><br><span class="line">//   3、改变内部函数的实现</span><br><span class="line"></span><br><span class="line">test(&apos;测试runCb函数&apos;, () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    const func = jest.fn()</span><br><span class="line"></span><br><span class="line">    //mock函数有返回值</span><br><span class="line">    // const func = jest.fn(()=&gt;&#123;</span><br><span class="line">    //     return &apos;aa&apos;</span><br><span class="line">    // &#125;) </span><br><span class="line"></span><br><span class="line">    // 模拟返回结果各一次</span><br><span class="line">    func.mockReturnValueOnce(&apos;aaa&apos;).mockReturnValueOnce(&apos;bbb&apos;)</span><br><span class="line">        // 模拟每次返回结果</span><br><span class="line">    func.mockReturnValue(&apos;aaa&apos;)</span><br><span class="line">        // 模拟函数内部具体实现</span><br><span class="line">    func.mockImplementation(() =&gt; &#123;</span><br><span class="line">        // ……</span><br><span class="line">        // 函数具体实现</span><br><span class="line">    &#125;)</span><br><span class="line">    func.mockImplementationOnce(() =&gt; &#123;</span><br><span class="line">            // ……</span><br><span class="line">            // 函数具体实现</span><br><span class="line">        &#125;)</span><br><span class="line">    // 模拟返回this</span><br><span class="line">    func.mockReturnThis()</span><br><span class="line">    runCb(func)</span><br><span class="line">    runCb(func)</span><br><span class="line">    expect(func).toBeCalled() //验证func被调用过</span><br><span class="line"></span><br><span class="line">    // console.log(func.mock); </span><br><span class="line">    // &#123;</span><br><span class="line">    //     calls: [[],[]],</span><br><span class="line">    //     instances: [undefined, undefined],</span><br><span class="line">    //     invocationCallOrder: [1, 2],</span><br><span class="line">    //     results: [&#123;</span><br><span class="line">    //             type: &apos;return&apos;,</span><br><span class="line">    //             value: &apos;aaa&apos;</span><br><span class="line">    //         &#125;,&#123;</span><br><span class="line">    //             type: &apos;return&apos;,</span><br><span class="line">    //             value: &apos;bbb&apos;</span><br><span class="line">    //         &#125;</span><br><span class="line">    //     ]</span><br><span class="line">    // &#125;</span><br><span class="line"></span><br><span class="line">    expect(func.mock.calls.length).toBe(2) // 验证调用了两次</span><br><span class="line">    expect(func.mock.calls[0]).toEqual([&apos;abc&apos;]) // 验证接收的参数</span><br><span class="line">    expect(func).toBeCalledWith(&apos;aaa&apos;) // 验证函数每次接收的参数都是aaa</span><br><span class="line">    expect(func.mock.results[0].value).toBe(&apos;aaa&apos;) // 验证函数返回结果</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(&apos;测试ajax请求&apos;, async() =&gt; &#123;</span><br><span class="line">    axios.get.mockResolvedValue(&#123;</span><br><span class="line">        data: &apos;hello&apos;</span><br><span class="line">    &#125;)</span><br><span class="line">    await getData().then((data) =&gt; &#123;</span><br><span class="line">        expect(data).toBe(&apos;hello&apos;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>推荐使用vscode提供的<code>jest插件</code>，安装后不需要执行<code>npm test</code>命令，保存文件即可执行测试，绿色代表测试用例通过</p>
<p><strong>实现mock文件和非mock文件</strong></p>
<p>如果不采用<code>jest.mock(&#39;axios&#39;)</code>来模拟ajax请求，而是直接模拟函数（用其他函数来代替），jest也提供了此类方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// jest会自动找__mocks__文件夹，将此文件夹下地demo.js代替原目录下的demo.js，这样可以模拟异步请求</span><br><span class="line">jest.mock(&apos;./demo&apos;)</span><br><span class="line"></span><br><span class="line">// 不采用以上语句也是可以的，可以直接修改jest.config.js配置文件，将automock设置为true</span><br><span class="line">automock: true</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jest.mock(&apos;./demo&apos;)</span><br><span class="line">import &#123;fetchData&#125; from &apos;./demo&apos; //这里使用的__mocks__下的demo.js文件</span><br><span class="line">const &#123;getNumber&#125; = jest.requireActual(&apos;./demo&apos;) //这里使用的项目中实际的demo.js文件</span><br></pre></td></tr></table></figure>

<p>一般在项目中，需要模拟异步请求，而不模拟同步函数，因此可以使用jest.requireActual来加载真正的同步函数<br>fetchData是模拟demo.js中的函数，而getNumber是真正demo.js中的函数</p>
<h5 id="mock定时器"><a href="#mock定时器" class="headerlink" title="mock定时器"></a>mock定时器</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// timer.js</span><br><span class="line">export default (cb) =&gt; &#123;</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">        cb()</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            cb()</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">    &#125;, 1000)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用done可以测试setTimeout定时器，但是当定时时间非常大时，则需要等待很长的时间执行，因此可以使用jest提供的useFakeTimers函数，模拟定时器立即执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// time.test.js</span><br><span class="line"></span><br><span class="line">import timer from &apos;./timer&apos;</span><br><span class="line"></span><br><span class="line">test(&apos;测试定时器&apos;, (done) =&gt; &#123;</span><br><span class="line">    timer(() =&gt; &#123;</span><br><span class="line">        expect(2).toBe(2)</span><br><span class="line">        done()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用jest提供的useFakeTimers函数，模拟定时器立即执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import timer from &apos;./timer&apos;</span><br><span class="line">jest.useFakeTimers()</span><br><span class="line"></span><br><span class="line">// jest.useFakeTimers()和jest.runAllTimers()配对使用</span><br><span class="line">// 能够有效避免运行异步函数的等待时间</span><br><span class="line">test(&apos;测试定时器&apos;, () =&gt; &#123;</span><br><span class="line">    const fn = jest.fn()</span><br><span class="line">    timer(fn)</span><br><span class="line"></span><br><span class="line">    // 运行所有的定时器</span><br><span class="line">    jest.runAllTimers()</span><br><span class="line">    expect(fn).toHaveBeenCalledTimes(2)</span><br><span class="line">    // 只运行处于队列中的定时器</span><br><span class="line">    // jest.runOnlyPendingTimers()</span><br><span class="line">    // expect(fn).toHaveBeenCalledTimes(1)</span><br><span class="line">    // 任意地快进时间</span><br><span class="line">    // jest.advanceTimersByTime(3000)</span><br><span class="line">    // expect(fn).toHaveBeenCalledTimes(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>解释一下，<code>jest.useFakeTimers()</code>和<code>jest.runAllTimers()</code>必须配对使用。<code>runAllTimers()</code>是运行所有的定时器，如例子中的两个<code>setTimeout</code>都会被执行，而<code>runOnlyPendingTimers()</code>只运行处于队列中的定时器，即只执行最外层的<code>setTimeout</code>，还有<code>advanceTimersByTime()</code>函数是指定任意的快进时间</p>
<h5 id="snapshot"><a href="#snapshot" class="headerlink" title="snapshot"></a>snapshot</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">    config1,</span><br><span class="line">    config2</span><br><span class="line">&#125; from &apos;./aa&apos;</span><br><span class="line"></span><br><span class="line">test(&apos;测试静态配置&apos;, () =&gt; &#123;</span><br><span class="line">    expect(config1()).toMatchSnapshot()</span><br><span class="line">&#125;)</span><br><span class="line">test(&apos;测试动态配置&apos;, () =&gt; &#123;</span><br><span class="line">    expect(config2()).toMatchSnapshot(&#123;</span><br><span class="line">        time: expect.any(Date)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">test(&apos;测试行内snapshot&apos;, () =&gt; &#123;</span><br><span class="line">    expect(config2()).toMatchInlineSnapshot(&#123;</span><br><span class="line">        time: expect.any(Date)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果要使用行内snapshot（就是在test文件间生成快照，而不是单独地生成快照文件），则需要安装第三方模块prettier</p>
<h5 id="测试ES6中的类"><a href="#测试ES6中的类" class="headerlink" title="测试ES6中的类"></a>测试ES6中的类</h5><p>所谓单元测试，是针对此单元模块做测试，而不关心引入的外部模块是否正常，如果引入的外部模块中含有大量的复杂逻辑，则会拖慢测试的性能，因此可以采用模拟类的方式解决</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// util.js</span><br><span class="line">class Util &#123;</span><br><span class="line">    init() &#123;</span><br><span class="line">        // 异常复杂</span><br><span class="line">    &#125;</span><br><span class="line">    a() &#123;</span><br><span class="line">        // 异常复杂</span><br><span class="line">    &#125;</span><br><span class="line">    b() &#123;</span><br><span class="line">        // 异常复杂</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default Util</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// class.js  待测试的方法</span><br><span class="line">import Util from &quot;./util&quot;;</span><br><span class="line">export const class1 = (a, b) =&gt; &#123;</span><br><span class="line">    const util = new Util()</span><br><span class="line">    util.a(a)</span><br><span class="line">    util.b(b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">// class.test.js 测试文件</span><br><span class="line"></span><br><span class="line">// jest.mock发现util是一个类, 会自动把类中的构造函数和方法替换为jest.fn()</span><br><span class="line">jest.mock(&apos;./util.js&apos;) </span><br><span class="line"></span><br><span class="line">// 转化如下:</span><br><span class="line">// const Util = jest.fn()</span><br><span class="line">// Util.prototype.inti=jest.fn()</span><br><span class="line">// Util.prototype.a=jest.fn()</span><br><span class="line">// Util.prototype.b=jest.fn()</span><br><span class="line"></span><br><span class="line">import &#123;class1&#125; from &apos;./class&apos;</span><br><span class="line">import Util from &apos;./util&apos;</span><br><span class="line"></span><br><span class="line">// 如果a b方法内部逻辑异常复杂,而我们只关心class1是否成功创建了实例,并执行了a b方法,不关注其内部实现,如果简化测试呢?</span><br><span class="line">test(&apos;测试class1是否成功创建了实例,并执行了a b方法&apos;, () =&gt; &#123;</span><br><span class="line">    class1()</span><br><span class="line">    expect(Util).toHaveBeenCalled()</span><br><span class="line">    console.log(Util.mock);</span><br><span class="line">    expect(Util.mock.instances[0].a).toHaveBeenCalled()</span><br><span class="line">    expect(Util.mock.instances[0].b).toHaveBeenCalled()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>集成测试（对此单元以及单元内所包含的其他单元模块统一地去做测试）</p>
<p>在单元测试中我们之所以使用mock，是因为mock能够让我们引入的外部模块变得简单，让单元测试运行起来会更加地快速</p>
<p>如果需要对Util类的mock做进一步的自定义，则可以使用之前提到的<strong>mocks</strong>文件夹进行手动模拟</p>
<h5 id="DOM节点操作"><a href="#DOM节点操作" class="headerlink" title="DOM节点操作"></a>DOM节点操作</h5><p>node环境下是不具备dom的，但是jest在node环境下自己模拟了一套dom api，需要安装jquery模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import $ from &apos;jquery&apos;</span><br><span class="line"></span><br><span class="line">const addDiv = () =&gt; &#123;</span><br><span class="line">    $(&apos;body&apos;).append(&apos;&lt;div&gt;aaa&lt;/div&gt;&apos;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default addDiv</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import addDiv from &apos;./dom&apos;</span><br><span class="line">import $ from &apos;jquery&apos;</span><br><span class="line"></span><br><span class="line">// node环境下是不具备dom的</span><br><span class="line">// 但是jest在node环境下自己模拟了一套dom api</span><br><span class="line">test(&apos;测试dom&apos;, () =&gt; &#123;</span><br><span class="line">    addDiv()</span><br><span class="line">    expect($(&apos;body&apos;).find(&apos;div&apos;).length).toBe(1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="自动化测试介绍"><a href="#自动化测试介绍" class="headerlink" title="自动化测试介绍"></a>自动化测试介绍</h4><h5 id="TDD-vs-BDD"><a href="#TDD-vs-BDD" class="headerlink" title="TDD vs BDD"></a>TDD vs BDD</h5><p><strong>（1）TDD</strong><br>测试驱动开发的模式，写代码之前先会去想测试怎么写，这样有助于先思考代码怎么实现，可以有效地提升写代码的质量<br><strong>开发流程</strong></p>
<ol>
<li>编写测试用例</li>
<li>运行测试，测试用例无法通过测试</li>
<li>编写代码，使测试用例通过测试</li>
<li>优化代码，完成开发</li>
<li>重复上述步骤</li>
</ol>
<p><strong>优势：</strong></p>
<ol>
<li>长期减少回归bug</li>
<li>代码质量更好（组织、可维护性）</li>
<li>测试覆盖率高</li>
<li>错误测试代码不容易出现</li>
</ol>
<p><strong>特点:</strong></p>
<ol>
<li>先写测试再写代码</li>
<li>一般结合单元测试使用，是白盒测试</li>
<li>测试重点是代码</li>
<li>安全感低</li>
<li>速度快</li>
</ol>
<p><strong>（2）BDD</strong><br>行为驱动开发的模式，先写完所有业务代码，之后再根据用户的行为去写测试代码，这样能够保证测试的行为在项目运行时能够正确地执行<br><strong>开发流程</strong></p>
<ol>
<li>编写完代码</li>
<li>根据用户行为编写测试用例</li>
<li>运行测试，验证测试用例是否通过</li>
<li>优化代码，保证测试用例全部通过</li>
<li>重复上述步骤</li>
</ol>
<p><strong>特点:</strong></p>
<ol>
<li>先写代码再写测试</li>
<li>一般结合集成测试使用，是黑盒测试</li>
<li>测试重点在UI（DOM）</li>
<li>安全感高</li>
<li>速度慢</li>
</ol>
<h5 id="单元测试-vs-集成测试"><a href="#单元测试-vs-集成测试" class="headerlink" title="单元测试 vs 集成测试"></a>单元测试 vs 集成测试</h5><p><strong>（1）单元测试</strong>：针对一个模块（单元）进行测试，当我们对一个模块或一个组件进行单元测试的时候，测试覆盖率会非常高，但是单元测试也存在一些缺点，比如业务耦合度高，当我们要修改组件逻辑或数据的时候，要重新修改单元测试的代码，会使代码量增大。单元测试也会增加工作量，因为要对组件或模块进行全覆盖地测试，有时候测试代码会比业务本身的代码还要多。</p>
<p>单元测试只能确保各模块或组件能正常运行，但是不能确保它们组件起来也能正常运行，单元测试过于独立，不能保证整个项目能够正常运行。结合它的一些优点和缺点，单元测试在某些场景下是适用的，某些场景下是不适用的。</p>
<p>例如我们要开发一个函数库，这个时候使用TDD+单元测试就很合适，因为函数库是一个个函数入参和结果生成，因此写单元测试不会和函数耦合得很紧密。当写业务代码的时候，业务耦合度会很高，单元测试实际上并不是很适用。</p>
<p><strong>（2）集成测试</strong>：测的是一个用户功能模块，比如用户注册功能，集成测试完全是用测试脚本去模拟用户操作，比如打开浏览器、点击注册链接、输入用户名密码、点击注册。集成测试不用关注代码自身的实现，而是根据一系列的用户操作编写测试用例，保证其功能正常即可。</p>
<p>集成测试能确保它们组件起来能正常运行，但是其测试覆盖率没有单元测试高。</p>
<p>在项目业务开发过程中，使用BDD+集成测试就很合适，因为我们可以先写完代码，再根据用户行为去测试功能是否正常，开发过程比单元测试更为快捷，并且能够有效保证功能逻辑正常。</p>
<h5 id="前端自动化测试的优势"><a href="#前端自动化测试的优势" class="headerlink" title="前端自动化测试的优势"></a>前端自动化测试的优势</h5><ol>
<li>更好的代码组织，项目的可维护性增强</li>
<li>更小的bug出现频率，尤其是回归测试中的bug</li>
<li>修改工程质量差的项目时，更加安全</li>
<li>项目具备潜在的文档特性</li>
<li>扩展前端的知识面（深入框架底层、node知识）</li>
</ol>
<h4 id="vue项目自动化测试"><a href="#vue项目自动化测试" class="headerlink" title="vue项目自动化测试"></a>vue项目自动化测试</h4><h5 id="vue环境下配置jest"><a href="#vue环境下配置jest" class="headerlink" title="vue环境下配置jest"></a>vue环境下配置jest</h5><ol>
<li>使用vue脚手架创建项目，<code>vue create [name]</code>,手动配置，选择jest，会自动生成jest.config.js配置文件</li>
<li>如果是自己手动搭建vue项目环境，需要支持jest的话，可以创建一个jest.config.js文件，内容如下：（记得安装第三方依赖）</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    moduleFileExtensions: [</span><br><span class="line">        &apos;js&apos;,</span><br><span class="line">        &apos;jsx&apos;,</span><br><span class="line">        &apos;json&apos;,</span><br><span class="line">        &apos;vue&apos;</span><br><span class="line">    ],</span><br><span class="line">    transform: &#123;</span><br><span class="line">        &apos;^.+\\.vue$&apos;: &apos;vue-jest&apos;,</span><br><span class="line">        &apos;.+\\.(css|styl|less|sass|scss|svg|png|jpg|ttf|woff|woff2)$&apos;: &apos;jest-transform-stub&apos;,</span><br><span class="line">        &apos;^.+\\.jsx?$&apos;: &apos;babel-jest&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    transformIgnorePatterns: [</span><br><span class="line">        &apos;/node_modules/&apos;</span><br><span class="line">    ],</span><br><span class="line">    moduleNameMapper: &#123;</span><br><span class="line">        &apos;^@/(.*)$&apos;: &apos;&lt;rootDir&gt;/src/$1&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    snapshotSerializers: [</span><br><span class="line">        &apos;jest-serializer-vue&apos;</span><br><span class="line">    ],</span><br><span class="line">    testMatch: [</span><br><span class="line">        &apos;**/tests/unit/**/*.spec.(js|jsx|ts|tsx)|**/__tests__/*.(js|jsx|ts|tsx)&apos;</span><br><span class="line">    ],</span><br><span class="line">    testURL: &apos;http://localhost/&apos;,</span><br><span class="line">    watchPlugins: [</span><br><span class="line">        &apos;jest-watch-typeahead/filename&apos;,</span><br><span class="line">        &apos;jest-watch-typeahead/testname&apos;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="vue-test-utils的配置和使用"><a href="#vue-test-utils的配置和使用" class="headerlink" title="vue-test-utils的配置和使用"></a>vue-test-utils的配置和使用</h5><p><a href="https://vue-test-utils.vuejs.org/" target="_blank" rel="noopener">官方文档</a></p>
<ol>
<li>shallowMount适合单元测试时使用，只做浅渲染，不渲染内部引入的其他组件，知识用占位符代表其引入，从而提高性能</li>
<li>mount是全部渲染，做集成测试时，mount是合理的选择，但是会降低性能<br><code>import {shallowMount,mount} from &#39;@vue/test-utils&#39;</code></li>
</ol>
<p>使用快照测试，可以帮助我们及时捕获UI的变化，判断组件是否正常渲染。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &apos;vue&apos;</span><br><span class="line">import &#123;shallowMount&#125; from &apos;@vue/test-utils&apos;</span><br><span class="line">import Hello from &apos;@/components/Hello.vue&apos;</span><br><span class="line">import &#123;wrap&#125; from &apos;module&apos;;</span><br><span class="line"></span><br><span class="line">describe(&apos;测试Hello.vue&apos;, () =&gt; &#123;</span><br><span class="line">    it(&apos;不适用vue-test-utils，原始方法进行测试，较为繁琐&apos;, () =&gt; &#123;</span><br><span class="line">        const root = document.createElement(&apos;div&apos;)</span><br><span class="line">        root.className = &apos;root&apos;</span><br><span class="line">        document.body.append(root)</span><br><span class="line">        new Vue(&#123;</span><br><span class="line">            render: h =&gt; h(Hello, &#123;</span><br><span class="line">                props: &#123;</span><br><span class="line">                    msg: &apos;hello&apos;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;).$mount(&apos;.root&apos;)</span><br><span class="line">        expect(document.getElementsByClassName(&apos;hello-container&apos;).length).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // shallowMount适合单元测试时使用，只做浅渲染，不渲染内部引入的其他组件，知识用占位符代表其引入，从而提高性能</span><br><span class="line">    // mount是全部渲染，做集成测试时，mount是合理的选择，但是会降低性能</span><br><span class="line">    it(&apos;使用vue-test-utils进行测试&apos;, () =&gt; &#123;</span><br><span class="line">        const msg = &apos;hello world&apos;</span><br><span class="line">        const wrapper = shallowMount(Hello, &#123;</span><br><span class="line">            propsData: &#123;</span><br><span class="line">                msg</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        expect(wrapper.text()).toMatch(msg)</span><br><span class="line">        expect(wrapper.props(&apos;msg&apos;)).toEqual(msg)</span><br><span class="line">        expect(wrapper.findAll(&apos;.hello-container&apos;).length).toBe(1)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    // 快照测试，可以帮助我们及时捕获UI的变化</span><br><span class="line">    it(&apos;单纯测试组件渲染是否正常&apos;, () =&gt; &#123;</span><br><span class="line">        const msg = &apos;hello world&apos;</span><br><span class="line">        const wrapper = shallowMount(Hello, &#123;</span><br><span class="line">            propsData: &#123;</span><br><span class="line">                msg</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        expect(wrapper).toMatchSnapshot()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h5><p>TDD开发Header组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">    shallowMount</span><br><span class="line">&#125; from &apos;@vue/test-utils&apos;</span><br><span class="line">import Header from &apos;../../components/header.vue&apos;</span><br><span class="line"></span><br><span class="line">// 建议看vue-test-utils英文文档，看wrapper具有哪些方法</span><br><span class="line">it(&apos;header 包含 input框&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallowMount(Header)</span><br><span class="line">    const input = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">    expect(input.exists()).toBe(true)</span><br><span class="line">&#125;)</span><br><span class="line">it(&apos;input 框初始值为空&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallowMount(Header)</span><br><span class="line">    const inputValue = wrapper.vm.$data.inputValue</span><br><span class="line">    expect(inputValue).toBe(&apos;&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">it(&apos;input 发生变化，数据跟着变化&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallowMount(Header)</span><br><span class="line">    const input = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">    input.setValue(&apos;hello world&apos;)</span><br><span class="line">    const inputValue = wrapper.vm.$data.inputValue</span><br><span class="line">    expect(inputValue).toBe(&apos;hello world&apos;)</span><br><span class="line">&#125;)</span><br><span class="line">it(&apos;input 中无内容时，无反应&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallowMount(Header)</span><br><span class="line">    const input = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">    input.setValue(&apos;&apos;)</span><br><span class="line">    input.trigger(&apos;keyup.enter&apos;)</span><br><span class="line">        // 不应该向外触发add事件</span><br><span class="line">    expect(wrapper.emitted().add).toBeFalsy()</span><br><span class="line">&#125;)</span><br><span class="line">it(&apos;input 中有内容时，向外触发add事件，同时清空input&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallowMount(Header)</span><br><span class="line">    const input = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">    input.setValue(&apos;aaaaaaaaa&apos;)</span><br><span class="line">    input.trigger(&apos;keyup.enter&apos;)</span><br><span class="line">    expect(wrapper.emitted().add).toBeTruthy()</span><br><span class="line">    expect(wrapper.vm.$data.inputValue).toBe(&apos;&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>TDD开发Todo页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">    shallowMount</span><br><span class="line">&#125; from &apos;@vue/test-utils&apos;</span><br><span class="line">import TodoList from &apos;../../TodoList.vue&apos;</span><br><span class="line">import Header from &apos;../../components/header.vue&apos;</span><br><span class="line"></span><br><span class="line">it(&apos;TodoList初始化时，undoList为空&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallowMount(TodoList)</span><br><span class="line">    const undoList = wrapper.vm.$data.undoList</span><br><span class="line">    expect(undoList).toEqual([])</span><br><span class="line">&#125;)</span><br><span class="line">it(&apos;TodoList监听到Header的add事件时，会增加一个内容&apos;, () =&gt; &#123;</span><br><span class="line">    const content = &apos;learning IT&apos;</span><br><span class="line">    const wrapper = shallowMount(TodoList)</span><br><span class="line">    const header = wrapper.find(Header)</span><br><span class="line">    header.vm.$emit(&apos;add&apos;, content)</span><br><span class="line">    const undoList = wrapper.vm.$data.undoList</span><br><span class="line">    expect(undoList).toEqual([content])</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>修复eslint报错：<code>npm run lint --fix</code></p>
<p>增加快照测试，能够保证页面UI样式不发生变化，如果变化会及时通知，输入w/u进行手动确认</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">it(&apos;header样式发生改变作提示&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallowMount(Header)</span><br><span class="line">    expect(wrapper).toMatchSnapshot()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="react项目自动化测试"><a href="#react项目自动化测试" class="headerlink" title="react项目自动化测试"></a>react项目自动化测试</h4><h5 id="react环境下配置jest"><a href="#react环境下配置jest" class="headerlink" title="react环境下配置jest"></a>react环境下配置jest</h5><p>create-react-app中自动集成了jest，具体配置在package.json文件中。</p>
<p>如果是自己搭建react项目环境，则可以配置jest.config.js文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    &quot;roots&quot;: [</span><br><span class="line">        &quot;&lt;rootDir&gt;/src&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;collectCoverageFrom&quot;: [</span><br><span class="line">        &quot;src/**/*.&#123;js,jsx,ts,tsx&#125;&quot;,</span><br><span class="line">        &quot;!src/**/*.d.ts&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;setupFiles&quot;: [</span><br><span class="line">        &quot;react-app-polyfill/jsdom&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;setupFilesAfterEnv&quot;: [],</span><br><span class="line">    &quot;testMatch&quot;: [</span><br><span class="line">        &quot;&lt;rootDir&gt;/src/**/__tests__/**/*.&#123;js,jsx,ts,tsx&#125;&quot;,</span><br><span class="line">        &quot;&lt;rootDir&gt;/src/**/*.&#123;spec,test&#125;.&#123;js,jsx,ts,tsx&#125;&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;testEnvironment&quot;: &quot;jest-environment-jsdom-fourteen&quot;,</span><br><span class="line">    &quot;transform&quot;: &#123;</span><br><span class="line">        &quot;^.+\\.(js|jsx|ts|tsx)$&quot;: &quot;&lt;rootDir&gt;/node_modules/babel-jest&quot;,</span><br><span class="line">        &quot;^.+\\.css$&quot;: &quot;&lt;rootDir&gt;/config/jest/cssTransform.js&quot;,</span><br><span class="line">        &quot;^(?!.*\\.(js|jsx|ts|tsx|css|json)$)&quot;: &quot;&lt;rootDir&gt;/config/jest/fileTransform.js&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;transformIgnorePatterns&quot;: [</span><br><span class="line">        &quot;[/\\\\]node_modules[/\\\\].+\\.(js|jsx|ts|tsx)$&quot;,</span><br><span class="line">        &quot;^.+\\.module\\.(css|sass|scss)$&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;modulePaths&quot;: [],</span><br><span class="line">    &quot;moduleNameMapper&quot;: &#123;</span><br><span class="line">        &quot;^react-native$&quot;: &quot;react-native-web&quot;,</span><br><span class="line">        &quot;^.+\\.module\\.(css|sass|scss)$&quot;: &quot;identity-obj-proxy&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;moduleFileExtensions&quot;: [</span><br><span class="line">        &quot;web.js&quot;,</span><br><span class="line">        &quot;js&quot;,</span><br><span class="line">        &quot;web.ts&quot;,</span><br><span class="line">        &quot;ts&quot;,</span><br><span class="line">        &quot;web.tsx&quot;,</span><br><span class="line">        &quot;tsx&quot;,</span><br><span class="line">        &quot;json&quot;,</span><br><span class="line">        &quot;web.jsx&quot;,</span><br><span class="line">        &quot;jsx&quot;,</span><br><span class="line">        &quot;node&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;watchPlugins&quot;: [</span><br><span class="line">        &quot;jest-watch-typeahead/filename&quot;,</span><br><span class="line">        &quot;jest-watch-typeahead/testname&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="安装enzyme"><a href="#安装enzyme" class="headerlink" title="安装enzyme"></a>安装enzyme</h5><p><a href="https://github.com/airbnb/enzyme" target="_blank" rel="noopener">github平台</a>、<a href="https://airbnb.io/enzyme/" target="_blank" rel="noopener">官方文档</a></p>
<p>安装：<code>npm i --save-dev enzyme enzyme-adapter-react-16</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 在test文件中引入</span><br><span class="line">import Enzyme from &apos;enzyme&apos;;</span><br><span class="line">import Adapter from &apos;enzyme-adapter-react-16&apos;;</span><br><span class="line"></span><br><span class="line">Enzyme.configure(&#123; adapter: new Adapter() &#125;);</span><br></pre></td></tr></table></figure>

<p>在测试时，建议给DOM添加data-test属性，这样能降低与原代码class、id等选择器的耦合度，改动class、id依然能选择出正确的DOM节点。</p>
<p>单元测试适合用shallow、集成测试适合用mount；shallow是浅渲染（不渲染内部子组件）、mount是深渲染。</p>
<p><code>import Enzyme, {shallow,mount} from &#39;enzyme&#39;</code></p>
<p><code>wrapper.debug()</code>可以打印出完整的DOM信息（对应wrapper），更方便调试。</p>
<p>快照<code>expect(wrapper).toMatchSnapshot()</code>的使用：如果我们对页面的展示内容比较敏感，一般不会去改动，改动时需要反复校验，遇到这种页面或组件时，可以采用snapshot对其进行约束。</p>
<p>安装<code>jest-enzyme</code>可以采用更多的匹配器，方便测试的书写。<br>具体匹配器写法详见 <a href="https://github.com/FormidableLabs/enzyme-matchers/tree/master/packages/jest-enzyme" target="_blank" rel="noopener">jest-enzyme</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import App from &apos;./App&apos;;</span><br><span class="line">import Enzyme, &#123;</span><br><span class="line">    shallow,</span><br><span class="line">    mount</span><br><span class="line">&#125; from &apos;enzyme&apos;</span><br><span class="line">import Adapter from &apos;enzyme-adapter-react-16&apos;</span><br><span class="line"></span><br><span class="line">Enzyme.configure(&#123;</span><br><span class="line">    adapter: new Adapter()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">it(&apos;renders without crashing&apos;, () =&gt; &#123;</span><br><span class="line">    const wrapper = shallow( &lt; App / &gt; )</span><br><span class="line">    expect(wrapper).toMatchSnapshot()</span><br><span class="line">    const container = wrapper.find(&apos;[data-test=&quot;container&quot;]&apos;)</span><br><span class="line">    expect(container).toExist()</span><br><span class="line">    expect(container).toHaveProp(&apos;title&apos;, &apos;app&apos;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>分别编写Header和TodoList组件的测试代码：</p>
<h5 id="实战-1"><a href="#实战-1" class="headerlink" title="实战"></a>实战</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">// Header组件</span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import Enzyme, &#123;</span><br><span class="line">    shallow</span><br><span class="line">&#125; from &apos;enzyme&apos;</span><br><span class="line">import Adapter from &apos;enzyme-adapter-react-16&apos;</span><br><span class="line">import Header from &apos;../../components/Header.jsx&apos;</span><br><span class="line">Enzyme.configure(&#123;</span><br><span class="line">    adapter: new Adapter()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe(&apos;Header组件&apos;, () =&gt; &#123;</span><br><span class="line">    it(&apos;包含一个input框&apos;, () =&gt; &#123;</span><br><span class="line">        const wrapper = shallow(&lt; Header /&gt;)</span><br><span class="line">        const inputEle = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">        expect(inputEle.length).toBe(1)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(&apos;input初始化应该为空&apos;, () =&gt; &#123;</span><br><span class="line">        const wrapper = shallow(&lt; Header /&gt;)</span><br><span class="line">        const inputEle = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">        expect(inputEle.prop(&apos;value&apos;)).toEqual(&apos;&apos;)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(&apos;当用户输入时，input内容应相应变化&apos;, () =&gt; &#123;</span><br><span class="line">        const wrapper = shallow(&lt; Header /&gt;)</span><br><span class="line">        const inputEle = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">        const userInput = &apos;learning&apos;</span><br><span class="line">        inputEle.simulate(&apos;change&apos;, &#123;</span><br><span class="line">            target: &#123;</span><br><span class="line">                value: userInput</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        &#123;/* 或者测试数据 */&#125;</span><br><span class="line">        expect(wrapper.state(&apos;value&apos;)).toEqual(userInput)</span><br><span class="line">        &#123;/* 或者测试DOM */&#125;</span><br><span class="line">        const newInputEle = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">        expect(newInputEle.prop(&apos;value&apos;)).toBe(userInput)</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(&apos;input框输入回车时，如果无内容则无操作&apos;, () =&gt; &#123;</span><br><span class="line">        const fn = jest.fn()</span><br><span class="line">        const wrapper = shallow(&lt; Header addUndoItem=&#123;fn&#125; /&gt;)</span><br><span class="line">        const inputEle = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">        wrapper.setState(&#123;</span><br><span class="line">            value: &apos;&apos;</span><br><span class="line">        &#125;)</span><br><span class="line">        inputEle.simulate(&apos;keyup&apos;, &#123;</span><br><span class="line">            keyCode: 13</span><br><span class="line">        &#125;)</span><br><span class="line">        expect(fn).not().toHaveBeenCalled()</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(&apos;input框输入回车时，如果有内容则调用添加函数&apos;, () =&gt; &#123;</span><br><span class="line">        const fn = jest.fn()</span><br><span class="line">        const wrapper = shallow(&lt; Header addUndoItem=&#123;fn&#125; /&gt;)</span><br><span class="line">        const inputEle = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">        const userInput = &apos;hhhhhh&apos;</span><br><span class="line">        wrapper.setState(&#123;</span><br><span class="line">            value: userInput</span><br><span class="line">        &#125;)</span><br><span class="line">        inputEle.simulate(&apos;keyup&apos;, &#123;</span><br><span class="line">            keyCode: 13</span><br><span class="line">        &#125;)</span><br><span class="line">        expect(fn).toHaveBeenCalled()</span><br><span class="line">        expect(fn).toHaveBeenLastCalledWith(userInput)</span><br><span class="line">        const newInputEle = wrapper.find(&apos;[data-test=&quot;input&quot;]&apos;)</span><br><span class="line">        expect(newInputEle.prop(&apos;value&apos;)).toBe(&apos;&apos;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// TodoList组件</span><br><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import Enzyme, &#123;</span><br><span class="line">    shallow</span><br><span class="line">&#125; from &apos;enzyme&apos;</span><br><span class="line">import Adapter from &apos;enzyme-adapter-react-16&apos;</span><br><span class="line">import Todolist from &apos;../../index.jsx&apos;</span><br><span class="line">Enzyme.configure(&#123;</span><br><span class="line">    adapter: new Adapter()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">describe(&apos;Todolistr组件&apos;, () =&gt; &#123;</span><br><span class="line">    it(&apos;初始化列表为空&apos;, () =&gt; &#123;</span><br><span class="line">        const wrapper = shallow(&lt;Todolist /&gt;)</span><br><span class="line">        expect(wrapper.state(&apos;undoList&apos;)).toEqual([])</span><br><span class="line">    &#125;)</span><br><span class="line">    it(&apos;应该给header传递增加undoList的方法&apos;, () =&gt; &#123;</span><br><span class="line">        const wrapper = shallow(&lt;Todolist /&gt;)</span><br><span class="line">        const header = wrapper.find(&apos;Header&apos;)</span><br><span class="line">        expect(header.prop(&apos;addUndoItem&apos;)).toBe(wrapper.instance.addUndoItem)</span><br><span class="line">    &#125;)</span><br><span class="line">    it(&apos;header回车时，undoList应该新增内容&apos;, () =&gt; &#123;</span><br><span class="line">        const wrapper = shallow(&lt;Todolist /&gt;)</span><br><span class="line">        const header = wrapper.find(&apos;Header&apos;)</span><br><span class="line">        const addFunc = header.prop(&apos;addUndoItem&apos;)</span><br><span class="line">        const userInput = &apos;learning makes me happy&apos;</span><br><span class="line">        addFunc(userInput)</span><br><span class="line">        expect(wrapper.state(&apos;undoList&apos;).length).toBe(1)</span><br><span class="line">        expect(wrapper.state(&apos;undoList&apos;)[0]).toBe(userInput)</span><br><span class="line">        addFunc(userInput)</span><br><span class="line">        expect(wrapper.state(&apos;undoList&apos;).length).toBe(2)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>提取enzyme通用配置，需要在jest.config.js中进行配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// test.setup.js</span><br><span class="line">import Enzyme from &apos;enzyme&apos;</span><br><span class="line">import Adapter from &apos;enzyme-adapter-react-16&apos;</span><br><span class="line">Enzyme.configure(&#123;</span><br><span class="line">    adapter: new Adapter()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// jest.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  &quot;setupFilesAfterEnv&quot;: [</span><br><span class="line">     &apos;./node_modules/jest-enzyme/lib/index.js&apos;, </span><br><span class="line">     //这里是新增的js文件</span><br><span class="line">     &apos;&lt;rootDir&gt;/src/utils/test.setup.js&apos;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2019/09/16/jest详解/&title=《前端自动化测试——jest必会》 — blog&pic=/images/banner.jpg" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://localhost:4000/2019/09/16/jest详解/&title=《前端自动化测试——jest必会》 — blog&source=一个专注web开发技术的网站" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2019/09/16/jest详解/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《前端自动化测试——jest必会》 — blog&url=http://localhost:4000/2019/09/16/jest详解/&via=http://localhost:4000" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://localhost:4000/2019/09/16/jest详解/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://localhost:4000/2019/09/16/jest详解/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#简介"><span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#jest语法基础"><span class="post-toc-text">jest语法基础</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#常用匹配器"><span class="post-toc-text">常用匹配器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#模式切换"><span class="post-toc-text">模式切换</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#异步处理"><span class="post-toc-text">异步处理</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#钩子函数"><span class="post-toc-text">钩子函数</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#分组"><span class="post-toc-text">分组</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#mock文件"><span class="post-toc-text">mock文件</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#mock定时器"><span class="post-toc-text">mock定时器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#snapshot"><span class="post-toc-text">snapshot</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#测试ES6中的类"><span class="post-toc-text">测试ES6中的类</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#DOM节点操作"><span class="post-toc-text">DOM节点操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#自动化测试介绍"><span class="post-toc-text">自动化测试介绍</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#TDD-vs-BDD"><span class="post-toc-text">TDD vs BDD</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#单元测试-vs-集成测试"><span class="post-toc-text">单元测试 vs 集成测试</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#前端自动化测试的优势"><span class="post-toc-text">前端自动化测试的优势</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#vue项目自动化测试"><span class="post-toc-text">vue项目自动化测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#vue环境下配置jest"><span class="post-toc-text">vue环境下配置jest</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#vue-test-utils的配置和使用"><span class="post-toc-text">vue-test-utils的配置和使用</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#实战"><span class="post-toc-text">实战</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#react项目自动化测试"><span class="post-toc-text">react项目自动化测试</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#react环境下配置jest"><span class="post-toc-text">react环境下配置jest</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#安装enzyme"><span class="post-toc-text">安装enzyme</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#实战-1"><span class="post-toc-text">实战</span></a></li></ol></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/2019/09/18/接口测试与数据模拟/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          接口测试与数据模拟
        
      </span>
    </a>
  
  
    <a href="/2019/08/12/tts功能开发上遇到的坑/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">tts功能开发上遇到的坑</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2020 Yang Pei<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
    var mihoConfig = {
        root: "http://localhost:4000",
        animate: "false" ,
        isHome: "false" ,
        share: "true"
    }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/AI/">AI</a><a class="category-link" href="/categories/前端/">前端</a><a class="category-link" href="/categories/计算机/">计算机</a><a class="category-link" href="/categories/语言/">语言</a>
        </div>
        <div id="sidebar-menu-box-tags">
            
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            
        </div>
    </div>
</div>
    <div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
    <script src="/js/search.js"></script>
        <script src="/js/main.js"></script>

            
                <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
                <div id="particles"></div>
                <script src="/js/particles.js"></script>
                    

                        

                                

                                                
                                                                
                                                                    <script src="/js/pop-img.js"></script>
                                                                        <script>
                                                                            $(".article-entry p img").popImg();
                                                                        </script>
                                                                        
  </div>
</body>
</html>