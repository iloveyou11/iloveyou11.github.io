<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <title>从零搭建react环境 | blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="YP's Blog">
  
  <meta name="description" content="目前react、vue项目都提供了对应的脚手架工具，让大家都能够轻易地创建项目，直接进行开发，省去了繁琐的打包配置问题。但是，这些脚手架生成的初始化项目中，到底做了哪些工作呢？这些webpack配置、性能优化等等知识都是前端工程师学习发展路上需要掌握的内容。因此我们是有必要学会不依靠脚手架工具亲自搭建vue、react项目环境的。">
<meta name="keywords" content="web">
<meta property="og:type" content="article">
<meta property="og:title" content="从零搭建react环境">
<meta property="og:url" content="http://localhost:4000/2019/10/30/从0搭建react环境/index.html">
<meta property="og:site_name" content="blog">
<meta property="og:description" content="目前react、vue项目都提供了对应的脚手架工具，让大家都能够轻易地创建项目，直接进行开发，省去了繁琐的打包配置问题。但是，这些脚手架生成的初始化项目中，到底做了哪些工作呢？这些webpack配置、性能优化等等知识都是前端工程师学习发展路上需要掌握的内容。因此我们是有必要学会不依靠脚手架工具亲自搭建vue、react项目环境的。">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-07-17T05:00:04.369Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="从零搭建react环境">
<meta name="twitter:description" content="目前react、vue项目都提供了对应的脚手架工具，让大家都能够轻易地创建项目，直接进行开发，省去了繁琐的打包配置问题。但是，这些脚手架生成的初始化项目中，到底做了哪些工作呢？这些webpack配置、性能优化等等知识都是前端工程师学习发展路上需要掌握的内容。因此我们是有必要学会不依靠脚手架工具亲自搭建vue、react项目环境的。">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">YP&#39;s Blog</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>主页</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>全部</span>
                    </a>
                    
                    <a  href="/categories/AI/">
                        <i class="fa fa-AI"></i>
                        <span>AI</span>
                    </a>
                    
                    <a  href="/categories/前端/">
                        <i class="fa fa-前端"></i>
                        <span>前端</span>
                    </a>
                    
                    <a  href="/categories/计算机/">
                        <i class="fa fa-计算机"></i>
                        <span>计算机</span>
                    </a>
                    
                    <a  href="/categories/语言/">
                        <i class="fa fa-语言"></i>
                        <span>语言</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        YP&#39;s Blog
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个专注前端智能化开发的技术博客
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="Blog" target="_blank" href="https://iloveyou11.github.io/">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="https://github.com/iloveyou11">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-从0搭建react环境" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h1 class="post-title" itemprop="name">
      从零搭建react环境
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/前端/">前端</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2019-10-30
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

                    
            </header>
            
                <div class="article-entry post-content" itemprop="articleBody">
                    
                            
                                
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-webpack"><span class="toc-text">1. webpack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-babel"><span class="toc-text">2. babel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-react"><span class="toc-text">3. react</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-react-router"><span class="toc-text">4. react-router</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-webpack-dev-server"><span class="toc-text">5. webpack-dev-server</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-模块热更新（HMR）"><span class="toc-text">6. 模块热更新（HMR）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-redux"><span class="toc-text">7. redux</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-异步action"><span class="toc-text">8. 异步action</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-devtool优化"><span class="toc-text">9. devtool优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-编译css"><span class="toc-text">10. 编译css</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-编译图片"><span class="toc-text">11. 编译图片</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-按需加载"><span class="toc-text">12. 按需加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-缓存"><span class="toc-text">13. 缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-HtmlWebpackPlugin"><span class="toc-text">14. HtmlWebpackPlugin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-提取公共代码"><span class="toc-text">15. 提取公共代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-生产坏境构建"><span class="toc-text">16. 生产坏境构建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17-文件压缩"><span class="toc-text">17. 文件压缩</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18-指定环境"><span class="toc-text">18. 指定环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19-优化缓存"><span class="toc-text">19. 优化缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#20-public-path"><span class="toc-text">20. public path</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#21-打包优化"><span class="toc-text">21. 打包优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#22-抽取css"><span class="toc-text">22. 抽取css</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-axios和middleware"><span class="toc-text">23. axios和middleware</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#24-合并提取公共配置"><span class="toc-text">24. 合并提取公共配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#25-增加404页面"><span class="toc-text">25. 增加404页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#26-polyfill"><span class="toc-text">26. polyfill</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#27-集成PostCSS"><span class="toc-text">27. 集成PostCSS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#28-redux-模块热替换配置"><span class="toc-text">28. redux 模块热替换配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#29-模拟AJAX数据Mock-js"><span class="toc-text">29. 模拟AJAX数据Mock.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#30-使用-CSS-Modules"><span class="toc-text">30. 使用 CSS Modules</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#31-json-server"><span class="toc-text">31. json-server</span></a></li></ol>
    </div>
    
                                    <p>目前react、vue项目都提供了对应的脚手架工具，让大家都能够轻易地创建项目，直接进行开发，省去了繁琐的打包配置问题。但是，这些脚手架生成的初始化项目中，到底做了哪些工作呢？这些webpack配置、性能优化等等知识都是前端工程师学习发展路上需要掌握的内容。因此我们是有必要学会不依靠脚手架工具亲自搭建vue、react项目环境的。</p>
<a id="more"></a>

<p>以下内容均来自：brickspert的<a href="https://github.com/brickspert/blog/issues/1" target="_blank" rel="noopener">《从零搭建React全家桶框架教程》</a>，详细内容点击原文链接进行阅读。</p>
<h4 id="1-webpack"><a href="#1-webpack" class="headerlink" title="1. webpack"></a>1. webpack</h4><p><code>npm init</code>初始化项目，安装webpack<code>npm install --save-dev webpack@3</code>，新建<code>webpack.dev.config.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: path.join(__dirname, <span class="string">'./src/index.js'</span>),</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>src/index.js</code>随便写入一串js代码用来测试：<code>document.getElementById(&#39;app&#39;).innerHTML = &quot;Webpack works&quot;</code></p>
<p>在<code>package.json</code>中写入打包命令：<code>&quot;dev&quot;: &quot;webpack --config webpack.dev.config.js&quot;</code>，运行<code>npm run dev</code>观察是否打包成功。</p>
<p>在dist目录下新建<code>index.html</code>，引入<code>bundle.js</code>，打开<code>index.html</code>，观察js是否执行成功。</p>
<h4 id="2-babel"><a href="#2-babel" class="headerlink" title="2. babel"></a>2. babel</h4><p>配置babel，可以用ES6、 ES7等来编写代码，Babel会把他们统统转为ES5</p>
<p>几个常用babel库：</p>
<ul>
<li>babel-core 调用Babel的API进行转码</li>
<li>babel-loader</li>
<li>babel-preset-es2015 用于解析 ES6</li>
<li>babel-preset-react 用于解析 JSX</li>
<li>babel-preset-stage-0 用于解析 ES7 提案</li>
</ul>
<p><code>babel-preset-state-0,babel-preset-state-1,babel-preset-state-2,babel-preset-state-3</code>有什么区别？每一级包含上一级的功能，比如 state-0包含state-1的功能，以此类推。state-0功能最全。</p>
<p>依次安装这些库：<code>npm install --save-dev babel-core babel-loader babel-preset-es2015 babel-preset-react babel-preset-stage-0</code></p>
<p>新建<code>.babelrc</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [</span><br><span class="line">      &quot;es2015&quot;,</span><br><span class="line">      &quot;react&quot;,</span><br><span class="line">      &quot;stage-0&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;plugins&quot;: []</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>修改webpack.dev.config.js，增加babel-loader:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*src文件夹下面的以.js结尾的文件，要使用babel解析*/</span></span><br><span class="line"><span class="comment">/*cacheDirectory是用来缓存编译结果，下次编译加速*/</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">            use: [<span class="string">'babel-loader?cacheDirectory=true'</span>],</span><br><span class="line">            include: path.join(__dirname, <span class="string">'src'</span>)</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在js中就可以放心地写es6、es7、jsx的代码了，可以测试一下~</p>
<h4 id="3-react"><a href="#3-react" class="headerlink" title="3. react"></a>3. react</h4><p>安装依赖包<code>npm install --save react react-dom</code></p>
<p>接下来编写测试文件：</p>
<p>src/Hello.jsx:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;hello&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>src/index.jsx:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">'./Hello.jsx'</span></span><br><span class="line"></span><br><span class="line">ReactDom.render(</span><br><span class="line">    &lt;Hello /&gt;,</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>注意此时要检查webpack配置，其中entry是否为<code>index.jsx</code>,babel编译的文件应该支持js和jsx……否则会打包失败。</p>
<h4 id="4-react-router"><a href="#4-react-router" class="headerlink" title="4. react-router"></a>4. react-router</h4><p>安装依赖包<code>npm install --save react-router-dom</code>，在src下新建<code>router/router.js</code>:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Switch, Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'../pages/Home'</span></span><br><span class="line"><span class="keyword">import</span> User <span class="keyword">from</span> <span class="string">'../pages/User'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getRouter = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;<span class="xml"><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">"/"</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        &lt;li&gt;&lt;Link to="/u</span>ser<span class="string">"&gt;用户&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">      &lt;/ul&gt;</span></span><br><span class="line"><span class="string">      &lt;Switch&gt;</span></span><br><span class="line"><span class="string">        &lt;Route exact path="</span>/<span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path="</span>/user<span class="string">" component=&#123;User&#125; /&gt;</span></span><br><span class="line"><span class="string">      &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/Router&gt;</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default getRouter;</span></span><br></pre></td></tr></table></figure>

<p>对应的两个组件简单写一下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Home.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;Home&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ User.jsx</span></span><br><span class="line"><span class="regexp">import React, &#123; Component &#125; from 'react'</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default class User extends Component &#123;</span></span><br><span class="line"><span class="regexp">  render() &#123;</span></span><br><span class="line"><span class="regexp">    return (</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;User&lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改index.jsx:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> getRouter <span class="keyword">from</span> <span class="string">'./router/router'</span>;</span><br><span class="line"></span><br><span class="line">ReactDom.render(</span><br><span class="line">  getRouter(),</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>注意：以上的代码import引入的时候都省略了后缀名.jsx，支持这种省略是需要在webpack中进行配置的，添加extensions即可，我们还可以配置alias别名：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">'.js'</span>, <span class="string">'.jsx'</span>, <span class="string">'.json'</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">        pages: path.join(__dirname, <span class="string">'src/pages'</span>),</span><br><span class="line">        component: path.join(__dirname, <span class="string">'src/component'</span>),</span><br><span class="line">        router: path.join(__dirname, <span class="string">'src/router'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来打包测试页面，点击没有反应，为什么呢？因为file这种路径，不是我们想象中的路由那样的路径<a href="http://localhost:3000~我们需要配置一个简单的WEB服务器，有下面两种方法来实现：">http://localhost:3000~我们需要配置一个简单的WEB服务器，有下面两种方法来实现：</a></p>
<ul>
<li>Nginx, Apache, IIS等配置启动一个简单的的WEB服务器</li>
<li>使用webpack-dev-server来配置启动WEB服务器</li>
</ul>
<h4 id="5-webpack-dev-server"><a href="#5-webpack-dev-server" class="headerlink" title="5. webpack-dev-server"></a>5. webpack-dev-server</h4><p>安装<code>npm install webpack-dev-server@2 --save-dev</code>，修改webpack配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    port: <span class="number">3000</span>,</span><br><span class="line">    contentBase: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    historyApiFallback: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改script命令：<code>&quot;dev&quot;: &quot;webpack-dev-server --config webpack.dev.config.js --color --progress&quot;</code>，运行<code>npm run dev</code>即可。</p>
<p><strong>devServer配置项</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">contentBase：URL的根目录。如果不设定的话，默认指向项目根目录</span><br><span class="line">color（CLI only） console中打印彩色日志</span><br><span class="line">historyApiFallback 任意的404响应都被替代为index.html。有什么用呢？你现在运行</span><br><span class="line">npm start，然后打开浏览器，访问http://localhost:8080,然后点击Page1到链接http://localhost:8080/page1，</span><br><span class="line">然后刷新页面试试。是不是发现刷新后404了。为什么？dist文件夹里面并没有page1.html,当然会404了，所以我们需要配置</span><br><span class="line">historyApiFallback，让所有的404定位到index.html。</span><br><span class="line">host 指定一个host,默认是localhost。如果你希望服务器外部可以访问，指定如下：host: &quot;0.0.0.0&quot;。比如你用手机通过IP访问。</span><br><span class="line">hot 启用Webpack的模块热替换特性。</span><br><span class="line">port 配置要监听的端口。默认就是我们现在使用的8080端口。</span><br><span class="line">proxy 代理</span><br><span class="line">progress（CLI only） 将编译进度输出到控制台</span><br></pre></td></tr></table></figure>

<h4 id="6-模块热更新（HMR）"><a href="#6-模块热更新（HMR）" class="headerlink" title="6. 模块热更新（HMR）"></a>6. 模块热更新（HMR）</h4><p>模块热更新：当我们修改代码的时候，浏览器会自动刷新</p>
<p>首先，修改命令行添加hot参数：<code>&quot;dev&quot;: &quot;webpack-dev-server --config webpack.dev.config.js --color --progress --hot&quot;</code></p>
<p>src/index.js 增加module.hot.accept()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> getRouter <span class="keyword">from</span> <span class="string">'./router/router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDom.render(</span><br><span class="line">    getRouter(), </span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>接下来，我们打开对应地址，修改jsx文件，发现页面也自动刷新了，有点惊喜。目前还有一种热更新的方法，但是较为麻烦一些，了解一下也可以：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line">devServer: &#123;</span><br><span class="line">    hot: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">plugins:[</span><br><span class="line">     <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>如何保存react中state的状态？</strong></p>
<p>虽然目前实现了热更新功能，But！上面的配置对react模块的支持不是很好，当模块热替换的时候，state会重置，这不是我们想要的。为了在react模块更新的同时，能保留state等页面中其他状态，我们需要引入react-hot-loader~</p>
<p>安装依赖：<code>npm install react-hot-loader@next --save-dev</code></p>
<p>.babelrc 增加 react-hot-loader/babel</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    <span class="string">"es2015"</span>,</span><br><span class="line">    <span class="string">"react"</span>,</span><br><span class="line">    <span class="string">"stage-0"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"plugins"</span>: [</span><br><span class="line">    <span class="string">"react-hot-loader/babel"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack.dev.config.js入口增加react-hot-loader/patch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">entry: [</span><br><span class="line">    <span class="string">'react-hot-loader/patch'</span>,</span><br><span class="line">    path.join(__dirname, <span class="string">'src/index.jsx'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>src/index.js修改如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;AppContainer&#125; <span class="keyword">from</span> <span class="string">'react-hot-loader'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> getRouter <span class="keyword">from</span> <span class="string">'./router/router'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*初始化*/</span></span><br><span class="line">renderWithHotReload(getRouter());</span><br><span class="line"></span><br><span class="line"><span class="comment">/*热更新*/</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">'./router/router'</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> getRouter = <span class="built_in">require</span>(<span class="string">'./router/router'</span>).default;</span><br><span class="line">        renderWithHotReload(getRouter());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderWithHotReload</span>(<span class="params">RootElement</span>) </span>&#123;</span><br><span class="line">    ReactDom.render(</span><br><span class="line">        &lt;AppContainer&gt;</span><br><span class="line">            &#123;RootElement&#125;</span><br><span class="line">        &lt;<span class="regexp">/AppContainer&gt;,</span></span><br><span class="line"><span class="regexp">        document.getElementById('app')</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>现在，执行<code>npm run dev</code>。修改页面的时候，state不更新了。</p>
<h4 id="7-redux"><a href="#7-redux" class="headerlink" title="7. redux"></a>7. redux</h4><p>接下来开始集成redux。<br>先安装redux：<code>npm install --save redux</code></p>
<p>初始化目录结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd src</span><br><span class="line">mkdir redux</span><br><span class="line">cd redux</span><br><span class="line">mkdir actions</span><br><span class="line">mkdir reducers</span><br><span class="line">touch reducers.js</span><br><span class="line">touch store.js</span><br><span class="line">touch actions/counter.js</span><br><span class="line">touch reducers/counter.js</span><br></pre></td></tr></table></figure>

<p>先来写action创建函数。通过action创建函数，可以创建action，<code>src/redux/actions/counter.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INCREMENT = <span class="string">"counter/INCREMENT"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DECREMENT = <span class="string">"counter/DECREMENT"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RESET = <span class="string">"counter/RESET"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">increment</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">type</span>: INCREMENT&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">decrement</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">type</span>: DECREMENT&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">reset</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">type</span>: RESET&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再来写reducer,reducer是一个纯函数，接收action和旧的state,生成新的state.<code>src/redux/reducers/counter.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;INCREMENT, DECREMENT, RESET&#125; <span class="keyword">from</span> <span class="string">'../actions/counter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">    count: <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> INCREMENT:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                count: state.count + <span class="number">1</span></span><br><span class="line">            &#125;;</span><br><span class="line">        <span class="keyword">case</span> DECREMENT:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                count: state.count - <span class="number">1</span></span><br><span class="line">            &#125;;</span><br><span class="line">        <span class="keyword">case</span> RESET:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">count</span>: <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一个项目有很多的reducers,我们要把他们整合到一起,<code>src/redux/reducers.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> counter <span class="keyword">from</span> <span class="string">'./reducers/counter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">combineReducers</span>(<span class="params">state = &#123;&#125;, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        counter: counter(state.counter, action)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>核心思想</strong>：reducer就是纯函数，接收state 和 action，然后返回一个新的 state。</p>
<p><strong>store</strong> 就是把它们联系到一起的对象。store 有以下职责：</p>
<ul>
<li>维持应用的 state；</li>
<li>提供 getState() 方法获取 state；</li>
<li>提供 dispatch(action) 触发reducers方法更新 state；</li>
<li>通过 subscribe(listener) 注册监听器;</li>
<li>通过 subscribe(listener) 返回的函数注销监听器。<br><code>src/redux/store.js</code>：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createStore&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> combineReducers <span class="keyword">from</span> <span class="string">'./reducers.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(combineReducers);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>集成好redux后，我们编写jsx文件，使用redux进行测试。</p>
<p>首先需要安装react-redux，<code>npm install --save react-redux</code>,新建一个页面测试一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;increment, decrement, reset&#125; <span class="keyword">from</span> <span class="string">'actions/counter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;connect&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;div&gt;当前计数为&#123;<span class="keyword">this</span>.props.counter.count&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;() =&gt; this.props.increment()&#125;&gt;自增</span></span><br><span class="line"><span class="regexp">                &lt;/</span>button&gt;</span><br><span class="line">                &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.props.decrement()&#125;&gt;自减</span><br><span class="line">                &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;() =&gt; this.props.reset()&#125;&gt;重置</span></span><br><span class="line"><span class="regexp">                &lt;/</span>button&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">        counter: state.counter</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapDispatchToProps = (dispatch) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">        increment: () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            dispatch(increment())</span></span><br><span class="line"><span class="regexp">        &#125;,</span></span><br><span class="line"><span class="regexp">        decrement: () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            dispatch(decrement())</span></span><br><span class="line"><span class="regexp">        &#125;,</span></span><br><span class="line"><span class="regexp">        reset: () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            dispatch(reset())</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, mapDispatchToProps)(Counter);</span></span><br></pre></td></tr></table></figure>

<p>在<code>src/index.js</code>中引入store，修改部分如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增</span></span><br><span class="line"><span class="keyword">import</span> &#123;Provider&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./redux/store'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderWithHotReload</span>(<span class="params">RootElement</span>) </span>&#123;</span><br><span class="line">    ReactDom.render(</span><br><span class="line">        &lt;AppContainer&gt;</span><br><span class="line">        </span><br><span class="line">            <span class="comment">//新增Provider和store</span></span><br><span class="line">            &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">                &#123;RootElement&#125;</span><br><span class="line">            &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">            </span></span><br><span class="line"><span class="regexp">        &lt;/</span>AppContainer&gt;,</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-异步action"><a href="#8-异步action" class="headerlink" title="8. 异步action"></a>8. 异步action</h4><p>举个栗子：<br><code>src/redux/actions/userInfo.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> GET_USER_INFO_REQUEST = <span class="string">"userInfo/GET_USER_INFO_REQUEST"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> GET_USER_INFO_SUCCESS = <span class="string">"userInfo/GET_USER_INFO_SUCCESS"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> GET_USER_INFO_FAIL = <span class="string">"userInfo/GET_USER_INFO_FAIL"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfoRequest</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type: GET_USER_INFO_REQUEST</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfoSuccess</span>(<span class="params">userInfo</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type: GET_USER_INFO_SUCCESS,</span><br><span class="line">        userInfo: userInfo</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getUserInfoFail</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        type: GET_USER_INFO_FAIL</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">        dispatch(getUserInfoRequest());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fetch(<span class="string">'http://localhost:8080/api/user.json'</span>)</span><br><span class="line">            .then((<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> response.json()</span><br><span class="line">            &#125;))</span><br><span class="line">            .then(<span class="function">(<span class="params">json</span>) =&gt;</span> &#123;</span><br><span class="line">                dispatch(getUserInfoSuccess(json))</span><br><span class="line">            &#125;).catch(</span><br><span class="line">                () =&gt; &#123;</span><br><span class="line">                    dispatch(getUserInfoFail());</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了让action创建函数除了返回action对象外，还可以返回函数，我们需要引用redux-thunk：<code>npm install --save redux-thunk</code>,简单的说，中间件就是action在到达reducer，先经过中间件处理。使用中间件来处理<br>函数形式的action，把他们转为标准的action给reducer。这是redux-thunk的作用。</p>
<p>我们来引入redux-thunk中间件:<code>src/redux/store.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createStore, applyMiddleware&#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunkMiddleware <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> combineReducers <span class="keyword">from</span> <span class="string">'./reducers.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(combineReducers, applyMiddleware(thunkMiddleware));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p>可以编写一个组件验证一下，就不具体展开了。</p>
<p>值得注意的一点是，redux提供了一个combineReducers函数来合并reducer，上述的reducers.js可以通过combinReducers优化，不用我们自己合并，写法更加简单。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineReducers&#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> counter <span class="keyword">from</span> <span class="string">'reducers/counter'</span>;</span><br><span class="line"><span class="keyword">import</span> userInfo <span class="keyword">from</span> <span class="string">'reducers/userInfo'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">    counter,</span><br><span class="line">    userInfo</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="9-devtool优化"><a href="#9-devtool优化" class="headerlink" title="9. devtool优化"></a>9. devtool优化</h4><p>现在有一个问题，代码哪里写错了，浏览器报错只报在build.js第几行。<code>webpack.dev.config.js</code>增加<code>devtool:&#39;inline-source-map&#39;</code>即可。我们在srouce里面能看到我们写的代码，也能打断点调试。</p>
<h4 id="10-编译css"><a href="#10-编译css" class="headerlink" title="10. 编译css"></a>10. 编译css</h4><p>如果需要引入css文件，需要安装css-loader、style-loader，<code>npm install css-loader style-loader --save-dev</code>，并在webpack配置中添加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">   use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过<code>import &#39;xx.css&#39;</code>即可引入css代码了。如果像支持stylus、less、sass等css预处理语言，可以安装相关的依赖包，并在webpack中作相应的配置，这里不再赘述了。</p>
<h4 id="11-编译图片"><a href="#11-编译图片" class="headerlink" title="11. 编译图片"></a>11. 编译图片</h4><p><code>npm install --save-dev url-loader file-loader</code></p>
<p><code>webpack.dev.config.js</code> rules增加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">    use: [&#123;</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            limit: <span class="number">8192</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>options limit 8192意思是，小于等于8K的图片会被转成base64编码，直接插入HTML中，减少HTTP请求。</p>
<p>举个栗子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./Page1.css'</span>;</span><br><span class="line"><span class="keyword">import</span> image <span class="keyword">from</span> <span class="string">'./images/brickpsert.jpg'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Page1</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=<span class="string">"page-box"</span>&gt;</span><br><span class="line">                <span class="keyword">this</span> is page1~</span><br><span class="line">                &lt;img src=&#123;image&#125;/&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>扩充</strong>：webpack引入图片的几种方式？</p>
<ul>
<li>在js 中创建图片来引入</li>
<li>在css中引入background(‘url’)</li>
<li><code>&lt;img src=&quot; &quot; alt=&quot; &quot;&gt;</code></li>
</ul>
<ol>
<li>在js创建图片引入</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./22.jpg'</span>;   <span class="comment">//返回的结果 logo 是一个新的图片的地址</span></span><br><span class="line"><span class="keyword">let</span> image=<span class="keyword">new</span> Image();  <span class="comment">//创建新的图片对象</span></span><br><span class="line">image.src=logo;      <span class="comment">//就是一个普通的字符串</span></span><br><span class="line"><span class="comment">// 将new 的图片插入到body 的后面</span></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(image);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>在css中引入</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//index.css</span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: yellow;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">900px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">800px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'../myImages/11.png'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用<code>&lt;img src=&quot; &quot; alt=&quot; &quot;&gt;</code></p>
</li>
</ol>
<ul>
<li>安装loader:yarn add html-withimg-loader -D</li>
<li>webpack.config.js添加配置</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>:&#123;    </span><br><span class="line">      rules:[ <span class="comment">//规则</span></span><br><span class="line">          &#123;</span><br><span class="line">              test: <span class="regexp">/.css$/</span>,</span><br><span class="line">              use: [<span class="string">"style-loader"</span>,<span class="string">"css-loader"</span>]</span><br><span class="line">          &#125;,</span><br><span class="line">         &#123;    <span class="comment">//使用file-loader 可以图片 嵌入 到css中</span></span><br><span class="line">          test: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">             use: [<span class="string">"file-loader"</span>]</span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">          test: <span class="regexp">/.html$/</span>, <span class="comment">//所有html结尾的文件添加此 loader 处理</span></span><br><span class="line">          use: [<span class="string">"html-withimg-loader"</span>]</span><br><span class="line">         &#125;,</span><br><span class="line">      ]</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>html中引入图片即可： <code>&lt;img src=&quot;../myImages/11.png&quot; alt=&quot;&quot;&gt;</code></p>
<h4 id="12-按需加载"><a href="#12-按需加载" class="headerlink" title="12. 按需加载"></a>12. 按需加载</h4><p>打包完后，所有页面只生成了一个build.js,当我们首屏加载的时候，就会很慢。如果每个页面都打包了自己单独的JS，在进入自己页面的时候才加载对应的js，那首屏加载就会快很多。</p>
<p>在 react-router 2.0时代， 按需加载需要用到的最关键的一个函数，就是require.ensure()，它是按需加载能够实现的核心。在4.0版本，官方放弃了这种处理按需加载的方式，选择了一个更加简洁的处理方式。</p>
<p>安装依赖：<code>npm install bundle-loader --save-dev</code>，在router文件夹下新建bundle.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bundle</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="comment">// short for "module" but that's a keyword in js, so "mod"</span></span><br><span class="line">        mod: <span class="literal">null</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.load(<span class="keyword">this</span>.props)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nextProps.load !== <span class="keyword">this</span>.props.load) &#123;</span><br><span class="line">            <span class="keyword">this</span>.load(nextProps)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    load(props) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            mod: <span class="literal">null</span></span><br><span class="line">        &#125;);</span><br><span class="line">        props.load(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                <span class="comment">// handle both es imports and cjs</span></span><br><span class="line">                mod: mod.default ? mod.default : mod</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.props.children(<span class="keyword">this</span>.state.mod)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Bundle;</span><br></pre></td></tr></table></figure>

<p>改造路由<code>src/router/router.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;BrowserRouter <span class="keyword">as</span> Router, Route, Switch, Link&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Bundle <span class="keyword">from</span> <span class="string">'./Bundle'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'bundle-loader?lazy&amp;name=home!pages/Home/Home'</span>;</span><br><span class="line"><span class="keyword">import</span> Page1 <span class="keyword">from</span> <span class="string">'bundle-loader?lazy&amp;name=page1!pages/Page1/Page1'</span>;</span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">'bundle-loader?lazy&amp;name=counter!pages/Counter/Counter'</span>;</span><br><span class="line"><span class="keyword">import</span> UserInfo <span class="keyword">from</span> <span class="string">'bundle-loader?lazy&amp;name=userInfo!pages/UserInfo/UserInfo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Loading = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createComponent = <span class="function">(<span class="params">component</span>) =&gt;</span> <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">    &lt;Bundle load=&#123;component&#125;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            (Component) =&gt; Component ? <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">Loading</span>/&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &lt;<span class="regexp">/Bundle&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const getRouter = () =&gt; (</span></span><br><span class="line"><span class="regexp">    &lt;Router&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;ul&gt;</span></span><br><span class="line"><span class="regexp">                &lt;li&gt;&lt;Link to="/</span><span class="string">"&gt;首页&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;&lt;Link to="</span>/page1<span class="string">"&gt;Page1&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;&lt;Link to="</span>/counter<span class="string">"&gt;Counter&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">                &lt;li&gt;&lt;Link to="</span>/userinfo<span class="string">"&gt;UserInfo&lt;/Link&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;/ul&gt;</span></span><br><span class="line"><span class="string">            &lt;Switch&gt;</span></span><br><span class="line"><span class="string">                &lt;Route exact path="</span>/<span class="string">" component=&#123;createComponent(Home)&#125;/&gt;</span></span><br><span class="line"><span class="string">                &lt;Route path="</span>/page1<span class="string">" component=&#123;createComponent(Page1)&#125;/&gt;</span></span><br><span class="line"><span class="string">                &lt;Route path="</span>/counter<span class="string">" component=&#123;createComponent(Counter)&#125;/&gt;</span></span><br><span class="line"><span class="string">                &lt;Route path="</span>/userinfo<span class="string">" component=&#123;createComponent(UserInfo)&#125;/&gt;</span></span><br><span class="line"><span class="string">            &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/Router&gt;</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default getRouter;</span></span><br></pre></td></tr></table></figure>

<p>此时，进入新的页面，都会加载自己的JS。为了让输出的js名称更为清晰，可在<code>webpack.dev.config.js</code>加个<code>chunkFilename</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name].js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="13-缓存"><a href="#13-缓存" class="headerlink" title="13. 缓存"></a>13. 缓存</h4><p>每次代码更新后，都需要更新客户端缓存，需要将打包生成的名字设置得不一样，可以在每次打包都用增加hash：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    filename: <span class="string">'[name].[hash].js'</span>,</span><br><span class="line">    chunkFilename: <span class="string">'[name].[chunkhash].js'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But！dist/index.html里面引用js名字还是bundle.js老名字，需要引入新的js文件。但是手动修改真的好吗？</p>
<h4 id="14-HtmlWebpackPlugin"><a href="#14-HtmlWebpackPlugin" class="headerlink" title="14. HtmlWebpackPlugin"></a>14. HtmlWebpackPlugin</h4><p>这个插件，每次会自动把js插入到你的模板index.html里面去。安装依赖包<code>npm install html-webpack-plugin --save-dev</code>。新建模板src/index.html：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改<code>webpack.dev.config.js</code>，增加plugin：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line">    plugins: [<span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'index.html'</span>,</span><br><span class="line">        template: path.join(__dirname, <span class="string">'src/index.html'</span>)</span><br><span class="line">    &#125;)],</span><br></pre></td></tr></table></figure>

<p>目前就可以自动将js插入html页面了。</p>
<h4 id="15-提取公共代码"><a href="#15-提取公共代码" class="headerlink" title="15. 提取公共代码"></a>15. 提取公共代码</h4><p>打包的代码中，有一些是公共库的代码不会改变的，但是，他们合并在bundle.js里面，每次项目发布，重新请求bundle.js的时候，相当于重新请求了，造成了资源浪费。</p>
<p>我们可以把react这些不会改变的公共库提取出来，用户缓存下来。从此以后，用户再也不用下载这些库了，无论是否发布项目。</p>
<p><code>webpack.dev.config.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line">entry: &#123;</span><br><span class="line">    app: [</span><br><span class="line">        <span class="string">'react-hot-loader/patch'</span>,</span><br><span class="line">        path.join(__dirname, <span class="string">'src/index.js'</span>)</span><br><span class="line">    ],</span><br><span class="line">    vendor: [<span class="string">'react'</span>, <span class="string">'react-router-dom'</span>, <span class="string">'redux'</span>, <span class="string">'react-dom'</span>, <span class="string">'react-redux'</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*plugins*/</span></span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">        name: <span class="string">'vendor'</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>把react等库生成打包到vendor.hash.js里面去。</p>
<p>但是你现在可能发现编译生成的文件app.[hash].js和vendor.[hash].js生成的hash一样的，这里是个问题，因为你每次修改代码,都会导致vendor.[hash].js名字改变，那我们提取出来的意义也就没了。其实文档上写的很清楚：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">     path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">     filename: <span class="string">'[name].[hash].js'</span>, <span class="comment">//这里应该用chunkhash替换hash</span></span><br><span class="line">     chunkFilename: <span class="string">'[name].[chunkhash].js'</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>但是，如果用chunkhash，会报错。和webpack-dev-server –hot不兼容。等会我们配置正式版webpack.config.js的时候要解决这个问题。</p>
<h4 id="16-生产坏境构建"><a href="#16-生产坏境构建" class="headerlink" title="16. 生产坏境构建"></a>16. 生产坏境构建</h4><blockquote>
<p>开发环境(development)和生产环境(production)的构建目标差异很大。在开发环境中，我们需要具有强大的、具有实时重新加载(live reloading)或热模块替换(hot module replacement)能力的 source map 和 localhost server。而在生产环境中，我们的目标则转向于关注更小的 bundle，更轻量的 source map，以及更优化的资源，以改善加载时间。由于要遵循逻辑分离，我们通常建议为每个环境编写彼此独立的 webpack 配置。</p>
</blockquote>
<p>新建<code>webpack.config.js</code>:</p>
<p>在<code>webpack.dev.config.js</code>的基础上先做以下几个修改~</p>
<ul>
<li>先删除webpack-dev-server相关的东西~</li>
<li>devtool的值改成cheap-module-source-map</li>
<li>刚才说的hash改成chunkhash</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">var</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    devtool: <span class="string">'cheap-module-source-map'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app: [</span><br><span class="line">            path.join(__dirname, <span class="string">'src/index.js'</span>)</span><br><span class="line">        ],</span><br><span class="line">        vendor: [<span class="string">'react'</span>, <span class="string">'react-router-dom'</span>, <span class="string">'redux'</span>, <span class="string">'react-dom'</span>, <span class="string">'react-redux'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].[chunkhash].js'</span>,</span><br><span class="line">        chunkFilename: <span class="string">'[name].[chunkhash].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            use: [<span class="string">'babel-loader'</span>],</span><br><span class="line">            include: path.join(__dirname, <span class="string">'src'</span>)</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">            use: [&#123;</span><br><span class="line">                loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8192</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'index.html'</span>,</span><br><span class="line">            template: path.join(__dirname, <span class="string">'src/index.html'</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">            name: <span class="string">'vendor'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            pages: path.join(__dirname, <span class="string">'src/pages'</span>),</span><br><span class="line">            component: path.join(__dirname, <span class="string">'src/component'</span>),</span><br><span class="line">            router: path.join(__dirname, <span class="string">'src/router'</span>),</span><br><span class="line">            actions: path.join(__dirname, <span class="string">'src/redux/actions'</span>),</span><br><span class="line">            reducers: path.join(__dirname, <span class="string">'src/redux/reducers'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>设置脚本：<code>&quot;build&quot;:&quot;webpack --config webpack.config.js&quot;</code>即可打包为生产环境。</p>
<h4 id="17-文件压缩"><a href="#17-文件压缩" class="headerlink" title="17. 文件压缩"></a>17. 文件压缩</h4><p>webpack使用UglifyJSPlugin来压缩生成的文件。<code>npm i --save-dev uglifyjs-webpack-plugin</code></p>
<p><code>webpack.config.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> UglifyJSPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>npm run build</code>发现打包文件大小减小了好多。</p>
<h4 id="18-指定环境"><a href="#18-指定环境" class="headerlink" title="18. 指定环境"></a>18. 指定环境</h4><blockquote>
<p>许多 library 将通过与 process.env.NODE_ENV 环境变量关联，以决定 library 中应该引用哪些内容。例如，当不处于生产环境中时，某些 library 为了使调试变得容易，可能会添加额外的日志记录(log)和测试(test)。其实，当使用 process.env.NODE_ENV === ‘production’ 时，一些 library 可能针对具体用户的环境进行代码优化，从而删除或添加一些重要代码。我们可以使用 webpack 内置的 DefinePlugin 为所有的依赖定义这个变量：</p>
</blockquote>
<p><code>webpack.config.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins: [</span><br><span class="line">       <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">          <span class="string">'process.env'</span>: &#123;</span><br><span class="line">              <span class="string">'NODE_ENV'</span>: <span class="built_in">JSON</span>.stringify(<span class="string">'production'</span>)</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>npm run build</code>后发现vendor.[hash].js又变小了。</p>
<h4 id="19-优化缓存"><a href="#19-优化缓存" class="headerlink" title="19. 优化缓存"></a>19. 优化缓存</h4><p>但是现在有一个问题。你随便修改代码一处，例如Home.js，随便改变个字，你发现home.xxx.js名字变化的同时，<br>vendor.xxx.js名字也变了。这不行啊。这和没拆分不是一样一样了吗？我们本意是vendor.xxx.js<br>名字永久不变，一直缓存在用户本地的。官方文档推荐了一个插件HashedModuleIdsPlugin:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> webpack.HashedModuleIdsPlugin()</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>还要加一个runtime代码抽取:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">'runtime'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>，引入顺序在这里很重要。CommonsChunkPlugin 的 ‘vendor’ 实例，必须在 ‘runtime’ 实例之前引入。</p>
<h4 id="20-public-path"><a href="#20-public-path" class="headerlink" title="20. public path"></a>20. public path</h4><p>想象一个场景，我们的静态文件放在了单独的静态服务器上去了，那我们打包的时候，如何让静态文件的链接定位到静态服务器呢？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">output: &#123;</span><br><span class="line">    publicPath : <span class="string">'/'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="21-打包优化"><a href="#21-打包优化" class="headerlink" title="21. 打包优化"></a>21. 打包优化</h4><p>现在打开dist，是不是发现好多好多文件，每次打包后的文件在这里混合了？我们希望每次打包前自动清理下dist文件。<code>npm install clean-webpack-plugin --save-dev</code><br><code>webpack.config.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> CleanWebpackPlugin =<span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line">plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist'</span>])</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="22-抽取css"><a href="#22-抽取css" class="headerlink" title="22. 抽取css"></a>22. 抽取css</h4><p>目前我们的css是直接打包进js里面的，我们希望能单独生成css文件。<code>npm install --save-dev extract-text-webpack-plugin</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">          fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">          use: <span class="string">"css-loader"</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">     <span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line">         filename: <span class="string">'[name].[contenthash:5].css'</span>,</span><br><span class="line">         allChunks: <span class="literal">true</span></span><br><span class="line">     &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="23-axios和middleware"><a href="#23-axios和middleware" class="headerlink" title="23. axios和middleware"></a>23. axios和middleware</h4><p><code>npm install --save axios</code></p>
<h4 id="24-合并提取公共配置"><a href="#24-合并提取公共配置" class="headerlink" title="24. 合并提取公共配置"></a>24. 合并提取公共配置</h4><p>想象一个场景，现在我想给webpack增加一个css modules依赖，你会发现，既要修改webpack.dev.config.js，又要修改webpack.config.js。</p>
<p>所以我们要把公共的配置文件提取出来。提取到webpack.common.config.js里面。webpack.dev.config.js和webpack.config.js写自己的特殊的配置。</p>
<p>这里我们需要用到webpack-merge来合并公共配置和单独的配置。<code>npm install --save-dev webpack-merge</code></p>
<p>webpack.common.config.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"></span><br><span class="line">commonConfig = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app: [</span><br><span class="line">            path.join(__dirname, <span class="string">'src/index.js'</span>)</span><br><span class="line">        ],</span><br><span class="line">        vendor: [<span class="string">'react'</span>, <span class="string">'react-router-dom'</span>, <span class="string">'redux'</span>, <span class="string">'react-dom'</span>, <span class="string">'react-redux'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].[chunkhash].js'</span>,</span><br><span class="line">        chunkFilename: <span class="string">'[name].[chunkhash].js'</span>,</span><br><span class="line">        publicPath: <span class="string">"/"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            use: [<span class="string">'babel-loader?cacheDirectory=true'</span>],</span><br><span class="line">            include: path.join(__dirname, <span class="string">'src'</span>)</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            test: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">            use: [&#123;</span><br><span class="line">                loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                options: &#123;</span><br><span class="line">                    limit: <span class="number">8192</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'index.html'</span>,</span><br><span class="line">            template: path.join(__dirname, <span class="string">'src/index.html'</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> webpack.HashedModuleIdsPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">            name: <span class="string">'vendor'</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">            name: <span class="string">'runtime'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            pages: path.join(__dirname, <span class="string">'src/pages'</span>),</span><br><span class="line">            components: path.join(__dirname, <span class="string">'src/components'</span>),</span><br><span class="line">            router: path.join(__dirname, <span class="string">'src/router'</span>),</span><br><span class="line">            actions: path.join(__dirname, <span class="string">'src/redux/actions'</span>),</span><br><span class="line">            reducers: path.join(__dirname, <span class="string">'src/redux/reducers'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = commonConfig;</span><br></pre></td></tr></table></figure>

<p>webpack.dev.config.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">'./webpack.common.config.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> devConfig = &#123;</span><br><span class="line">    devtool: <span class="string">'inline-source-map'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        app: [</span><br><span class="line">            <span class="string">'react-hot-loader/patch'</span>,</span><br><span class="line">            path.join(__dirname, <span class="string">'src/index.js'</span>)</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        <span class="comment">/*这里本来应该是[chunkhash]的，但是由于[chunkhash]和react-hot-loader不兼容。只能妥协*/</span></span><br><span class="line">        filename: <span class="string">'[name].[hash].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: path.join(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">        historyApiFallback: <span class="literal">true</span>,</span><br><span class="line">        host: <span class="string">'0.0.0.0'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(&#123;</span><br><span class="line">    customizeArray(a, b, key) &#123;</span><br><span class="line">        <span class="comment">/*entry.app不合并，全替换*/</span></span><br><span class="line">        <span class="keyword">if</span> (key === <span class="string">'entry.app'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> b;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(commonConfig, devConfig);</span><br></pre></td></tr></table></figure>

<p>webpack.config.js（也就是webpack.config.prod.js）：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">'uglifyjs-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig = <span class="built_in">require</span>(<span class="string">'./webpack.common.config.js'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> publicConfig = &#123;</span><br><span class="line">    devtool: <span class="string">'cheap-module-source-map'</span>,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">                fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">                use: <span class="string">"css-loader"</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin([<span class="string">'dist/*.*'</span>]),</span><br><span class="line">        <span class="keyword">new</span> UglifyJSPlugin(),</span><br><span class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">            <span class="string">'process.env'</span>: &#123;</span><br><span class="line">                <span class="string">'NODE_ENV'</span>: <span class="built_in">JSON</span>.stringify(<span class="string">'production'</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'[name].[contenthash:5].css'</span>,</span><br><span class="line">            allChunks: <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(commonConfig, publicConfig);</span><br></pre></td></tr></table></figure>

<h4 id="25-增加404页面"><a href="#25-增加404页面" class="headerlink" title="25. 增加404页面"></a>25. 增加404页面</h4><ul>
<li>新建pages/NotFound/NotFound组件。</li>
<li>修改router/router.js，增加404</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> NotFound <span class="keyword">from</span> <span class="string">'bundle-loader?lazy&amp;name=notFound!pages/NotFound/NotFound'</span>;</span><br><span class="line">&lt;Route component=&#123;createComponent(NotFound)&#125;/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="26-polyfill"><a href="#26-polyfill" class="headerlink" title="26. polyfill"></a>26. polyfill</h4><p><strong>babel-plugin-transform-runtime</strong></p>
<blockquote>
<p>在转换 ES2015 语法为 ECMAScript 5 的语法时，babel 会需要一些辅助函数，例如 _extend。babel 默认会将这些辅助函数内联到每一个 js 文件里，这样文件多的时候，项目就会很大。<br>所以 babel 提供了 transform-runtime 来将这些辅助函数“搬”到一个单独的模块 babel-runtime 中，这样做能减小项目文件的大小。</p>
</blockquote>
<p><code>npm install --save-dev babel-plugin-transform-runtime</code></p>
<p>修改<code>.babelrc</code>配置文件,增加配置:</p>
<p>.babelrc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;plugins&quot;: [</span><br><span class="line">  &quot;transform-runtime&quot;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>babel-polyfill</strong></p>
<blockquote>
<p>Babel默认只转换新的JavaScript句法（syntax），而不转换新的API，比如Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise等全局对象，以及一些定义在全局对象上的方法（比如Object.assign）都不会转码。<br>举例来说，ES6在Array对象上新增了Array.from方法。Babel就不会转码这个方法。如果想让这个方法运行，必须使用babel-polyfill，为当前环境提供一个垫片。</p>
</blockquote>
<p><code>npm install --save-dev babel-polyfill</code></p>
<p>修改webpack两个配置文件:</p>
<p>webpack.common.config.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app: [</span><br><span class="line">    <span class="string">"babel-polyfill"</span>,</span><br><span class="line">    path.join(__dirname, <span class="string">'src/index.js'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>webpack.dev.config.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app: [</span><br><span class="line">    <span class="string">'babel-polyfill'</span>,</span><br><span class="line">    <span class="string">'react-hot-loader/patch'</span>,</span><br><span class="line">    path.join(__dirname, <span class="string">'src/index.js'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="27-集成PostCSS"><a href="#27-集成PostCSS" class="headerlink" title="27. 集成PostCSS"></a>27. 集成PostCSS</h4><p>Autoprefixer这个插件,可以自动给css属性加浏览器前缀。postcss-cssnext 允许你使用未来的 CSS 特性（包括 autoprefixer）</p>
<p>当然，它有很多很多的插件可以用，你可以去官网详细了解。我们今天只用postcss-cssnext。（它包含了autoprefixer）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -D  postcss-loader</span><br><span class="line">npm install -D  postcss-cssnext</span><br></pre></td></tr></table></figure>

<p>修改webpack配置文件,增加postcss-loader:<br>webpack.dev.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.(css|scss)$/</span>,</span><br><span class="line">    use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"postcss-loader"</span>]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>webpack.config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rules: [&#123;</span><br><span class="line">    test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">    use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">        fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">        use: [<span class="string">"css-loader"</span>, <span class="string">"postcss-loader"</span>]</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure>

<p>新建postcss.config.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: &#123;</span><br><span class="line">        <span class="string">'postcss-cssnext'</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>目前已完成了css自动添加前缀。</p>
<h4 id="28-redux-模块热替换配置"><a href="#28-redux-模块热替换配置" class="headerlink" title="28. redux 模块热替换配置"></a>28. redux 模块热替换配置</h4><p>当修改reducer代码的时候，页面会整个刷新，而不是局部刷新。代码修改起来也简单,增加一段监听reducers变化，并替换的代码。<br>src/redux/store.js：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="string">"./reducers"</span>, () =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> nextCombineReducers = <span class="built_in">require</span>(<span class="string">"./reducers"</span>).default;</span><br><span class="line">        store.replaceReducer(nextCombineReducers);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="29-模拟AJAX数据Mock-js"><a href="#29-模拟AJAX数据Mock-js" class="headerlink" title="29. 模拟AJAX数据Mock.js"></a>29. 模拟AJAX数据Mock.js</h4><p>Mock.js：拦截AJAX请求，返回需要的数据！<code>npm install mockjs --save-dev</code></p>
<p>我们可以新建mock文件夹，在内部写模拟的接口数据user.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Mock <span class="keyword">from</span> <span class="string">'mockjs'</span>;</span><br><span class="line"><span class="keyword">let</span> Random = Mock.Random;</span><br><span class="line">Mock.mock(<span class="string">'/api/user'</span>, &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'@cname'</span>,</span><br><span class="line">    <span class="string">'intro'</span>: <span class="string">'@word(20)'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可以在其他页面引入使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (MOCK) &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">'mock/mock'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack.common.config.js配置mock目录别名：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">        ...</span><br><span class="line">        mock: path.join(__dirname, <span class="string">'mock'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>webpack.dev.config.js增加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line">plugins:[</span><br><span class="line">     <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">            MOCK: <span class="literal">true</span></span><br><span class="line">     &#125;)</span><br><span class="line"> ]</span><br></pre></td></tr></table></figure>

<p>这样，就只会在npm start 开发模式下，才会应用mock，如果你不想用，就把MOCK改成false就好了。</p>
<h4 id="30-使用-CSS-Modules"><a href="#30-使用-CSS-Modules" class="headerlink" title="30. 使用 CSS Modules"></a>30. 使用 CSS Modules</h4><p>webpack.dev.config.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [&#123;</span><br><span class="line">            test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">            use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader?modules&amp;localIdentName=[local]-[hash:base64:5]"</span>, <span class="string">"postcss-loader"</span>]</span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>webpack.config.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [&#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">            fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">            use: [<span class="string">"css-loader?modules&amp;localIdentName=[local]-[hash:base64:5]"</span>, <span class="string">"postcss-loader"</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src/pages/Page1/Page1.js:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> image <span class="keyword">from</span> <span class="string">'./images/brickpsert.jpg'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//看这里</span></span><br><span class="line"><span class="keyword">import</span> style <span class="keyword">from</span> <span class="string">'./Page1.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Page1</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div className=&#123;style.box&#125;&gt;</span><br><span class="line">                <span class="keyword">this</span> is page1~</span><br><span class="line">                &lt;img src=&#123;image&#125;/&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="31-json-server"><a href="#31-json-server" class="headerlink" title="31. json-server"></a>31. json-server</h4><p>json-server和Mock.js一样，都是用来模拟接口数据的。<br>json-server功能更强大，支持分页，排序，筛选等等。</p>
<p>具体使用方法参考官方文档~</p>

                                        
                </div>
                <footer class="article-footer">
                    
                        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2019/10/30/从0搭建react环境/&title=《从零搭建react环境》 — blog&pic=http://localhost:4000images/logo.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://localhost:4000/2019/10/30/从0搭建react环境/&title=《从零搭建react环境》 — blog&source=目前react、vue项目都提供了对应的脚手架工具，让大家都能够轻易地创建项目，直接进行开发，省去了繁琐的打包配置问题。但是，这些脚手架生成的初始化项目中..." data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2019/10/30/从0搭建react环境/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《从零搭建react环境》 — blog&url=http://localhost:4000/2019/10/30/从0搭建react环境/&via=http://localhost:4000" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://localhost:4000/2019/10/30/从0搭建react环境/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://localhost:4000/2019/10/30/从0搭建react环境/" alt="微信分享二维码">
</div>

<div class="mask"></div>

                            
                                <ul class="article-footer-menu">
                                    
                                            
                                </ul>
                                
                </footer>
    </div>
</article>

    
    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-webpack"><span class="post-toc-text">1. webpack</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-babel"><span class="post-toc-text">2. babel</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-react"><span class="post-toc-text">3. react</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-react-router"><span class="post-toc-text">4. react-router</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5-webpack-dev-server"><span class="post-toc-text">5. webpack-dev-server</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6-模块热更新（HMR）"><span class="post-toc-text">6. 模块热更新（HMR）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7-redux"><span class="post-toc-text">7. redux</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#8-异步action"><span class="post-toc-text">8. 异步action</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#9-devtool优化"><span class="post-toc-text">9. devtool优化</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#10-编译css"><span class="post-toc-text">10. 编译css</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#11-编译图片"><span class="post-toc-text">11. 编译图片</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#12-按需加载"><span class="post-toc-text">12. 按需加载</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#13-缓存"><span class="post-toc-text">13. 缓存</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#14-HtmlWebpackPlugin"><span class="post-toc-text">14. HtmlWebpackPlugin</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#15-提取公共代码"><span class="post-toc-text">15. 提取公共代码</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#16-生产坏境构建"><span class="post-toc-text">16. 生产坏境构建</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#17-文件压缩"><span class="post-toc-text">17. 文件压缩</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#18-指定环境"><span class="post-toc-text">18. 指定环境</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#19-优化缓存"><span class="post-toc-text">19. 优化缓存</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#20-public-path"><span class="post-toc-text">20. public path</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#21-打包优化"><span class="post-toc-text">21. 打包优化</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#22-抽取css"><span class="post-toc-text">22. 抽取css</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#23-axios和middleware"><span class="post-toc-text">23. axios和middleware</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#24-合并提取公共配置"><span class="post-toc-text">24. 合并提取公共配置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#25-增加404页面"><span class="post-toc-text">25. 增加404页面</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#26-polyfill"><span class="post-toc-text">26. polyfill</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#27-集成PostCSS"><span class="post-toc-text">27. 集成PostCSS</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#28-redux-模块热替换配置"><span class="post-toc-text">28. redux 模块热替换配置</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#29-模拟AJAX数据Mock-js"><span class="post-toc-text">29. 模拟AJAX数据Mock.js</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#30-使用-CSS-Modules"><span class="post-toc-text">30. 使用 CSS Modules</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#31-json-server"><span class="post-toc-text">31. json-server</span></a></li></ol>
        </nav>
    </aside>
    
        
<nav id="article-nav">
  
    <a href="/2019/11/13/正则表达式进阶训练/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          正则表达式进阶训练
        
      </span>
    </a>
  
  
    <a href="/2019/10/10/对于大前端的思考/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">对于大前端的思考</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>

            
                
                    
                                                    </section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2020 Yang Pei<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
    var mihoConfig = {
        root: "http://localhost:4000",
        animate: "false" ,
        isHome: "false" ,
        share: "true"
    }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/AI/">AI</a><a class="category-link" href="/categories/前端/">前端</a><a class="category-link" href="/categories/前端-AI/">前端/AI</a><a class="category-link" href="/categories/计算机/">计算机</a><a class="category-link" href="/categories/语言/">语言</a>
        </div>
        <div id="sidebar-menu-box-tags">
            
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>ß

<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>主页</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>全部</span>
                </a>
            </li>
            
            <li>
                <a  href="/categories/AI/">
                    <i class="fa fa-AI"></i><span>AI</span>
                </a>
            </li>
            
            <li>
                <a  href="/categories/前端/">
                    <i class="fa fa-前端"></i><span>前端</span>
                </a>
            </li>
            
            <li>
                <a  href="/categories/计算机/">
                    <i class="fa fa-计算机"></i><span>计算机</span>
                </a>
            </li>
            
            <li>
                <a  href="/categories/语言/">
                    <i class="fa fa-语言"></i><span>语言</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            
        </div>
    </div>
</div>
    <div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
    <script src="/js/search.js"></script>
        <script src="/js/main.js"></script>

            
                <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
                <div id="particles"></div>
                <script src="/js/particles.js"></script>
                    

                        

                                

                                                
                                                                
                                                                    <script src="/js/pop-img.js"></script>
                                                                        <script>
                                                                            $(".article-entry p img").popImg();
                                                                        </script>
                                                                        
  </div>
</body>
</html>