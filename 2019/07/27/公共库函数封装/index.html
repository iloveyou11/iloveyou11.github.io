<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><link rel="stylesheet" href="/js/fancybox/dist/jquery.fancybox.min.css"><title>公共库函数封装 | blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="YP's Blog"><meta name="description" content="下面总结公共库的封装函数（JavaScript），在项目中可以直接使用已封装好的函数库："><meta name="keywords" content="web"><meta property="og:type" content="article"><meta property="og:title" content="公共库函数封装"><meta property="og:url" content="http://localhost:4000/2019/07/27/公共库函数封装/index.html"><meta property="og:site_name" content="blog"><meta property="og:description" content="下面总结公共库的封装函数（JavaScript），在项目中可以直接使用已封装好的函数库："><meta property="og:locale" content="default"><meta property="og:updated_time" content="2020-07-06T06:21:54.628Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="公共库函数封装"><meta name="twitter:description" content="下面总结公共库的封装函数（JavaScript），在项目中可以直接使用已封装好的函数库："><link rel="icon" href="/favicon.ico"><link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"><script src="/js/pace.min.js"></script></head><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script src="/js/fancybox/dist/jquery.fancybox.min.js"></script><script src="/js/wrapimg.js"></script></html><body><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">YP&#39;s Blog</span></a><nav id="header-menu-nav" class="right"><a href="/"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/archives"><i class="fa fa-archive"></i> <span>全部</span> </a><a href="/categories/AI/"><i class="fa fa-AI"></i> <span>AI</span> </a><a href="/categories/前端/"><i class="fa fa-前端"></i> <span>前端</span> </a><a href="/categories/计算机/"><i class="fa fa-计算机"></i> <span>计算机</span> </a><a href="/categories/语言/"><i class="fa fa-语言"></i> <span>语言</span> </a><a href="/categories/专题/"><i class="fa fa-专题"></i> <span>专题</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>YP&#39;s Blog</h2></div><div id="header-description"><h3>一个专注前端智能化开发的技术博客</h3></div></div><nav class="header-nav"><div class="social"><a title="Blog" target="_blank" href="https://iloveyou11.github.io/"><i class="fa fa-home fa-2x"></i></a> <a title="Github" target="_blank" href="https://github.com/iloveyou11"><i class="fa fa-github fa-2x"></i></a></div></nav></div></div></header><div class="outer"><section id="main" class="body-wrap"><article id="post-公共库函数封装" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">公共库函数封装</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/前端/">前端</a></li><li><i class="fa fa-calendar"></i> 2019-07-27</li><li><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"></span></li></ul></div><div style="margin-top:10px"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i> <span class="post-meta-item-text">字数统计: </span><span class="post-count">4.7k字</span> </span></span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i> <span class="post-meta-item-text">阅读时长: </span><span class="post-count">25分</span></span></span></div></header><div class="article-entry post-content" itemprop="articleBody"><div id="toc"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据处理"><span class="toc-text">数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-常用数据处理"><span class="toc-text">1. 常用数据处理</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-常用DOM操作"><span class="toc-text">2. 常用DOM操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#3-常用工具函数"><span class="toc-text">3. 常用工具函数</span></a></li></ol></li></ol><li class="toc-item toc-level-4"><a class="toc-link" href="#文件处理"><span class="toc-text">文件处理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-简单文件处理"><span class="toc-text">1. 简单文件处理</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-详细文件处理"><span class="toc-text">2. 详细文件处理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#http请求"><span class="toc-text">http请求</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-axios库封装"><span class="toc-text">1. axios库封装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-jsonp封装"><span class="toc-text">2. jsonp封装</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nodejs操作mysql"><span class="toc-text">nodejs操作mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-直接操作，批量修改值"><span class="toc-text">1. 直接操作，批量修改值</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#openlayer绘图函数"><span class="toc-text">openlayer绘图函数</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-图形绘制"><span class="toc-text">1. 图形绘制</span></a></li></ol></li></div><p>下面总结公共库的封装函数（JavaScript），在项目中可以直接使用已封装好的函数库：</p><a id="more"></a><h4 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h4><h6 id="1-常用数据处理"><a href="#1-常用数据处理" class="headerlink" title="1. 常用数据处理"></a>1. 常用数据处理</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataProcess</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取完整时间</span></span><br><span class="line">    getFullTime() &#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">return</span> date.getFullYear() + <span class="string">'-'</span> + (date.getMonth() + <span class="number">1</span>) + <span class="string">'-'</span> + date.getDate() + <span class="string">' '</span> + date.getHours() + <span class="string">':'</span> + date.getMinutes() + <span class="string">':'</span> + date.getSeconds();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取日期</span></span><br><span class="line">    getDate() &#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">return</span> date.getFullYear() + <span class="string">'-'</span> + (date.getMonth() + <span class="number">1</span>) + <span class="string">'-'</span> + date.getDate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取时间</span></span><br><span class="line">    getTime() &#123;</span><br><span class="line">        <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">        <span class="keyword">return</span> date.getHours() + <span class="string">':'</span> + date.getMinutes() + <span class="string">':'</span> + date.getSeconds();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 格式化金额,单位:分(eg:430分=4.30元)</span></span><br><span class="line">    formatFee(fee, suffix = <span class="string">''</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!fee) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Number</span>(fee).toFixed(<span class="number">2</span>) + suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将金额变为美元书写方式</span></span><br><span class="line">    formatToDollar(val) &#123;</span><br><span class="line">        <span class="comment">//金额转换 分-&gt;元 保留2位小数 并每隔3位用逗号分开 1,234.56</span></span><br><span class="line">        <span class="keyword">var</span> str = (val / <span class="number">100</span>).toFixed(<span class="number">2</span>) + <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">var</span> intSum = str.substring(<span class="number">0</span>, str.indexOf(<span class="string">"."</span>)).replace(<span class="regexp">/\B(?=(?:\d&#123;3&#125;)+$)/g</span>, <span class="string">','</span>); <span class="comment">//取到整数部分</span></span><br><span class="line">        <span class="keyword">var</span> dot = str.substring(str.length, str.indexOf(<span class="string">"."</span>)) <span class="comment">//取到小数部分搜索</span></span><br><span class="line">        <span class="keyword">var</span> ret = <span class="string">'$'</span> + intSum + dot;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 隐藏手机号中间4位</span></span><br><span class="line">    formatPhone(phone) &#123;</span><br><span class="line">        phone += <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">return</span> phone.replace(<span class="regexp">/(\d&#123;3&#125;)\d*(\d&#123;4&#125;)/g</span>, <span class="string">'$1***$2'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 隐藏身份证号中11位</span></span><br><span class="line">    formatIdentity(number) &#123;</span><br><span class="line">        number += <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">return</span> number.replace(<span class="regexp">/(\d&#123;3&#125;)\d*(\d&#123;4&#125;)/g</span>, <span class="string">'$1***********$2'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将句子的每个单词的首字母大写</span></span><br><span class="line">    firstUpperCase(str) &#123;</span><br><span class="line">        <span class="keyword">return</span> str.toLowerCase().replace(<span class="regexp">/( |^)[a-z]/g</span>, (L) =&gt; L.toUpperCase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 句子首字母大写</span></span><br><span class="line">    formatEnSentence(str) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!str) <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">        str = str.trim();</span><br><span class="line">        <span class="keyword">let</span> strArr = str.split(<span class="string">''</span>)</span><br><span class="line">        strArr[<span class="number">0</span>] = strArr[<span class="number">0</span>].toUpperCase()</span><br><span class="line">        <span class="keyword">let</span> marks = [<span class="string">'.'</span>, <span class="string">'?'</span>, <span class="string">'!'</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; strArr.length; i++) &#123;</span><br><span class="line">            i = <span class="built_in">parseInt</span>(i)</span><br><span class="line">            <span class="keyword">if</span> (marks.includes(strArr[i])) &#123;</span><br><span class="line">                <span class="keyword">while</span> (strArr[i + <span class="number">1</span>] === <span class="string">' '</span>) &#123;</span><br><span class="line">                    strArr[i + <span class="number">1</span>] = <span class="string">''</span></span><br><span class="line">                    i++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (strArr[i + <span class="number">1</span>]) strArr[i + <span class="number">1</span>] = strArr[i + <span class="number">1</span>].toUpperCase()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> strArr.join(<span class="string">''</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> DataProcess</span><br></pre></td></tr></table></figure><h6 id="2-常用DOM操作"><a href="#2-常用DOM操作" class="headerlink" title="2. 常用DOM操作"></a>2. 常用DOM操作</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为DOM添加class</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">addClass</span>(<span class="params">el, className</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 首先要判断 el对象 是否有这个类名 如果有就直接返回 如果没有就添加</span></span><br><span class="line">    <span class="keyword">if</span> (hasClass(el, className)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> newClass = el.className.split(<span class="string">' '</span>)</span><br><span class="line">    newClass.push(className)</span><br><span class="line">    el.className = newClass.join(<span class="string">' '</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断DOM是否有某个class</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">hasClass</span>(<span class="params">el, className</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> reg = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'(^|\\s)'</span> + className + <span class="string">'(\\s|$)'</span>)</span><br><span class="line">    <span class="keyword">return</span> reg.test(el.className)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取DOM属性name的值</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">el, name, value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> prefix = <span class="string">'data-'</span></span><br><span class="line">    <span class="keyword">var</span> name = prefix + name</span><br><span class="line">    <span class="keyword">if</span> (value) &#123;</span><br><span class="line">        <span class="keyword">return</span> el.setAttribute(name, value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> el.getAttribute(name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> elementStyle = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>).style</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vendor = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> transformNames = &#123;</span><br><span class="line">        webkit: <span class="string">'webkitTransform'</span>,</span><br><span class="line">        Moz: <span class="string">'MozTransform'</span>,</span><br><span class="line">        O: <span class="string">'OTransform'</span>,</span><br><span class="line">        ms: <span class="string">'msTransform'</span>, <span class="comment">//IE</span></span><br><span class="line">        standard: <span class="string">'transform'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> transformNames) &#123;</span><br><span class="line">        <span class="keyword">if</span> (elementStyle[transformNames[key]] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> key</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">prefixStyle</span>(<span class="params">style</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (vendor === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (vendor === <span class="string">'standard'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> style</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vendor + style.charAt(<span class="number">0</span>).toUpperCase() + style.substr(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="3-常用工具函数"><a href="#3-常用工具函数" class="headerlink" title="3. 常用工具函数"></a>3. 常用工具函数</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取随机数</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRandomInt</span>(<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min + <span class="number">1</span>) + min)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 洗牌函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">shuffle</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> newArr = arr.slice()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; newArr.length; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> j = getRandomInt(<span class="number">0</span>, i)</span><br><span class="line">        <span class="keyword">let</span> tmp = newArr[i]</span><br><span class="line">        newArr[i] = newArr[j]</span><br><span class="line">        newArr[j] = tmp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newArr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 防抖函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">simpeDebounce</span>(<span class="params">func, delay</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        clearTimeout(timer);</span><br><span class="line">        timer = setTimeout(func, delay);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">fun, delay</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arguments</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//获取函数的作用域和变量</span></span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">let</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">        clearTimeout(fun.id) <span class="comment">// 清除定时器</span></span><br><span class="line">        fun.id = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            fun.call(that, args)</span><br><span class="line">        &#125;, delay)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 节流函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">simpleThrottle</span>(<span class="params">func, delay</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            func();</span><br><span class="line">            timer = <span class="literal">null</span>;</span><br><span class="line">        &#125;, delay);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">fn, delay</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> lastTime;</span><br><span class="line">    <span class="keyword">let</span> timer;</span><br><span class="line">    delay || (delay = <span class="number">300</span>); <span class="comment">// 默认间隔为300ms</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">arguments</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> context = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">let</span> args = <span class="built_in">arguments</span>;</span><br><span class="line">        <span class="keyword">let</span> nowTime = +<span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">// 获取系统当前的时间</span></span><br><span class="line">        <span class="keyword">if</span> (lastTime &amp;&amp; nowTime &lt; lastTime + delay) &#123; <span class="comment">// 当前距离上次执行的时间小于设置的时间间隔</span></span><br><span class="line">            clearTimeout(timer); <span class="comment">// 清除定时器</span></span><br><span class="line">            timer = setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// delay时间后，执行函数</span></span><br><span class="line">                lastTime = nowTime;</span><br><span class="line">                fn.apply(context, args);</span><br><span class="line">            &#125;, delay);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 当前距离上次执行的时间大于等于设置的时间，直接执行函数</span></span><br><span class="line">            lastTime = nowTime;</span><br><span class="line">            fn.apply(context, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toString = <span class="built_in">Object</span>.prototype.toString</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否为时间</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isDate</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toString.call(val) === <span class="string">'[object Date]'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 判断是否为对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val !== <span class="literal">null</span> &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">'object'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 判断是否为普通对象，不包含了formData、binaryData等</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> toString.call(val) === <span class="string">'[object Object]'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// encode解码</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(val)</span><br><span class="line">        .replace(<span class="regexp">/%40/g</span>, <span class="string">'@'</span>)</span><br><span class="line">        .replace(<span class="regexp">/%3A/gi</span>, <span class="string">':'</span>)</span><br><span class="line">        .replace(<span class="regexp">/%24/g</span>, <span class="string">'$'</span>)</span><br><span class="line">        .replace(<span class="regexp">/%2C/gi</span>, <span class="string">','</span>)</span><br><span class="line">        .replace(<span class="regexp">/%20/g</span>, <span class="string">'+'</span>)</span><br><span class="line">        .replace(<span class="regexp">/%5B/gi</span>, <span class="string">'['</span>)</span><br><span class="line">        .replace(<span class="regexp">/%5D/gi</span>, <span class="string">']'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// xss字符转义函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">xssEncode</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 构建ajax的url</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">buildURL</span>(<span class="params">url, params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!params) &#123;</span><br><span class="line">        <span class="keyword">return</span> url</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> parts = []</span><br><span class="line">    <span class="built_in">Object</span>.keys(params).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> val = params[key]</span><br><span class="line">        <span class="keyword">if</span> (val === <span class="literal">null</span> || <span class="keyword">typeof</span> val === <span class="string">'undefined'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> values = []</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(val)) &#123;</span><br><span class="line">            values = val</span><br><span class="line">            key += <span class="string">'[]'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            values = [val]</span><br><span class="line">        &#125;</span><br><span class="line">        values.forEach(<span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isDate(val)) &#123;</span><br><span class="line">                val = val.toISOString()</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isPlainObject(val)) &#123;</span><br><span class="line">                val = <span class="built_in">JSON</span>.stringify(val)</span><br><span class="line">            &#125;</span><br><span class="line">            parts.push(<span class="string">`<span class="subst">$&#123;encode(key)&#125;</span>=<span class="subst">$&#123;encode(val)&#125;</span>`</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> serializedParams = parts.join(<span class="string">'&amp;'</span>)</span><br><span class="line">    <span class="keyword">if</span> (serializedParams) &#123;</span><br><span class="line">        <span class="keyword">const</span> markIndex = url.indexOf(<span class="string">'#'</span>)</span><br><span class="line">        <span class="keyword">if</span> (markIndex !== <span class="number">-1</span>) &#123;</span><br><span class="line">            url = url.slice(<span class="number">0</span>, markIndex)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        url += (url.indexOf(<span class="string">'?'</span>) === <span class="number">-1</span> ? <span class="string">'?'</span> : <span class="string">'&amp;'</span>) + serializedParams</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="文件处理"><a href="#文件处理" class="headerlink" title="文件处理"></a>文件处理</h4><h6 id="1-简单文件处理"><a href="#1-简单文件处理" class="headerlink" title="1. 简单文件处理"></a>1. 简单文件处理</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 删除文件夹（文件夹内有文件也一并删除）</span></span><br><span class="line">    deleteFolder(path) &#123;</span><br><span class="line">        <span class="keyword">let</span> files = [];</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(path)) &#123;</span><br><span class="line">            files = fs.readdirSync(path);</span><br><span class="line">            files.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">file, index</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">let</span> curPath = path + <span class="string">"/"</span> + file;</span><br><span class="line">                <span class="keyword">if</span> (fs.statSync(curPath).isDirectory()) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.deleteFolder(curPath);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    fs.unlinkSync(curPath);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            fs.rmdirSync(path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后端根据url下载文件，存至服务器目录</span></span><br><span class="line">    download(urlArr, dirPath) &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.all(</span><br><span class="line">            urlArr.map(<span class="keyword">async</span>(url, i) =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span> fileName = <span class="string">`<span class="subst">$&#123;i + <span class="number">1</span>&#125;</span>.wav`</span>;</span><br><span class="line">                <span class="keyword">let</span> stream = fs.createWriteStream(path.join(dirPath, fileName));</span><br><span class="line">                <span class="comment">// 下载文件并压缩</span></span><br><span class="line">                <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">                    request(url)</span><br><span class="line">                        .pipe(stream)</span><br><span class="line">                        .on(<span class="string">"close"</span>, err =&gt; &#123;</span><br><span class="line">                            <span class="keyword">if</span> (err) reject(err);</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="built_in">console</span>.log(<span class="string">"文件["</span> + fileName + <span class="string">"]下载完毕"</span>);</span><br><span class="line">                                resolve();</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;)</span><br><span class="line">        ).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            zip.addLocalFolder(dirPath);</span><br><span class="line">            <span class="keyword">let</span> zippath = path.join(__dirname, <span class="string">"zip"</span>);</span><br><span class="line">            zip.writeZip(zippath + <span class="string">"/adm-archive.zip"</span>, err =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 后端返回文件下载</span></span><br><span class="line">    returnFile(filePath, fileName) &#123;</span><br><span class="line">        <span class="keyword">let</span> file = path.join(__dirname, filePath);</span><br><span class="line">        <span class="keyword">let</span> size = fs.statSync(file).size;</span><br><span class="line">        <span class="keyword">let</span> f = fs.createReadStream(file);</span><br><span class="line">        res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">            <span class="string">"Content-Type"</span>: <span class="string">"application/force-download"</span>,</span><br><span class="line">            <span class="string">"Content-Disposition"</span>: <span class="string">"attachment; filename="</span> + fileName,</span><br><span class="line">            <span class="string">"Content-Length"</span>: size</span><br><span class="line">        &#125;);</span><br><span class="line">        f.pipe(res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> File()</span><br></pre></td></tr></table></figure><h6 id="2-详细文件处理"><a href="#2-详细文件处理" class="headerlink" title="2. 详细文件处理"></a>2. 详细文件处理</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> unzip = <span class="built_in">require</span>(<span class="string">"unzip"</span>)</span><br><span class="line"><span class="keyword">const</span> AdmZip = <span class="built_in">require</span>(<span class="string">"adm-zip"</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="comment">//递归创建目录 同步方法</span></span><br><span class="line">    mkdirsSync(dirname) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(dirname)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mkdirsSync(path.dirname(dirname))) &#123;</span><br><span class="line">                fs.mkdirSync(dirname)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//递归创建目录 异步方法</span></span><br><span class="line">    mkdirs(dirname, callback) &#123;</span><br><span class="line">        fs.exists(dirname, <span class="function"><span class="keyword">function</span>(<span class="params">exists</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">                callback()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//console.log(path.dirname(dirname))</span></span><br><span class="line">                mkdirs(path.dirname(dirname), <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    fs.mkdir(dirname, callback)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *同步创建文件夹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;string[]&#125; folders 要创建的文件夹，由键值对表示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    createFolderSync(...folders) &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.all(folders.map(<span class="function"><span class="params">folder</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> folder) &#123;</span><br><span class="line">                <span class="keyword">if</span> (folder[key] != <span class="string">""</span>) mkdirsSync(folder[key])</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *异步创建文件夹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;string[]&#125; folders 要创建的文件夹，由键值对表示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    createFolder(...folders) &#123;</span><br><span class="line">        <span class="built_in">Promise</span>.all(folders.map(<span class="function"><span class="params">folder</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> folder) &#123;</span><br><span class="line">                <span class="keyword">if</span> (folder[key] != <span class="string">""</span>)</span><br><span class="line">                    mkdirs(folder[key], () =&gt; &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;folder[key]&#125;</span>已存在`</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 递归删除文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; path 要删除的文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    deleteFolderRecursiveSync(path) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(path)) &#123;</span><br><span class="line">            fs.readdirSync(path).forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> curPath = <span class="string">`<span class="subst">$&#123;path&#125;</span>/<span class="subst">$&#123;file&#125;</span>`</span></span><br><span class="line">                <span class="keyword">if</span> (fs.statSync(curPath).isDirectory()) &#123;</span><br><span class="line">                    <span class="comment">// recurse</span></span><br><span class="line">                    deleteFolderRecursiveSync(curPath)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    deleteFileSync(curPath)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            fs.rmdirSync(path)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 同步删除文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; file 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    deleteFileSync(file) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(file)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                fs.unlinkSync(file)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(error, <span class="string">`删除<span class="subst">$&#123;file&#125;</span>失败`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 异步删除文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; file 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    deleteFile(file) &#123;</span><br><span class="line">        fs.exists(file, (exists) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">                fs.unlink(file, (err) =&gt; &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">`删除<span class="subst">$&#123;file&#125;</span>失败`</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 同步移动文件夹中的文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; oldPath 源文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; newPath 目标文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> moveFolderFileSync(oldPath, newPath) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fs.readdirSync(oldPath).forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!fs.statSync(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>).isDirectory())</span><br><span class="line">                    fs.renameSync(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>, <span class="string">`<span class="subst">$&#123;newPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error, <span class="string">`移动文件夹<span class="subst">$&#123;oldPath&#125;</span>失败`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 异步移动文件夹中的文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; oldPath 源文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; newPath 目标文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    moveFolderFile(oldPath, newPath) &#123;</span><br><span class="line">        fs.readdir(oldPath, (err, files) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!err)</span><br><span class="line">                files.forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">                    fs.stat(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>, (err, stats) =&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                            <span class="built_in">console</span>.log(err, <span class="string">`读取<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>文件状态失败`</span>)</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!stats.isDirectory()) &#123;</span><br><span class="line">                                <span class="keyword">try</span> &#123;</span><br><span class="line">                                    fs.rename(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>, <span class="string">`<span class="subst">$&#123;newPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>)</span><br><span class="line">                                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                                    <span class="built_in">console</span>.log(error, <span class="string">`移动<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>失败`</span>)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 同步复制文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; oldPath 源文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; newPath 目标文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> moveFolderSync(oldPath, newPath) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(newPath)) &#123;</span><br><span class="line">            deleteFolderRecursiveSync(newPath)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fs.renameSync(oldPath, newPath)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error, <span class="string">`<span class="subst">$&#123;oldPath&#125;</span>移动失败`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 异步复制文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; oldPath 源文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; newPath 目标文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    moveFolder(oldPath, newPath) &#123;</span><br><span class="line">        fs.exists(newPath, (exists) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">                deleteFolderRecursiveSync(oldPath)</span><br><span class="line">            &#125;</span><br><span class="line">            fs.rename(oldPath, newPath, (err) =&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(err, <span class="string">`<span class="subst">$&#123;oldPath&#125;</span>移动失败`</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 同步复制文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; oldFile 源文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; newFile 新文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">async</span> copyFileSync(oldFile, newFile) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fs.writeFileSync(newFile, fs.readFileSync(oldFile))</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error, <span class="string">`复制文件<span class="subst">$&#123;oldFile&#125;</span>失败`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 异步复制文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; oldFile 源文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; newFile 新文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    copyFile(oldFile, newFile) &#123;</span><br><span class="line">        fs.createReadStream(oldFile)</span><br><span class="line">            .pipe(fs.createWriteStream(newFile))</span><br><span class="line">            .on(<span class="string">"finish"</span>, () =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;oldFile&#125;</span>文件复制完成`</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">            .on(<span class="string">"error"</span>, (error) =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(error, <span class="string">"文件复制失败"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 异步复制文件夹,可以通过参数决定是否复制子文件夹，可根据名字过滤并重命名为filter</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125;oldPath 要复制的文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125;newPath 复制到的文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;Boolean&#125;OnlyFile 是否复制子文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125;filter 根据名字过滤要复制的对象</span></span><br><span class="line"><span class="comment">     * @param &#123;Boolean&#125;rename 是否重命名为filter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    copyFolder(oldPath, newPath, OnlyFile = <span class="literal">false</span>, filter = <span class="string">""</span>, rename = <span class="literal">false</span>) &#123;</span><br><span class="line">        fs.readdir(oldPath, (err, files) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">                files.forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (file.indexOf(filter) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!fs.statSync(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>).isDirectory()) &#123;</span><br><span class="line">                            <span class="keyword">let</span> name = file</span><br><span class="line">                            <span class="keyword">if</span> (rename) name = <span class="string">`<span class="subst">$&#123;filter&#125;</span><span class="subst">$&#123;path.extname(file)&#125;</span>`</span></span><br><span class="line">                            copyFile(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>, <span class="string">`<span class="subst">$&#123;newPath&#125;</span>\\<span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (!OnlyFile)</span><br><span class="line">                                copyFolder(</span><br><span class="line">                                    <span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>,</span><br><span class="line">                                    <span class="string">`<span class="subst">$&#123;newPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>,</span><br><span class="line">                                    OnlyFile,</span><br><span class="line">                                    filter,</span><br><span class="line">                                    rename,</span><br><span class="line">                                )</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 同步复制文件夹,可以通过参数决定是否复制子文件夹，可根据名字过滤并重命名为filter</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125;oldPath 要复制的文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125;newPath 复制到的文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;Boolean&#125;OnlyFile 是否复制子文件夹</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125;filter 根据名字过滤要复制的对象</span></span><br><span class="line"><span class="comment">     * @param &#123;Boolean&#125;rename 是否重命名为filter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    copyFolderSync(oldPath, newPath, OnlyFile = <span class="literal">false</span>, filter = <span class="string">""</span>, rename = <span class="literal">false</span>) &#123;</span><br><span class="line">        fs.readdirSync(oldPath).forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (file.indexOf(filter) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!fs.statSync(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>).isDirectory()) &#123;</span><br><span class="line">                    name = file</span><br><span class="line">                    <span class="keyword">if</span> (rename) name = <span class="string">`<span class="subst">$&#123;filter&#125;</span><span class="subst">$&#123;path.extname(file)&#125;</span>`</span></span><br><span class="line">                    copyFileSync(<span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>, <span class="string">`<span class="subst">$&#123;newPath&#125;</span>\\<span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!OnlyFile)</span><br><span class="line">                        copyFolderSync(</span><br><span class="line">                            <span class="string">`<span class="subst">$&#123;oldPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>,</span><br><span class="line">                            <span class="string">`<span class="subst">$&#123;newPath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>,</span><br><span class="line">                            OnlyFile,</span><br><span class="line">                            filter,</span><br><span class="line">                            rename,</span><br><span class="line">                        )</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 同步解压文件夹，用adm-zip解压</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; filePath 压缩文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; extracePath 解压文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ExtractZipSync(filePath, extracePath) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> zip = <span class="keyword">new</span> AdmZip(filePath)</span><br><span class="line">                zip.extractAllTo(extracePath, <span class="literal">true</span>)</span><br><span class="line">                <span class="keyword">return</span> resolve()</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                <span class="keyword">return</span> reject(error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 异步解压文件夹，用unzip解压</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; filePath 压缩文件</span></span><br><span class="line"><span class="comment">     * @param &#123;string&#125; extracePath 解压文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ExtractZip(filePath, extracePath, callback = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;) &#123;</span><br><span class="line">        fs.createReadStream(filePath)</span><br><span class="line">            .pipe(</span><br><span class="line">                unzip.Extract(&#123;</span><br><span class="line">                    path: extracePath,</span><br><span class="line">                &#125;),</span><br><span class="line">            )</span><br><span class="line">            .on(<span class="string">"finish"</span>, () =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">"解压完成"</span>)</span><br><span class="line">                callback()</span><br><span class="line">            &#125;)</span><br><span class="line">            .on(<span class="string">"error"</span>, (error) =&gt; &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(error, <span class="string">"解压失败"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * @description 将多个文件夹文件移动到一个文件夹</span></span><br><span class="line"><span class="comment">     * @param path 源文件夹</span></span><br><span class="line"><span class="comment">     * @param newpath 新文件夹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    moveToOne(path, newpath) &#123;</span><br><span class="line">        fs.readdir(path, (err, files) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">                files.forEach(<span class="function"><span class="params">file</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> OldFile = <span class="string">`<span class="subst">$&#123;path&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span></span><br><span class="line">                    <span class="keyword">if</span> (!fs.statSync(OldFile).isDirectory())</span><br><span class="line">                        fs.createReadStream(OldFile)</span><br><span class="line">                        .pipe(fs.createWriteStream(<span class="string">`<span class="subst">$&#123;newpath&#125;</span>\\<span class="subst">$&#123;file&#125;</span>`</span>));</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        move(OldFile, newpath);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为文件夹下的全部文件增加前缀，复制至另一文件夹</span></span><br><span class="line">    renameAllFileWithPrefix(fileDirectory, newfileDirectory, prefix) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(fileDirectory)) &#123;</span><br><span class="line">            <span class="keyword">var</span> files = fs.readdirSync(fileDirectory);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> filePath = fileDirectory + <span class="string">"/"</span> + files[i];</span><br><span class="line">                <span class="keyword">var</span> fileName = prefix + files[i];</span><br><span class="line">                <span class="keyword">var</span> newFilePath = newfileDirectory + <span class="string">"/"</span> + fileName;</span><br><span class="line">                fs.rename(filePath, newFilePath, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(fileDirectory + <span class="string">"  Not Found!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为文件夹下的全部文件增加后缀，复制至另一文件夹</span></span><br><span class="line">    renameAllFileWithSuffix(fileDirectory, newfileDirectory, suffix) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fs.existsSync(fileDirectory)) &#123;</span><br><span class="line">            <span class="keyword">var</span> files = fs.readdirSync(fileDirectory);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; files.length; i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> filePath = fileDirectory + <span class="string">"/"</span> + files[i];</span><br><span class="line">                <span class="keyword">var</span> fileName = files[i] + suffix;</span><br><span class="line">                <span class="keyword">var</span> newFilePath = newfileDirectory + <span class="string">"/"</span> + fileName;</span><br><span class="line">                fs.rename(filePath, newFilePath, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(fileDirectory + <span class="string">"  Not Found!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> File()</span><br></pre></td></tr></table></figure><h4 id="http请求"><a href="#http请求" class="headerlink" title="http请求"></a>http请求</h4><h6 id="1-axios库封装"><a href="#1-axios库封装" class="headerlink" title="1. axios库封装"></a>1. axios库封装</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> JsonP <span class="keyword">from</span> <span class="string">'jsonp'</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Axios</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> jsonp(options) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            JsonP(options.url, &#123;</span><br><span class="line">                param: <span class="string">'callback'</span></span><br><span class="line">            &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, response</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (response.status == <span class="string">'success'</span>) &#123;</span><br><span class="line">                    resolve(response);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(response.messsage);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> ajax(options, baseApi, loadingDomId) &#123;</span><br><span class="line">        <span class="keyword">let</span> loading;</span><br><span class="line">        <span class="keyword">if</span> (options.data &amp;&amp; options.data.isShowLoading !== <span class="literal">false</span>) &#123;</span><br><span class="line">            loading = <span class="built_in">document</span>.getElementById(loadingDomId);</span><br><span class="line">            loading.style.display = <span class="string">'block'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            axios(&#123;</span><br><span class="line">                url: options.url,</span><br><span class="line">                method: <span class="string">'get'</span>,</span><br><span class="line">                baseURL: baseApi,</span><br><span class="line">                timeout: <span class="number">5000</span>,</span><br><span class="line">                params: (options.data &amp;&amp; options.data.params) || <span class="string">''</span></span><br><span class="line">            &#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (options.data &amp;&amp; options.data.isShowLoading !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    loading = <span class="built_in">document</span>.getElementById(loadingDomId);</span><br><span class="line">                    loading.style.display = <span class="string">'none'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (response.status == <span class="string">'200'</span>) &#123;</span><br><span class="line">                    <span class="keyword">let</span> res = response.data;</span><br><span class="line">                    <span class="keyword">if</span> (res.code == <span class="string">'0'</span>) &#123;</span><br><span class="line">                        resolve(res);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        Modal.info(&#123;</span><br><span class="line">                            title: <span class="string">"提示"</span>,</span><br><span class="line">                            content: res.msg</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(response.data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Axios()</span><br></pre></td></tr></table></figure><h6 id="2-jsonp封装"><a href="#2-jsonp封装" class="headerlink" title="2. jsonp封装"></a>2. jsonp封装</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> originJsonp <span class="keyword">from</span> <span class="string">'jsonp'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 三个参数粉笔为 目标url 需要拼接在url上的参数 以及jsonp插件 需要的option</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">jsonp</span>(<span class="params">url, paramdata, options</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 在这里引入一个  拼接字符串的方法</span></span><br><span class="line">    url += (url.indexOf(<span class="string">'?'</span>) &lt; <span class="number">0</span> ? <span class="string">'?'</span> : <span class="string">'&amp;'</span>) + param(paramdata)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在这里返回一个Promise对象</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 在这里的data 跟上面的paramdata是不一样的  一个是 json的返回对象  一个是你传入的参数</span></span><br><span class="line">        originJsonp(url, options, (err, data) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">                resolve(data)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                reject(err)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">param</span>(<span class="params">paramdata</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> paramdata) &#123;</span><br><span class="line">        <span class="comment">//  对参数对象里的每一项进行判断</span></span><br><span class="line">        <span class="keyword">let</span> value = paramdata[k] == <span class="literal">undefined</span> ? <span class="string">''</span> : paramdata[k]</span><br><span class="line">        url += <span class="string">`&amp;<span class="subst">$&#123;k&#125;</span>=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(value)&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 循环结束  url 拼接完毕 将其返回</span></span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="nodejs操作mysql"><a href="#nodejs操作mysql" class="headerlink" title="nodejs操作mysql"></a>nodejs操作mysql</h4><h6 id="1-直接操作，批量修改值"><a href="#1-直接操作，批量修改值" class="headerlink" title="1. 直接操作，批量修改值"></a>1. 直接操作，批量修改值</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">"mysql"</span>);</span><br><span class="line"><span class="keyword">const</span> inspect = <span class="built_in">require</span>(<span class="string">"eyes"</span>).inspector(&#123;</span><br><span class="line">    maxLength: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//使用数据库连接池</span></span><br><span class="line"><span class="keyword">const</span> mysqlCofig = &#123;</span><br><span class="line">    host: <span class="string">"localhost"</span>,</span><br><span class="line">    port: <span class="number">3306</span>,</span><br><span class="line">    database: <span class="string">"test4"</span>,</span><br><span class="line">    user: <span class="string">"root"</span>,</span><br><span class="line">    password: <span class="string">"574820ypczjs"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> pool = mysql.createPool(mysqlCofig);</span><br><span class="line">pool.getConnection(<span class="function"><span class="keyword">function</span>(<span class="params">err, connection</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//通过getConnection()方法进行数据库连接</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`mysql链接失败<span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> EIDs = [],</span><br><span class="line">            centerX = [],</span><br><span class="line">            centerY = [];</span><br><span class="line">        connection.query(<span class="string">"select EID,extent from extent"</span>, (err, result) =&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> result) &#123;</span><br><span class="line">                <span class="keyword">const</span> element = result[key];</span><br><span class="line">                <span class="keyword">let</span> EID = element[<span class="string">'EID'</span>],</span><br><span class="line">                    extent = element[<span class="string">'extent'</span>];</span><br><span class="line">                extent = <span class="built_in">JSON</span>.parse(extent);</span><br><span class="line">                <span class="keyword">let</span> x = (extent[<span class="string">'minX'</span>] + extent[<span class="string">'maxX'</span>]) / <span class="number">2</span>;</span><br><span class="line">                <span class="keyword">let</span> y = (extent[<span class="string">'minY'</span>] + extent[<span class="string">'maxY'</span>]) / <span class="number">2</span>;</span><br><span class="line">                EIDs.push(EID);</span><br><span class="line">                centerX.push(x);</span><br><span class="line">                centerY.push(y);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">let</span> res = [];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> EIDs) &#123;</span><br><span class="line">                res.push(&#123;</span><br><span class="line">                    EID: EIDs[key],</span><br><span class="line">                    centerX: centerX[key],</span><br><span class="line">                    centerY: centerY[key]</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> res) &#123;</span><br><span class="line">                <span class="keyword">if</span> (res.hasOwnProperty(key)) &#123;</span><br><span class="line">                    <span class="keyword">const</span> element = res[key];</span><br><span class="line">                    connection.query(<span class="string">'update extent set ? where EID=?'</span>, [element, element[<span class="string">'EID'</span>]], (err, result) =&gt; &#123;</span><br><span class="line">                        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                            inspect(err, <span class="string">'更新数据出错'</span>);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            inspect(<span class="string">'更新数据成功'</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="openlayer绘图函数"><a href="#openlayer绘图函数" class="headerlink" title="openlayer绘图函数"></a>openlayer绘图函数</h4><h6 id="1-图形绘制"><a href="#1-图形绘制" class="headerlink" title="1. 图形绘制"></a>1. 图形绘制</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Map</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @function 绘制点</span></span><br><span class="line"><span class="comment">     * @param &#123;Object&#125; map 地图对象</span></span><br><span class="line"><span class="comment">     * @param &#123;Number&#125; x x坐标</span></span><br><span class="line"><span class="comment">     * @param &#123;Number&#125; y y坐标</span></span><br><span class="line"><span class="comment">     * @param &#123;String&#125; fillColor 填充色 </span></span><br><span class="line"><span class="comment">     * @param &#123;String&#125; strokeColor 边线颜色</span></span><br><span class="line"><span class="comment">     * @param &#123;String&#125; imageColor 图案颜色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    drawPoint(map, x, y, fillColor = <span class="string">'#000'</span>, strokeColor = <span class="string">'#000'</span>, imageColor = <span class="string">'#000'</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> point = <span class="keyword">new</span> ol.Feature(&#123;</span><br><span class="line">            geometry: <span class="keyword">new</span> ol.geom.Point([x, y])</span><br><span class="line">        &#125;);</span><br><span class="line">        point.setStyle(<span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            fill: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                color: fillColor</span><br><span class="line">            &#125;),</span><br><span class="line">            stroke: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                color: strokeColor,</span><br><span class="line">                width: <span class="number">1</span></span><br><span class="line">            &#125;),</span><br><span class="line">            image: <span class="keyword">new</span> ol.style.Circle(&#123;</span><br><span class="line">                radius: <span class="number">8</span>,</span><br><span class="line">                fill: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                    color: imageColor</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="keyword">let</span> source = <span class="keyword">new</span> ol.source.Vector(&#123;</span><br><span class="line">            features: [point]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> vector = <span class="keyword">new</span> ol.layer.Vector(&#123;</span><br><span class="line">            source: source</span><br><span class="line">        &#125;);</span><br><span class="line">        map.addLayer(vector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param &#123;Object&#125; map 地图</span></span><br><span class="line"><span class="comment">     * @param &#123;Array&#125; startPoint 起始点坐标</span></span><br><span class="line"><span class="comment">     * @param &#123;Array&#125; endPoint 结束点坐标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    drawStaticLine(map, startPoint, endPoint, fillColor = <span class="string">'#000'</span>, strokeColor = <span class="string">'#000'</span>, imageColor = <span class="string">'#000'</span>) &#123;</span><br><span class="line">        <span class="comment">//创建一个线</span></span><br><span class="line">        <span class="keyword">let</span> Line = <span class="keyword">new</span> ol.Feature(&#123;</span><br><span class="line">            geometry: <span class="keyword">new</span> ol.geom.LineString([startPoint, endPoint])</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置线的样式</span></span><br><span class="line">        Line.setStyle(<span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            <span class="comment">//填充色</span></span><br><span class="line">            fill: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                color: fillColor</span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="comment">//边线颜色</span></span><br><span class="line">            stroke: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                lineDash: [<span class="number">1</span>, <span class="number">4</span>],</span><br><span class="line">                color: strokeColor,</span><br><span class="line">                width: <span class="number">2</span></span><br><span class="line">            &#125;),</span><br><span class="line">            <span class="comment">//形状</span></span><br><span class="line">            image: <span class="keyword">new</span> ol.style.Circle(&#123;</span><br><span class="line">                radius: <span class="number">7</span>,</span><br><span class="line">                fill: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                    color: imageColor</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;));</span><br><span class="line">        <span class="keyword">let</span> source = <span class="keyword">new</span> ol.source.Vector(&#123;</span><br><span class="line">            features: [Line]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> vector = <span class="keyword">new</span> ol.layer.Vector(&#123;</span><br><span class="line">            source: source</span><br><span class="line">        &#125;);</span><br><span class="line">        map.addLayer(vector);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param &#123;Object&#125; map </span></span><br><span class="line"><span class="comment">     * @param &#123;Array&#125; center 中心点坐标</span></span><br><span class="line"><span class="comment">     * @param &#123;Array&#125; others 其余点坐标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    drawDynamicLine(map, center, others) &#123;</span><br><span class="line">        <span class="keyword">let</span> style = <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            stroke: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                color: <span class="string">'#EAE911'</span>,</span><br><span class="line">                width: <span class="number">2</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> flightsSource;</span><br><span class="line">        <span class="keyword">let</span> addLater = <span class="function"><span class="keyword">function</span>(<span class="params">feature, timeout</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                feature.set(<span class="string">'start'</span>, <span class="keyword">new</span> <span class="built_in">Date</span>().getTime());</span><br><span class="line">                flightsSource.addFeature(feature);</span><br><span class="line">            &#125;, timeout);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> pointsPerMs = <span class="number">0.1</span>;</span><br><span class="line">        <span class="keyword">let</span> animateFlights = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> vectorContext = event.vectorContext;</span><br><span class="line">            <span class="keyword">let</span> frameState = event.frameState;</span><br><span class="line">            vectorContext.setStyle(style);</span><br><span class="line">            <span class="keyword">let</span> features = flightsSource.getFeatures();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; features.length; i++) &#123;</span><br><span class="line">                <span class="keyword">let</span> feature = features[i];</span><br><span class="line">                <span class="keyword">if</span> (!feature.get(<span class="string">'finished'</span>)) &#123;</span><br><span class="line">                    <span class="keyword">let</span> coords = feature.getGeometry().getCoordinates();</span><br><span class="line">                    <span class="keyword">let</span> elapsedTime = frameState.time - feature.get(<span class="string">'start'</span>);</span><br><span class="line">                    <span class="keyword">let</span> elapsedPoints = elapsedTime * pointsPerMs;</span><br><span class="line">                    <span class="keyword">if</span> (elapsedPoints &gt;= coords.length) &#123;</span><br><span class="line">                        feature.set(<span class="string">'finished'</span>, <span class="literal">true</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">let</span> maxIndex = <span class="built_in">Math</span>.min(elapsedPoints, coords.length);</span><br><span class="line">                    <span class="keyword">let</span> currentLine = <span class="keyword">new</span> ol.geom.LineString(coords.slice(<span class="number">0</span>, maxIndex));</span><br><span class="line">                    <span class="comment">//根据要素来描绘出线条</span></span><br><span class="line">                    vectorContext.drawGeometry(currentLine);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//继续动画效果</span></span><br><span class="line">            map.render();</span><br><span class="line">        &#125;;</span><br><span class="line">        flightsSource = <span class="keyword">new</span> ol.source.Vector(&#123;</span><br><span class="line">            wrapX: <span class="literal">false</span>,</span><br><span class="line">            loader: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; others.length; i++) &#123;</span><br><span class="line">                    <span class="keyword">let</span> <span class="keyword">from</span> = center[<span class="number">0</span>];</span><br><span class="line">                    <span class="keyword">let</span> to = others[i];</span><br><span class="line">                    <span class="comment">//创建一个两个地点之间的弧段</span></span><br><span class="line">                    <span class="keyword">let</span> arcGenerator = <span class="keyword">new</span> arc.GreatCircle(&#123;</span><br><span class="line">                        x: <span class="keyword">from</span>[<span class="number">1</span>],</span><br><span class="line">                        y: <span class="keyword">from</span>[<span class="number">0</span>]</span><br><span class="line">                    &#125;, &#123;</span><br><span class="line">                        x: to[<span class="number">1</span>],</span><br><span class="line">                        y: to[<span class="number">0</span>]</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">let</span> arcLine = arcGenerator.Arc(<span class="number">100</span>, &#123;</span><br><span class="line">                        offset: <span class="number">10</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">if</span> (arcLine.geometries.length === <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">let</span> line = <span class="keyword">new</span> ol.geom.LineString(arcLine.geometries[<span class="number">0</span>].coords);</span><br><span class="line">                        line.transform(ol.proj.get(<span class="string">'EPSG:4326'</span>), ol.proj.get(<span class="string">'EPSG:3857'</span>));</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">let</span> feature = <span class="keyword">new</span> ol.Feature(&#123;</span><br><span class="line">                            geometry: line,</span><br><span class="line">                            finished: <span class="literal">false</span></span><br><span class="line">                        &#125;);</span><br><span class="line">                        <span class="comment">//添加动画的特性与延迟所有功能并不在同一时间开始</span></span><br><span class="line">                        addLater(feature, i * <span class="number">50</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                map.on(<span class="string">'postcompose'</span>, animateFlights);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> flightsLayer = <span class="keyword">new</span> ol.layer.Vector(&#123;</span><br><span class="line">            source: flightsSource,</span><br><span class="line">            style: <span class="function"><span class="keyword">function</span>(<span class="params">feature</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//如果动画仍然是活跃的特性,不渲染图层样式的特性</span></span><br><span class="line">                <span class="keyword">if</span> (feature.get(<span class="string">'finished'</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> style;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        map.addLayer(flightsLayer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为非中心点创建注记</span></span><br><span class="line">    createOtherLabelStyle(feature) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            text: <span class="keyword">new</span> ol.style.Text(&#123;</span><br><span class="line">                <span class="comment">//位置</span></span><br><span class="line">                textAlign: <span class="string">'center'</span>,</span><br><span class="line">                <span class="comment">//基准线</span></span><br><span class="line">                textBaseline: <span class="string">'middle'</span>,</span><br><span class="line">                <span class="comment">//文字样式</span></span><br><span class="line">                font: <span class="string">'normal 10px 微软雅黑'</span>,</span><br><span class="line">                <span class="comment">//文本内容</span></span><br><span class="line">                text: feature.get(<span class="string">'name'</span>),</span><br><span class="line">                <span class="comment">//文本填充样式（即文字颜色）</span></span><br><span class="line">                fill: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                    color: <span class="string">'#aa3300'</span></span><br><span class="line">                &#125;),</span><br><span class="line">                stroke: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                    color: <span class="string">'#ffcc33'</span>,</span><br><span class="line">                    width: <span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为中心点创建注记</span></span><br><span class="line">    createCenterLabelStyle(feature) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            text: <span class="keyword">new</span> ol.style.Text(&#123;</span><br><span class="line">                <span class="comment">//位置</span></span><br><span class="line">                textAlign: <span class="string">'center'</span>,</span><br><span class="line">                <span class="comment">//基准线</span></span><br><span class="line">                textBaseline: <span class="string">'middle'</span>,</span><br><span class="line">                <span class="comment">//文字样式</span></span><br><span class="line">                font: <span class="string">'normal 18px 微软雅黑'</span>,</span><br><span class="line">                <span class="comment">//文本内容</span></span><br><span class="line">                text: feature.get(<span class="string">'name'</span>),</span><br><span class="line">                fill: <span class="keyword">new</span> ol.style.Fill(&#123;</span><br><span class="line">                    color: <span class="string">'#104E8B'</span></span><br><span class="line">                &#125;),</span><br><span class="line">                stroke: <span class="keyword">new</span> ol.style.Stroke(&#123;</span><br><span class="line">                    color: <span class="string">'#104E8B'</span>,</span><br><span class="line">                    width: <span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    createIconStyle(feature, src) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">            <span class="comment">/**&#123;olx.style.IconOptions&#125;类型*/</span></span><br><span class="line">            image: <span class="keyword">new</span> ol.style.Icon(</span><br><span class="line">                (&#123;</span><br><span class="line">                    anchor: [<span class="number">0.5</span>, <span class="number">60</span>],</span><br><span class="line">                    anchorOrigin: <span class="string">'top-right'</span>,</span><br><span class="line">                    anchorXUnits: <span class="string">'fraction'</span>,</span><br><span class="line">                    anchorYUnits: <span class="string">'pixels'</span>,</span><br><span class="line">                    offsetOrigin: <span class="string">'top-right'</span>,</span><br><span class="line">                    opacity: <span class="number">0.75</span>,</span><br><span class="line">                    src: src</span><br><span class="line">                &#125;)</span><br><span class="line">            )</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 添加图层注记</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; map 地图</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; point 点</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; name 名称</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; type 类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    mark(map, point, name, type) &#123;</span><br><span class="line">        <span class="keyword">let</span> iconFeature = <span class="keyword">new</span> ol.Feature(&#123;</span><br><span class="line">            geometry: <span class="keyword">new</span> ol.geom.Point(point),</span><br><span class="line">            name: name,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="number">1</span>) &#123;</span><br><span class="line">            iconFeature.setStyle(<span class="keyword">this</span>.createCenterLabelStyle(iconFeature))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            iconFeature.setStyle(<span class="keyword">this</span>.createOtherLabelStyle(iconFeature));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> vectorSource = <span class="keyword">new</span> ol.source.Vector(&#123;</span><br><span class="line">            features: [iconFeature]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> vectorLayer = <span class="keyword">new</span> ol.layer.Vector(&#123;</span><br><span class="line">            source: vectorSource</span><br><span class="line">        &#125;);</span><br><span class="line">        map.addLayer(vectorLayer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @description 为中心点添加icon</span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; map </span></span><br><span class="line"><span class="comment">     * @param &#123;*&#125; point </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    addIcon(map, point, imgSrc) &#123;</span><br><span class="line">        <span class="keyword">let</span> iconFeature = <span class="keyword">new</span> ol.Feature(&#123;</span><br><span class="line">            geometry: <span class="keyword">new</span> ol.geom.Point(point)</span><br><span class="line">        &#125;);</span><br><span class="line">        iconFeature.setStyle(<span class="keyword">this</span>.createIconStyle(iconFeature, imgSrc));</span><br><span class="line">        <span class="keyword">let</span> vectorSource = <span class="keyword">new</span> ol.source.Vector(&#123;</span><br><span class="line">            features: [iconFeature]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">let</span> vectorLayer = <span class="keyword">new</span> ol.layer.Vector(&#123;</span><br><span class="line">            source: vectorSource</span><br><span class="line">        &#125;);</span><br><span class="line">        map.addLayer(vectorLayer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><div class="post-share"><a href="javascript:;" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2019/07/27/公共库函数封装/&title=《公共库函数封装》 — blog&pic=/images/banner.jpg" data-title="微博"><i class="fa fa-weibo"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信"><i class="fa fa-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://localhost:4000/2019/07/27/公共库函数封装/&title=《公共库函数封装》 — blog&source=下面总结公共库的封装函数（JavaScript），在项目中可以直接使用已封装好的函数库：" data-title="QQ"><i class="fa fa-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2019/07/27/公共库函数封装/" data-title="Facebook"><i class="fa fa-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《公共库函数封装》 — blog&url=http://localhost:4000/2019/07/27/公共库函数封装/&via=http://localhost:4000" data-title="Twitter"><i class="fa fa-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://localhost:4000/2019/07/27/公共库函数封装/" data-title="Google+"><i class="fa fa-google-plus"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:;" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=http://localhost:4000/2019/07/27/公共库函数封装/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"></ul></footer></div></article><aside class="post-toc-pos post-toc-top" id="post-toc"><nav class="post-toc-wrap"><ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#数据处理"><span class="post-toc-text">数据处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#1-常用数据处理"><span class="post-toc-text">1. 常用数据处理</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#2-常用DOM操作"><span class="post-toc-text">2. 常用DOM操作</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#3-常用工具函数"><span class="post-toc-text">3. 常用工具函数</span></a></li></ol></li></ol><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#文件处理"><span class="post-toc-text">文件处理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#1-简单文件处理"><span class="post-toc-text">1. 简单文件处理</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#2-详细文件处理"><span class="post-toc-text">2. 详细文件处理</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#http请求"><span class="post-toc-text">http请求</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#1-axios库封装"><span class="post-toc-text">1. axios库封装</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#2-jsonp封装"><span class="post-toc-text">2. jsonp封装</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#nodejs操作mysql"><span class="post-toc-text">nodejs操作mysql</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#1-直接操作，批量修改值"><span class="post-toc-text">1. 直接操作，批量修改值</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#openlayer绘图函数"><span class="post-toc-text">openlayer绘图函数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#1-图形绘制"><span class="post-toc-text">1. 图形绘制</span></a></li></ol></li></nav></aside><nav id="article-nav"><a href="/2019/07/29/typescript详解/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> typescript详解 </span></a><a href="/2019/07/25/LinValidator源码学习/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">LinValidator源码学习</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="lv-container" data-id="city" data-uid="MTAyMC81MDE5Mi8yNjY4Mg=="><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><p><span id="busuanzi_container_site_uv" style="display:none">总访客数：<span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" style="display:none">总访问量：<span id="busuanzi_value_site_pv"></span></span></p><p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a> &copy; 2020 Yang Pei<br></p></div></div></footer><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script>var mihoConfig={root:"http://localhost:4000",animate:"true",isHome:"false",share:"true"}</script><div class="sidebar"><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/AI/">AI</a><a class="category-link" href="/categories/专题/">专题</a><a class="category-link" href="/categories/前端/">前端</a><a class="category-link" href="/categories/计算机/">计算机</a><a class="category-link" href="/categories/语言/">语言</a></div><div id="sidebar-menu-box-tags"></div></div><a href="javascript:;" class="sidebar-menu-box-close">&times;</a></div>ß<div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">Menus</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/archives"><i class="fa fa-archive"></i><span>全部</span></a></li><li><a href="/categories/AI/"><i class="fa fa-AI"></i><span>AI</span></a></li><li><a href="/categories/前端/"><i class="fa fa-前端"></i><span>前端</span></a></li><li><a href="/categories/计算机/"><i class="fa fa-计算机"></i><span>计算机</span></a></li><li><a href="/categories/语言/"><i class="fa fa-语言"></i><span>语言</span></a></li><li><a href="/categories/专题/"><i class="fa fa-专题"></i><span>专题</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">Tags</span><div id="mobile-header-container-tags"></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:;"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css"><script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script><script src="/js/animate.js"></script><script src="/js/pop-img.js"></script><script>$(".article-entry p img").popImg()</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>