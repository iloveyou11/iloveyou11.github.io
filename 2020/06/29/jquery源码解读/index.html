<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><link rel="stylesheet" href="/js/fancybox/dist/jquery.fancybox.min.css"><title>jquery源码解读 | blog</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="YP's Blog"><meta name="description" content="jquery诞生于2006年1月，至今已经存在14年多的时间了，相信前端开发者都对他有所听闻。虽然现在涌现了很多优秀的前端框架，如vue、react等等，也逐渐取代了传统的jquery开发模式，但是jq作为一款曾风靡前端圈的框架，其优秀的设计思想还是值得开发者好好学习一下的。下面，我们来看jquery具体的源码内容：关于如何读源码曾经，我去阅读源码时，总是喜欢一句不漏的从上到下阅读，怕漏掉什么核心"><meta name="keywords" content="web"><meta property="og:type" content="article"><meta property="og:title" content="jquery源码解读"><meta property="og:url" content="http://localhost:4000/2020/06/29/jquery源码解读/index.html"><meta property="og:site_name" content="blog"><meta property="og:description" content="jquery诞生于2006年1月，至今已经存在14年多的时间了，相信前端开发者都对他有所听闻。虽然现在涌现了很多优秀的前端框架，如vue、react等等，也逐渐取代了传统的jquery开发模式，但是jq作为一款曾风靡前端圈的框架，其优秀的设计思想还是值得开发者好好学习一下的。下面，我们来看jquery具体的源码内容：关于如何读源码曾经，我去阅读源码时，总是喜欢一句不漏的从上到下阅读，怕漏掉什么核心"><meta property="og:locale" content="default"><meta property="og:image" content="https://i.loli.net/2020/08/20/kGEoPl3beZruBgd.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/XEVk1QDrOaI9ChK.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/cprPGZwA6vFdgVT.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/OjiHvEGk1gLlrXP.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/PijH74A5tqEuGna.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/T4XBW9ijp3oVL7d.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/St4QCxYDpwNZuFi.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/sNlFrJ7TIiowSUu.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/gHzu413O5yG9bcL.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/VhOKNsLAQjISP39.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/IsQuA5lEFYUcb2W.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/V3cRjvKzGa4M5Tw.png"><meta property="og:image" content="https://i.loli.net/2020/08/20/zLk7JtvWXHaYANF.png"><meta property="og:updated_time" content="2020-08-26T14:01:20.624Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="jquery源码解读"><meta name="twitter:description" content="jquery诞生于2006年1月，至今已经存在14年多的时间了，相信前端开发者都对他有所听闻。虽然现在涌现了很多优秀的前端框架，如vue、react等等，也逐渐取代了传统的jquery开发模式，但是jq作为一款曾风靡前端圈的框架，其优秀的设计思想还是值得开发者好好学习一下的。下面，我们来看jquery具体的源码内容：关于如何读源码曾经，我去阅读源码时，总是喜欢一句不漏的从上到下阅读，怕漏掉什么核心"><meta name="twitter:image" content="https://i.loli.net/2020/08/20/kGEoPl3beZruBgd.png"><link rel="icon" href="/favicon.ico"><link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"><script src="/js/pace.min.js"></script></head><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script><script src="/js/fancybox/dist/jquery.fancybox.min.js"></script><script src="/js/wrapimg.js"></script></html><body><div id="container"><header id="header"><div id="banner"></div><div id="header-outer"><div id="header-menu" class="header-menu-pos animated"><div class="header-menu-container"><a href="/" class="left"><span class="site-title">YP&#39;s Blog</span></a><nav id="header-menu-nav" class="right"><a href="/"><i class="fa fa-home"></i> <span>主页</span> </a><a href="/categories/前端/"><i class="fa fa-前端"></i> <span>前端</span> </a><a href="/categories/源码/"><i class="fa fa-源码"></i> <span>源码</span> </a><a href="/categories/ML/"><i class="fa fa-ML"></i> <span>ML</span> </a><a href="/categories/CV/"><i class="fa fa-CV"></i> <span>CV</span> </a><a href="/categories/NLP/"><i class="fa fa-NLP"></i> <span>NLP</span> </a><a href="/categories/计算机/"><i class="fa fa-计算机"></i> <span>计算机</span> </a><a href="/categories/专题/"><i class="fa fa-专题"></i> <span>专题</span> </a><a href="/categories/感想/"><i class="fa fa-感想"></i> <span>感想</span> </a><a href="/categories/语言/"><i class="fa fa-语言"></i> <span>语言</span></a></nav><a class="mobile-header-menu-button"><i class="fa fa-bars"></i></a></div></div><div id="header-row"><div id="logo"><a href="/"><img src="/images/logo.png" alt="logo"></a></div><div class="header-info"><div id="header-title"><h2>YP&#39;s Blog</h2></div><div id="header-description"><h3>一个专注前端智能化领域的技术博客</h3></div></div><nav class="header-nav"><div class="social"><a title="MyBlog" target="_blank" href="https://iloveyou11.github.io/"><i class="fa fa-home fa-2x"></i></a> <a title="Github" target="_blank" href="https://github.com/iloveyou11"><i class="fa fa-github fa-2x"></i></a> <a title="JueJin" target="_blank" href="https://juejin.im/user/254742428124055"><i class="fa fa-juejin fa-2x"></i></a></div></nav></div></div></header><div class="outer"><section id="main" class="body-wrap"><article id="post-jquery源码解读" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-inner"><header class="article-header"><h1 class="post-title" itemprop="name">jquery源码解读</h1><div class="post-title-bar"><ul><li><i class="fa fa-book"></i> <a href="/categories/源码/">源码</a></li><li><i class="fa fa-calendar"></i> 2020-06-29</li></ul></div><div style="margin-top:10px"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i> <span class="post-meta-item-text">字数统计: </span><span class="post-count">8.3k字</span> </span></span><span class="post-time">&nbsp; | &nbsp; <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i> <span class="post-meta-item-text">阅读时长: </span><span class="post-count">39分</span></span></span></div></header><div class="article-entry post-content" itemprop="articleBody"><div id="toc"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#关于如何读源码"><span class="toc-text">关于如何读源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jquery架构设计"><span class="toc-text">jquery架构设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题解答"><span class="toc-text">问题解答</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块解读"><span class="toc-text">模块解读</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#定义一系列变量和函数"><span class="toc-text">定义一系列变量和函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#给jQuery对象添加一些方法和属性"><span class="toc-text">给jQuery对象添加一些方法和属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-extend继承方法实现"><span class="toc-text">3. extend继承方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-工具方法汇总"><span class="toc-text">4. 工具方法汇总</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#选择器"><span class="toc-text">选择器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AJAX"><span class="toc-text">AJAX</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动画"><span class="toc-text">动画</span></a></li></ol></li></ol></div><p>jquery诞生于2006年1月，至今已经存在14年多的时间了，相信前端开发者都对他有所听闻。虽然现在涌现了很多优秀的前端框架，如vue、react等等，也逐渐取代了传统的jquery开发模式，但是jq作为一款曾风靡前端圈的框架，其优秀的设计思想还是值得开发者好好学习一下的。下面，我们来看jquery具体的源码内容：</p><h3 id="关于如何读源码"><a href="#关于如何读源码" class="headerlink" title="关于如何读源码"></a>关于如何读源码</h3><p>曾经，我去阅读源码时，总是喜欢一句不漏的从上到下阅读，怕漏掉什么核心代码导致不理解程序的详细流程，遇到一个函数或类就跳过去看，然后……花费了很多的时间而且效果相当不理想。不仅对整体的框架没有大体了解，也让自己像只无头苍蝇，不知道如何抓住重点去深入研究背后的原理。后来看了不少大佬阅读的方式，对我也是收获颇多：不要采用DFS（深度遍历）的方式阅读源码，而是应该先理清框架的架构，再从入口出发，依照流程读下去。这个过程首先应该对框架有一个整体的了解，建议画个流程图或思维脑图，掌握源码的整体处理流程。接下来可以针对源码功能进行个分类，进行深入研究：如阅读koa时，可以分为框架设计和基础结构、中间件实现机制（洋葱模型）、同一错误处理、委托模式、接口安全保障……阅读vue时可以分为框架设计、完整流程、响应式原理、MVVM模型实现、编译原理……哪个部分感兴趣就可以深入探索，整理成文方便自己回顾，会不知不觉地学习到一些优秀的代码架构设计思维和优秀的技巧。少年啊，Fighting！！！</p><h3 id="jquery架构设计"><a href="#jquery架构设计" class="headerlink" title="jquery架构设计"></a>jquery架构设计</h3><p>jquery的设计理念是：The Write Less,Do More（写更少，做更多），具有简洁的API、优雅的链式、强大的查询与便捷的操作。</p><p>jq的三大设计思想：</p><ol><li>利用工厂模式，无new化构建对象</li><li>模块划分明确</li><li>开闭原则的优秀体现</li></ol><p>jquery的整体架构设计如下（此图来自于慕课网）：</p><img src="https://i.loli.net/2020/08/20/kGEoPl3beZruBgd.png" alt="jq架构设计" width="80%"><p>将框架的各部分作精简，提出大体上的架构，知道jquery框架的整体构建思路，再针对各部分进行深入挖掘学习，效果会更好。整体的代码组织架构如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">;(<span class="function"><span class="keyword">function</span>(<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">    factory(global);</span><br><span class="line">&#125;(<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">"undefined"</span> ? <span class="built_in">window</span> : <span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">window, noGlobal</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context );</span><br><span class="line">	&#125;;</span><br><span class="line">	jQuery.fn = jQuery.prototype = &#123;&#125;;</span><br><span class="line">	<span class="comment">// 核心方法</span></span><br><span class="line">	<span class="comment">// 回调系统</span></span><br><span class="line">	<span class="comment">// 异步队列</span></span><br><span class="line">	<span class="comment">// 数据缓存</span></span><br><span class="line">	<span class="comment">// 队列操作</span></span><br><span class="line">	<span class="comment">// 选择器引</span></span><br><span class="line">	<span class="comment">// 属性操作</span></span><br><span class="line">	<span class="comment">// 节点遍历</span></span><br><span class="line">	<span class="comment">// 文档处理</span></span><br><span class="line">	<span class="comment">// 样式操作</span></span><br><span class="line">	<span class="comment">// 属性操作</span></span><br><span class="line">	<span class="comment">// 事件体系</span></span><br><span class="line">	<span class="comment">// AJAX交互</span></span><br><span class="line">	<span class="comment">// 动画引擎</span></span><br><span class="line">	<span class="keyword">return</span> jQuery;</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>以下是整体框架的另一种详细展示:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匿名函数自执行,与其他代码避免冲突</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 21-94 </span></span><br><span class="line">    <span class="comment">// 定义一系列变量和函数</span></span><br><span class="line">    jQuery = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 96-281</span></span><br><span class="line">    <span class="comment">// 给jQuery对象添加一些方法和属性</span></span><br><span class="line">    jQuery.fn = jQuery.prototype = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 285-347</span></span><br><span class="line">    <span class="comment">// jQuery继承方法,很方便去扩展方法</span></span><br><span class="line">    jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 349-816</span></span><br><span class="line">    <span class="comment">// 扩展一些工具方法(静态方法)</span></span><br><span class="line">    jQuery.extend(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 877-2868</span></span><br><span class="line">    <span class="comment">// Sizzle:复杂选择器的实现 </span></span><br><span class="line">    <span class="comment">// Sizzle CSS Selector Engine</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2903 - 3065</span></span><br><span class="line">    <span class="comment">// 回调对象,函数的统一管理</span></span><br><span class="line">    jQuery.Callbacks = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3066-3206</span></span><br><span class="line">    <span class="comment">// Deferred:延迟对象,对异步的统一管理</span></span><br><span class="line">    jQuery.extend(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3206-3220</span></span><br><span class="line">    <span class="comment">// 功能检测:通过功能判断浏览器</span></span><br><span class="line">    jQuery.support = (<span class="function"><span class="keyword">function</span>(<span class="params">support</span>) </span>&#123;&#125;)(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3333-3678</span></span><br><span class="line">    <span class="comment">// data():数据缓存</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Data</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    Data.prototype = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3679-3823</span></span><br><span class="line">    <span class="comment">// 队列管理queue dequeue</span></span><br><span class="line">    jQuery.extend(&#123;</span><br><span class="line">        queue: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        dequeue: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    jQuery.fn.extend(&#123;</span><br><span class="line">        queue: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">        dequeue: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3824-4278</span></span><br><span class="line">    <span class="comment">// 对元素属性的操作</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 事件操作的相关方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5161-6025</span></span><br><span class="line">    <span class="comment">// dom操作封装(添加\删除\筛选)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6025-6638</span></span><br><span class="line">    <span class="comment">// CSS方法(样式操作)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6638-7913</span></span><br><span class="line">    <span class="comment">// ajax操作</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7914-8584</span></span><br><span class="line">    <span class="comment">// animate运动方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8585-8792</span></span><br><span class="line">    <span class="comment">// 位置与尺寸的方法 offsetTop等</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8804-8821</span></span><br><span class="line">    <span class="comment">// jquery支持模块化的模式</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向外提供接口,在window中绑定全局变量</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.document === <span class="string">"object"</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><h3 id="问题解答"><a href="#问题解答" class="headerlink" title="问题解答"></a>问题解答</h3><p><strong>1. 为什么要传入window、undefined？</strong></p><img src="https://i.loli.net/2020/08/20/XEVk1QDrOaI9ChK.png" alt="jq-q1" width="80%"><p>这个问题涉及到作用域链问题：因为js查找变量是根据作用域链查找的，window是做顶端的一层，传入window能减少逐级向上查找的时间。undefined是js变量，而不是关键字，但null是关键字，没必要像undefined一样查找，因此传undefined不传null。</p><p><strong>2. 为什么jq要使用工厂方法，向外暴露的是工厂方法，而vue向外暴露的是类？</strong></p><img src="https://i.loli.net/2020/08/20/cprPGZwA6vFdgVT.png" alt="jq-q2" width="80%"> <img src="https://i.loli.net/2020/08/20/OjiHvEGk1gLlrXP.png" alt="jq-q3" width="80%"><p>因为vue项目中有且只有一个根实例new Vue()，通过改变该实例数据去改变页面展示，不能使用工厂模式；而jq需要用到大量的DOM对象，框架是直接对DOM进行操作的，因此选用了工厂方法。如果我们以后要自己写轮子，要思考一下应用场景，选择暴露工厂方法或类。</p><p><strong>3. jq如何实现的无new化创建对象的呢？应用中使用$()而不是new $()，可以使用以下代码实现吗？</strong></p><p>以下的写法有问题：方法内部又调用了此方法，会造成死循环。</p><img src="https://i.loli.net/2020/08/20/PijH74A5tqEuGna.png" alt="jq-q4" width="80%"><p>以下的写法每次都要同时向这三个对象上注入相同的方法，又会显得“很蠢”</p><img src="https://i.loli.net/2020/08/20/T4XBW9ijp3oVL7d.png" alt="jq-q5" width="80%"><p>jquery是采用共享原型的方法解决了这个问题：</p><img src="https://i.loli.net/2020/08/20/St4QCxYDpwNZuFi.png" alt="jq-q6" width="80%"><p>最终形成的init的的构造图：</p><img src="https://i.loli.net/2020/08/20/sNlFrJ7TIiowSUu.png" alt="jq-init" width="80%"><p>最终通过原型传递解决问题，把jQuery的原型传递给jQuery.prototype.init.prototype。换句话说jQuery的原型对象覆盖了init构造器的原型对象，因为是引用传递所以不需要担心这个循环引用的性能问题。</p><p><strong>4. jq如何实现模块划分明确的？（当时并没有模块化管理方案）</strong></p><img src="https://i.loli.net/2020/08/20/gHzu413O5yG9bcL.png" alt="jq-q7" width="80%"><p>由上图可见，jq没有将所有的方法一股脑地写入prototype中，而是通过extends方法分别将不同的功能模块扩展到原型链上。可以极大方便之后的修改，互不干扰，清晰明了，管理起来非常方便。</p><p><strong>5. extends方法如何实现的？ 以下代码可以实现效果吗？</strong></p><img src="https://i.loli.net/2020/08/20/VhOKNsLAQjISP39.png" alt="jq-q8" width="80%"><p>当传入的只有一个对象时，extend函数将对象的属性全部赋值给jquery对象，当传入的有两个对象Object1、Object2时，extend将Object2的属性全部赋值给Object1。但是以上的代码有个问题：两个for in循环使得代码累赘，如果要实现深拷贝，要同时修改多处，不优雅。</p><p>这时我们可以采用享元模式，减少对象的数量，而jquery正是采用了这样的做法——对这些对象分析，分析出私有的数据和方法，分析出公共的数据和方法。接下来看看采用享元模式修改的代码：</p><img src="https://i.loli.net/2020/08/20/IsQuA5lEFYUcb2W.png" alt="jq-q9" width="80%"><p>其中要注意注意考虑健壮性：如未传入任何参数，传入的参数不是对象等。要注意参数的处理（多态、健壮性、错误处理），两方面：1）多态：支持多种参数，针对不同类型参数做不同的事；2）健壮性：传错了参数或忘记传入参数导致程序报错。</p><p><strong>6. 模块检测支持如何实现？</strong></p><p>支持amd、cmd、commonjs等模块，如下图所示：</p><img src="https://i.loli.net/2020/08/20/V3cRjvKzGa4M5Tw.png" alt="jq-q10" width="80%"><p>如vue中也进行了模块化检测：</p><img src="https://i.loli.net/2020/08/20/zLk7JtvWXHaYANF.png" alt="jq-q11" width="80%"><h3 id="模块解读"><a href="#模块解读" class="headerlink" title="模块解读"></a>模块解读</h3><h4 id="定义一系列变量和函数"><a href="#定义一系列变量和函数" class="headerlink" title="定义一系列变量和函数"></a>定义一系列变量和函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匿名函数自执行,与其他代码避免冲突</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// window 作为参数传入,是为了提高查询速度,也方便压缩时不失去其含义(window变为w等变量仍然会代表window变量)</span></span><br><span class="line"><span class="comment">// undefined 在某些浏览器下是可以被修改掉的,因此应该作为参数传递</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//"use strict";//不建议使用</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 21-94 </span></span><br><span class="line">    <span class="comment">// 定义一系列变量和函数</span></span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">        rootjQuery, <span class="comment">//在后面会赋值为jQuery(document)</span></span><br><span class="line">        readyList, <span class="comment">//DOM加载</span></span><br><span class="line">        core_strundefined = <span class="keyword">typeof</span> <span class="literal">undefined</span>, <span class="comment">//在老版本浏览器下xmlNode.method !== undefined,应该使用typeof undefined=='undefined'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 存成变量,有利于压缩</span></span><br><span class="line">        location = <span class="built_in">window</span>.location,</span><br><span class="line">        <span class="built_in">document</span> = <span class="built_in">window</span>.document,</span><br><span class="line">        docElem = <span class="built_in">document</span>.documentElement,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 为了防止冲突,如引入的其他库中也存在$或jQuery</span></span><br><span class="line">        _jQuery = <span class="built_in">window</span>.jQuery,</span><br><span class="line">        _$ = <span class="built_in">window</span>.$,</span><br><span class="line"></span><br><span class="line">        class2type = &#123;&#125;, <span class="comment">//jquery中类型判断,存储的是js中的类型  $.type</span></span><br><span class="line"></span><br><span class="line">        core_deletedIds = [], <span class="comment">//与数据缓存有关</span></span><br><span class="line"></span><br><span class="line">        core_version = <span class="string">"2.0.3"</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 常用数组方法存储</span></span><br><span class="line">        core_concat = core_deletedIds.concat,</span><br><span class="line">        core_push = core_deletedIds.push,</span><br><span class="line">        core_slice = core_deletedIds.slice,</span><br><span class="line">        core_indexOf = core_deletedIds.indexOf,</span><br><span class="line">        core_toString = class2type.toString,</span><br><span class="line">        core_hasOwn = class2type.hasOwnProperty,</span><br><span class="line">        core_trim = core_version.trim,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 相当于$()与jQuery(),返回的是对象,后面才可以调用方法</span></span><br><span class="line">        jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init(selector, context, rootjQuery);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        core_pnum = <span class="regexp">/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/</span>.source, <span class="comment">// 匹配数字正则</span></span><br><span class="line">        core_rnotwhite = <span class="regexp">/\S+/g</span>, <span class="comment">// 匹配空格正则</span></span><br><span class="line">        rquickExpr = <span class="regexp">/^(?:\s*(&lt;[\w\W]+&gt;)[^&gt;]*|#([\w-]*))$/</span>, <span class="comment">// 匹配html标签,并且防止xss漏洞</span></span><br><span class="line">        rsingleTag = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</span><br><span class="line">        rmsPrefix = <span class="regexp">/^-ms-/</span>, <span class="comment">//检测-ms-前缀.与css驼峰转码有关</span></span><br><span class="line">        rdashAlpha = <span class="regexp">/-([\da-z])/gi</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转驼峰的回调函数</span></span><br><span class="line">        fcamelCase = <span class="function"><span class="keyword">function</span>(<span class="params">all, letter</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> letter.toUpperCase();</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加载完毕后的处理(移除事件监听)</span></span><br><span class="line">        completed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">document</span>.removeEventListener(<span class="string">"DOMContentLoaded"</span>, completed, <span class="literal">false</span>);</span><br><span class="line">            <span class="built_in">window</span>.removeEventListener(<span class="string">"load"</span>, completed, <span class="literal">false</span>);</span><br><span class="line">            jQuery.ready();</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象的沿用,因此针对jQuery.prototype的原型修改和在jQuery.fn.init.prototype原型上进行修改的效果是一样的,因为是同一引用</span></span><br><span class="line">    <span class="comment">// 请看part2</span></span><br><span class="line">    jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line">        <span class="comment">// ......</span></span><br><span class="line">    &#125;</span><br><span class="line">    jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向外提供接口,在window中绑定全局变量</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.document === <span class="string">"object"</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><h4 id="给jQuery对象添加一些方法和属性"><a href="#给jQuery对象添加一些方法和属性" class="headerlink" title="给jQuery对象添加一些方法和属性"></a>给jQuery对象添加一些方法和属性</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 96-281</span></span><br><span class="line">    <span class="comment">// 给jQuery对象添加一些方法和属性</span></span><br><span class="line">    jQuery.fn = jQuery.prototype = &#123;</span><br><span class="line">        jquery: core_version, <span class="comment">//获取jQuery版本,$().jquery获取版本号</span></span><br><span class="line">        <span class="keyword">constructor</span>: jQuery, //js中自动生成 AAA.prototype.<span class="keyword">constructor</span>=AAA,因为写的是jQuery.prototype =&#123;&#125;形式,因此需要修正<span class="keyword">constructor</span>指向</span><br><span class="line">        // 补充js知识:</span><br><span class="line">        // function AAA &#123;&#125;;</span><br><span class="line">        <span class="comment">// 方法1</span></span><br><span class="line">        <span class="comment">// AAA.prototype.name = 'zhang';</span></span><br><span class="line">        <span class="comment">// AAA.prototype.age = 12;</span></span><br><span class="line">        <span class="comment">// AAA.prototype.constructor=AAA; 成立</span></span><br><span class="line">        <span class="comment">// 方法2</span></span><br><span class="line">        <span class="comment">// AAA.prototype = &#123;</span></span><br><span class="line">        <span class="comment">//     name: 'zhang',</span></span><br><span class="line">        <span class="comment">//     age: 12</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// AAA.prototype.constructor=Object; 成立</span></span><br><span class="line">        <span class="comment">// 因此需要手动修复constructor指向,AAA.prototype.constructor=AAA</span></span><br><span class="line"></span><br><span class="line">        init: <span class="function"><span class="keyword">function</span>(<span class="params">selector, context, rootjQuery</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> match, elem;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 过滤不正确元素 $(""), $(null), $(undefined), $(false)</span></span><br><span class="line">            <span class="keyword">if</span> (!selector) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 补充js知识:</span></span><br><span class="line">            <span class="comment">// $('li').css('background','red');</span></span><br><span class="line">            <span class="comment">// 如果存为带有length属性的json变量,可以遍历赋值</span></span><br><span class="line">            <span class="comment">// this = &#123;</span></span><br><span class="line">            <span class="comment">//     0: 'li',</span></span><br><span class="line">            <span class="comment">//     1: 'li',</span></span><br><span class="line">            <span class="comment">//     2: 'li',</span></span><br><span class="line">            <span class="comment">//     length: 3</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// for (var i = 0; i &lt; this.length; i++) &#123;</span></span><br><span class="line">            <span class="comment">//     this[i].style.background = 'red';</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 根据selector种类进行处理</span></span><br><span class="line">            <span class="comment">// 1)如果selector是字符串</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> selector === <span class="string">"string"</span>) &#123;</span><br><span class="line">                <span class="comment">// 检测是否为标签(创建标签)</span></span><br><span class="line">                <span class="keyword">if</span> (selector.charAt(<span class="number">0</span>) === <span class="string">"&lt;"</span> &amp;&amp; selector.charAt(selector.length - <span class="number">1</span>) === <span class="string">"&gt;"</span> &amp;&amp; selector.length &gt;= <span class="number">3</span>) &#123;</span><br><span class="line">                    match = [<span class="literal">null</span>, selector, <span class="literal">null</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    match = rquickExpr.exec(selector);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 创建id或是创建标签 $('#id) $('&lt;div&gt;hello&lt;/div&gt;')</span></span><br><span class="line">                <span class="keyword">if</span> (match &amp;&amp; (match[<span class="number">1</span>] || !context)) &#123;</span><br><span class="line">                    <span class="comment">// 创建标签</span></span><br><span class="line">                    <span class="keyword">if</span> (match[<span class="number">1</span>]) &#123;</span><br><span class="line">                        context = context <span class="keyword">instanceof</span> jQuery ? context[<span class="number">0</span>] : context; <span class="comment">//创建标签的上下文,制定document(考虑iframe,需要传入contentWindow.document)</span></span><br><span class="line">                        <span class="comment">// jQuery.parseHTML:将字符串转化为DOM数组</span></span><br><span class="line">                        <span class="comment">// jQuery.merge是数组的合并操作(对外提供数组合并,对内提供特殊的json合并)</span></span><br><span class="line">                        jQuery.merge(<span class="keyword">this</span>, jQuery.parseHTML(</span><br><span class="line">                            match[<span class="number">1</span>],</span><br><span class="line">                            context &amp;&amp; context.nodeType ? context.ownerDocument || context : <span class="built_in">document</span>,</span><br><span class="line">                            <span class="literal">true</span> <span class="comment">//parseHTML这个参数是看script是否能添加进来</span></span><br><span class="line">                        ));</span><br><span class="line">                        <span class="comment">// 处理: $(html, props)形式,如$("li",&#123;title:'hello'&#125;)</span></span><br><span class="line">                        <span class="comment">// rsingleTag匹配单标签</span></span><br><span class="line">                        <span class="keyword">if</span> (rsingleTag.test(match[<span class="number">1</span>]) &amp;&amp; jQuery.isPlainObject(context)) &#123;</span><br><span class="line">                            <span class="keyword">for</span> (match <span class="keyword">in</span> context) &#123;</span><br><span class="line">                                <span class="comment">// 执行jQuery方法,如$("li",&#123;html:'text'&#125;),执行$('li').html('text')方法 </span></span><br><span class="line">                                <span class="keyword">if</span> (jQuery.isFunction(<span class="keyword">this</span>[match])) &#123;</span><br><span class="line">                                    <span class="keyword">this</span>[match](context[match]);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    <span class="comment">// 添加属性,如$("li",&#123;title:'hello'&#125;)</span></span><br><span class="line">                                    <span class="keyword">this</span>.attr(match, context[match]);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="comment">// 获取id的element</span></span><br><span class="line">                        elem = <span class="built_in">document</span>.getElementById(match[<span class="number">2</span>]); <span class="comment">//想要的id</span></span><br><span class="line">                        <span class="comment">// 存成json形式</span></span><br><span class="line">                        <span class="keyword">if</span> (elem &amp;&amp; elem.parentNode) &#123;</span><br><span class="line">                            <span class="keyword">this</span>.length = <span class="number">1</span>;</span><br><span class="line">                            <span class="keyword">this</span>[<span class="number">0</span>] = elem;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">this</span>.context = <span class="built_in">document</span>;</span><br><span class="line">                        <span class="keyword">this</span>.selector = selector;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!context || context.jquery) &#123;</span><br><span class="line">                    <span class="comment">// 处理 $(expr, $(...))</span></span><br><span class="line">                    <span class="comment">// find-&gt;Sissle库</span></span><br><span class="line">                    <span class="comment">// rootjQuery是jQuery(document)</span></span><br><span class="line">                    <span class="keyword">return</span> (context || rootjQuery).find(selector);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 处理$(expr, context)</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>.constructor(context).find(selector);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (selector.nodeType) &#123;</span><br><span class="line">                <span class="comment">// 2) 如果selector是DOM节点, 如$(this) $(document)</span></span><br><span class="line">                <span class="keyword">this</span>.context = <span class="keyword">this</span>[<span class="number">0</span>] = selector;</span><br><span class="line">                <span class="keyword">this</span>.length = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (jQuery.isFunction(selector)) &#123;</span><br><span class="line">                <span class="comment">// 3)selector是函数</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// $(function() &#123;&#125;) 还是调的$(document).ready(function() &#123;&#125;)方法</span></span><br><span class="line">                <span class="keyword">return</span> rootjQuery.ready(selector);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对特殊情况作处理,如$(&#123;&#125;) $([]) $($('div'))</span></span><br><span class="line">            <span class="keyword">if</span> (selector.selector !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.selector = selector.selector;</span><br><span class="line">                <span class="keyword">this</span>.context = selector.context;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// jQuery.makeArray方法将伪数组转化为真正的数组,传递第二个参数是属于内部方法,最后会转化为json(含有length属性)</span></span><br><span class="line">            <span class="keyword">return</span> jQuery.makeArray(selector, <span class="keyword">this</span>);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        selector: <span class="string">""</span>,</span><br><span class="line">        length: <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 方法定义</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转数组</span></span><br><span class="line">        toArray: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 调用slice方法,在json环境下去执行.会返回数组</span></span><br><span class="line">            <span class="comment">// 如:</span></span><br><span class="line">            <span class="comment">// let arr = &#123;</span></span><br><span class="line">            <span class="comment">//     0: 'hello',</span></span><br><span class="line">            <span class="comment">//     1: 'hello',</span></span><br><span class="line">            <span class="comment">//     2: 'hello',</span></span><br><span class="line">            <span class="comment">//     length: 3</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">            <span class="comment">// let realArr = arr.slice() //转化为了真正的数组['hello','hello','hello']</span></span><br><span class="line">            <span class="keyword">return</span> core_slice.call(<span class="keyword">this</span>);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转原生集合,可以调用原生DOM方法</span></span><br><span class="line">        <span class="keyword">get</span>: function(num) &#123;</span><br><span class="line">            <span class="keyword">return</span> num == <span class="literal">null</span> ?</span><br><span class="line">                <span class="keyword">this</span>.toArray() :</span><br><span class="line">                (num &lt; <span class="number">0</span> ? <span class="keyword">this</span>[<span class="keyword">this</span>.length + num] : <span class="keyword">this</span>[num]); <span class="comment">//找集合中的第num个</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// jQuery的入栈处理(先进后出)</span></span><br><span class="line">        pushStack: <span class="function"><span class="keyword">function</span>(<span class="params">elems</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> ret = jQuery.merge(<span class="keyword">this</span>.constructor(), elems);</span><br><span class="line">            <span class="comment">// 举例:$('div').pushStack($('span')).css('background','red').end().css('background','yellow')</span></span><br><span class="line">            <span class="comment">// 含义是:将span元素变red,div元素变yellow</span></span><br><span class="line">            ret.prevObject = <span class="keyword">this</span>; <span class="comment">//可以通过end找到stack的下一级</span></span><br><span class="line">            ret.context = <span class="keyword">this</span>.context;</span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过工具方法jQuery.each实现</span></span><br><span class="line">        each: <span class="function"><span class="keyword">function</span>(<span class="params">callback, args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> jQuery.each(<span class="keyword">this</span>, callback, args);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 调用jQuery.ready</span></span><br><span class="line">        ready: <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">            jQuery.ready.promise().done(fn);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 入栈</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.pushStack(core_slice.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>));</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 找第一项</span></span><br><span class="line">        first: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.eq(<span class="number">0</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 找最后一项</span></span><br><span class="line">        last: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.eq(<span class="number">-1</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 找第i项</span></span><br><span class="line">        eq: <span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> len = <span class="keyword">this</span>.length,</span><br><span class="line">                j = +i + (i &lt; <span class="number">0</span> ? len : <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.pushStack(j &gt;= <span class="number">0</span> &amp;&amp; j &lt; len ? [<span class="keyword">this</span>[j]] : []);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// map操作</span></span><br><span class="line">        map: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// 调用jQuery.map</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.pushStack(jQuery.map(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span>(<span class="params">elem, i</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> callback.call(elem, i, elem);</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 回溯到栈的下一层</span></span><br><span class="line">        end: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.prevObject || <span class="keyword">this</span>.constructor(<span class="literal">null</span>);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数组方法,作为内部使用,不建议在外部使用</span></span><br><span class="line">        push: core_push,</span><br><span class="line">        sort: [].sort,</span><br><span class="line">        splice: [].splice</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对象的沿用,因此针对jQuery.prototype的原型修改和在jQuery.fn.init.prototype原型上进行修改的效果是一样的,因为是同一引用</span></span><br><span class="line">    jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.document === <span class="string">"object"</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><h4 id="3-extend继承方法实现"><a href="#3-extend继承方法实现" class="headerlink" title="3. extend继承方法实现"></a>3. extend继承方法实现</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</span><br><span class="line">    jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 285-347</span></span><br><span class="line">    <span class="comment">// jQuery继承方法,很方便去扩展方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// jQuery.extend扩展静态方法,jQuery.fn.extend扩展实例方法(jQuery.fn.extend相当于jQuery.prototype.extend)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基本使用:</span></span><br><span class="line">    <span class="comment">// $.extend() </span></span><br><span class="line">    <span class="comment">// 1)当只写一个对象自变量的时候,是JQ中扩展插件的形式</span></span><br><span class="line">    <span class="comment">// 如:</span></span><br><span class="line">    <span class="comment">// $.extend(&#123; //扩展工具方法</span></span><br><span class="line">    <span class="comment">//     aa:function()&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//     bb:function()&#123;&#125;</span></span><br><span class="line">    <span class="comment">// &#125;) </span></span><br><span class="line">    <span class="comment">// $.aa  \   $.bb</span></span><br><span class="line">    <span class="comment">// 2)当写多个对象的时候,后面的对象都是扩展到第一个对象之上</span></span><br><span class="line">    <span class="comment">// 如:</span></span><br><span class="line">    <span class="comment">// $.extend(a,&#123;name:'wang',age:21&#125;)</span></span><br><span class="line">    <span class="comment">// 3)还可以做深拷贝和浅拷贝</span></span><br><span class="line">    <span class="comment">// var a=&#123;a:1&#125;,b=&#123;b:1&#125;</span></span><br><span class="line">    <span class="comment">// $.extend(a,b) 浅拷贝</span></span><br><span class="line">    <span class="comment">// $.extend(true,a,b) 深拷贝</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// $.fn.extend()</span></span><br><span class="line">    <span class="comment">// 如:</span></span><br><span class="line">    <span class="comment">// $.extend(&#123; //扩展JQ实例方法</span></span><br><span class="line">    <span class="comment">//     aa:function()&#123;&#125;,</span></span><br><span class="line">    <span class="comment">//     bb:function()&#123;&#125;</span></span><br><span class="line">    <span class="comment">// &#125;) </span></span><br><span class="line">    <span class="comment">// $('div').aa  \  $('div').bb</span></span><br><span class="line"></span><br><span class="line">    jQuery.extend = jQuery.fn.extend = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> options, name, src, copy, copyIsArray, clone,</span><br><span class="line">            target = <span class="built_in">arguments</span>[<span class="number">0</span>] || &#123;&#125;,</span><br><span class="line">            i = <span class="number">1</span>,</span><br><span class="line">            length = <span class="built_in">arguments</span>.length,</span><br><span class="line">            deep = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 看是不是深拷贝</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> target === <span class="string">"boolean"</span>) &#123;</span><br><span class="line">            deep = target;</span><br><span class="line">            target = <span class="built_in">arguments</span>[<span class="number">1</span>] || &#123;&#125;;</span><br><span class="line">            i = <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 看参数是否正确</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> target !== <span class="string">"object"</span> &amp;&amp; !jQuery.isFunction(target)) &#123;</span><br><span class="line">            target = &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 看是不是插件情况下</span></span><br><span class="line">        <span class="keyword">if</span> (length === i) &#123;</span><br><span class="line">            target = <span class="keyword">this</span>;</span><br><span class="line">            --i;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 可能有多个对象的情况下</span></span><br><span class="line">        <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((options = <span class="built_in">arguments</span>[i]) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (name <span class="keyword">in</span> options) &#123;</span><br><span class="line">                    src = target[name];</span><br><span class="line">                    copy = options[name];</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 防止循环引用</span></span><br><span class="line">                    <span class="keyword">if</span> (target === copy) &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 深拷贝</span></span><br><span class="line">                    <span class="keyword">if</span> (deep &amp;&amp; copy &amp;&amp; (jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)))) &#123;</span><br><span class="line">                        <span class="comment">// 补充实例:</span></span><br><span class="line">                        <span class="comment">// var a=&#123;person:&#123;name:'zhang'&#125;&#125;,b=&#123;person:&#123;age:23&#125;&#125;</span></span><br><span class="line">                        <span class="comment">// $.extend(true,a,b)</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">// JQ:拷贝继承</span></span><br><span class="line">                        <span class="comment">// JS:类式继承/原型继承</span></span><br><span class="line">                        <span class="keyword">if</span> (copyIsArray) &#123;</span><br><span class="line">                            copyIsArray = <span class="literal">false</span>;</span><br><span class="line">                            clone = src &amp;&amp; jQuery.isArray(src) ? src : [];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : &#123;&#125;;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 使用递归</span></span><br><span class="line">                        target[name] = jQuery.extend(deep, clone, copy);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (copy !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                        <span class="comment">// 浅拷贝,value不是对象类型,直接赋值即可</span></span><br><span class="line">                        target[name] = copy;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.document === <span class="string">"object"</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><h4 id="4-工具方法汇总"><a href="#4-工具方法汇总" class="headerlink" title="4. 工具方法汇总"></a>4. 工具方法汇总</h4><p>所含有的工具方法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</span><br><span class="line">    jQuery.extend(&#123;</span><br><span class="line">        noConflict: <span class="function"><span class="keyword">function</span>(<span class="params">deep</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        ready: <span class="function"><span class="keyword">function</span>(<span class="params">wait</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否为函数</span></span><br><span class="line">        isFunction: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否为数组</span></span><br><span class="line">        isArray: <span class="built_in">Array</span>.isArray,</span><br><span class="line">        <span class="comment">// 检测是否为window对象</span></span><br><span class="line">        isWindow: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否为数字</span></span><br><span class="line">        <span class="comment">// 使用typeof方法判断不太靠谱,能把NaN判断为number类型</span></span><br><span class="line">        isNumeric: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 判断数据类型</span></span><br><span class="line">        type: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否是普通对象</span></span><br><span class="line">        <span class="comment">// 非普通对象的情况:type不是"[object Object]" \ dom元素 \ window</span></span><br><span class="line">        isPlainObject: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否为空对象</span></span><br><span class="line">        isEmptyObject: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 抛出异常</span></span><br><span class="line">        error: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析节点,将字符串转化为HTML DOM数组</span></span><br><span class="line">        parseHTML: <span class="function"><span class="keyword">function</span>(<span class="params">data, context, keepScripts</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析JSON,不兼容IE6/7</span></span><br><span class="line">        parseJSON: <span class="built_in">JSON</span>.parse,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析XML</span></span><br><span class="line">        parseXML: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 返回空函数</span></span><br><span class="line">        noop: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在全局环境下执行js代码</span></span><br><span class="line">        globalEval: <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换CSS</span></span><br><span class="line">        camelCase: <span class="function"><span class="keyword">function</span>(<span class="params">string</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 是否为指定节点名</span></span><br><span class="line">        nodeName: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// args参数仅作为内部使用</span></span><br><span class="line">        each: <span class="function"><span class="keyword">function</span>(<span class="params">obj, callback, args</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        trim: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// results仅作为内部使用</span></span><br><span class="line">        <span class="comment">// 将伪数组转化为真正的数组</span></span><br><span class="line">        makeArray: <span class="function"><span class="keyword">function</span>(<span class="params">arr, results</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        inArray: <span class="function"><span class="keyword">function</span>(<span class="params">elem, arr, i</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        merge: <span class="function"><span class="keyword">function</span>(<span class="params">first, second</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        grep: <span class="function"><span class="keyword">function</span>(<span class="params">elems, callback, inv</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// arg参数仅作为内部使用</span></span><br><span class="line">        map: <span class="function"><span class="keyword">function</span>(<span class="params">elems, callback, arg</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 绑定函数到指定的上下文</span></span><br><span class="line">        proxy: <span class="function"><span class="keyword">function</span>(<span class="params">fn, context</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        access: <span class="function"><span class="keyword">function</span>(<span class="params">elems, fn, key, value, chainable, emptyGet, raw</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        now: <span class="built_in">Date</span>.now,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// A method for quickly swapping in/out CSS properties to get correct calculations.</span></span><br><span class="line">        swap: <span class="function"><span class="keyword">function</span>(<span class="params">elem, options, callback, args</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    jQuery.ready.promise = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算class2type map</span></span><br><span class="line">    jQuery.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">        class2type[<span class="string">"[object "</span> + name + <span class="string">"]"</span>] = name.toLowerCase();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isArraylike</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.document === <span class="string">"object"</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><p>工具类方法详细展示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">window, undefined</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 349-816</span></span><br><span class="line">    <span class="comment">// 扩展一些工具方法(静态方法),jQuery最底层的方法</span></span><br><span class="line">    jQuery.extend(&#123;</span><br><span class="line">        <span class="comment">// 生成唯一jQuery字符串(内部方法,对外未提供接口),唯一性,可以做映射关系</span></span><br><span class="line">        expando: <span class="string">"jQuery"</span> + (core_version + <span class="built_in">Math</span>.random()).replace(<span class="regexp">/\D/g</span>, <span class="string">""</span>),</span><br><span class="line">        <span class="comment">// 防止冲突</span></span><br><span class="line">        <span class="comment">// 举例:</span></span><br><span class="line">        <span class="comment">// var _$ = $.noConflict()</span></span><br><span class="line">        <span class="comment">// _$(function()&#123;</span></span><br><span class="line">        <span class="comment">//      alert($)  //仍然弹出原始定义的$</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在前面part1部分,</span></span><br><span class="line">        <span class="comment">// 已经定义过两个变量:</span></span><br><span class="line">        <span class="comment">// _jQuery=window.jQuery</span></span><br><span class="line">        <span class="comment">// _$=window.$</span></span><br><span class="line"></span><br><span class="line">        noConflict: <span class="function"><span class="keyword">function</span>(<span class="params">deep</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">window</span>.$ === jQuery) &#123;</span><br><span class="line">                <span class="built_in">window</span>.$ = _$;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (deep &amp;&amp; <span class="built_in">window</span>.jQuery === jQuery) &#123;</span><br><span class="line">                <span class="built_in">window</span>.jQuery = _jQuery;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> jQuery;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// $(function()&#123;&#125;) 等DOM加载完.时机早于window.onload,原生中的DOM加载结束事件是DOMContentLoaded</span></span><br><span class="line">        <span class="comment">// window.onload=function()&#123;&#125; 等全部资源加载完</span></span><br><span class="line">        isReady: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">        readyWait: <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">        holdReady: <span class="function"><span class="keyword">function</span>(<span class="params">hold</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (hold) &#123;</span><br><span class="line">                jQuery.readyWait++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                jQuery.ready(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 这是工具方法,$.ready()</span></span><br><span class="line">        ready: <span class="function"><span class="keyword">function</span>(<span class="params">wait</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (wait === <span class="literal">true</span> ? --jQuery.readyWait : jQuery.isReady) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            jQuery.isReady = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (wait !== <span class="literal">true</span> &amp;&amp; --jQuery.readyWait &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            readyList.resolveWith(<span class="built_in">document</span>, [jQuery]);</span><br><span class="line">            <span class="keyword">if</span> (jQuery.fn.trigger) &#123;</span><br><span class="line">                jQuery(<span class="built_in">document</span>).trigger(<span class="string">"ready"</span>).off(<span class="string">"ready"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检测是否为函数</span></span><br><span class="line">        isFunction: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> jQuery.type(obj) === <span class="string">"function"</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否为数组</span></span><br><span class="line">        isArray: <span class="built_in">Array</span>.isArray,</span><br><span class="line">        <span class="comment">// 检测是否为window对象</span></span><br><span class="line">        isWindow: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj === obj.window;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否为数字</span></span><br><span class="line">        <span class="comment">// 使用typeof方法判断不太靠谱,能把NaN判断为number类型</span></span><br><span class="line">        isNumeric: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> !<span class="built_in">isNaN</span>(<span class="built_in">parseFloat</span>(obj)) &amp;&amp; <span class="built_in">isFinite</span>(obj);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 判断数据类型</span></span><br><span class="line">        type: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (obj == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">String</span>(obj);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">typeof</span> obj === <span class="string">"object"</span> || <span class="keyword">typeof</span> obj === <span class="string">"function"</span> ?</span><br><span class="line">                class2type[core_toString.call(obj)] || <span class="string">"object"</span> :</span><br><span class="line">                <span class="keyword">typeof</span> obj;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否是普通对象</span></span><br><span class="line">        <span class="comment">// 非普通对象的情况:type不是"[object Object]" \ dom元素 \ window</span></span><br><span class="line">        isPlainObject: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (jQuery.type(obj) !== <span class="string">"object"</span> || obj.nodeType || jQuery.isWindow(obj)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (obj.constructor &amp;&amp;</span><br><span class="line">                    !core_hasOwn.call(obj.constructor.prototype, <span class="string">"isPrototypeOf"</span>)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 检测是否为空对象</span></span><br><span class="line">        isEmptyObject: <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> name;</span><br><span class="line">            <span class="keyword">for</span> (name <span class="keyword">in</span> obj) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 抛出异常</span></span><br><span class="line">        error: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(msg);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析节点,将字符串转化为HTML DOM数组</span></span><br><span class="line">        parseHTML: <span class="function"><span class="keyword">function</span>(<span class="params">data, context, keepScripts</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data !== <span class="string">"string"</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> context === <span class="string">"boolean"</span>) &#123;</span><br><span class="line">                keepScripts = context;</span><br><span class="line">                context = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            context = context || <span class="built_in">document</span>;</span><br><span class="line">            <span class="comment">// rsingleTag为单标签正则</span></span><br><span class="line">            <span class="keyword">var</span> parsed = rsingleTag.exec(data),</span><br><span class="line">                scripts = !keepScripts &amp;&amp; [];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理单标签创建问题</span></span><br><span class="line">            <span class="keyword">if</span> (parsed) &#123;</span><br><span class="line">                <span class="keyword">return</span> [context.createElement(parsed[<span class="number">1</span>])];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 处理多标签创建问题</span></span><br><span class="line">            parsed = jQuery.buildFragment([data], context, scripts);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (scripts) &#123;</span><br><span class="line">                jQuery(scripts).remove();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> jQuery.merge([], parsed.childNodes);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析JSON,不兼容IE6/7</span></span><br><span class="line">        parseJSON: <span class="built_in">JSON</span>.parse,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析XML</span></span><br><span class="line">        parseXML: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> xml, tmp;</span><br><span class="line">            <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data !== <span class="string">"string"</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 支持 IE9</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                tmp = <span class="keyword">new</span> DOMParser();</span><br><span class="line">                xml = tmp.parseFromString(data, <span class="string">"text/xml"</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                xml = <span class="literal">undefined</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!xml || xml.getElementsByTagName(<span class="string">"parsererror"</span>).length) &#123;</span><br><span class="line">                jQuery.error(<span class="string">"Invalid XML: "</span> + data);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> xml;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 返回空函数</span></span><br><span class="line">        noop: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在全局环境下执行js代码</span></span><br><span class="line">        globalEval: <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> script,</span><br><span class="line">                indirect = <span class="built_in">eval</span>;</span><br><span class="line"></span><br><span class="line">            code = jQuery.trim(code);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (code) &#123;</span><br><span class="line">                <span class="comment">// 在严格模式下,不支持eval,则创建script标签插入document,执行此代码</span></span><br><span class="line">                <span class="keyword">if</span> (code.indexOf(<span class="string">"use strict"</span>) === <span class="number">1</span>) &#123;</span><br><span class="line">                    script = <span class="built_in">document</span>.createElement(<span class="string">"script"</span>);</span><br><span class="line">                    script.text = code;</span><br><span class="line">                    <span class="built_in">document</span>.head.appendChild(script).parentNode.removeChild(script);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// 正常模式下,直接使用eval解析js即可</span></span><br><span class="line">                    indirect(code);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 转换CSS</span></span><br><span class="line">        camelCase: <span class="function"><span class="keyword">function</span>(<span class="params">string</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> string.replace(rmsPrefix, <span class="string">"ms-"</span>).replace(rdashAlpha, fcamelCase);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 是否为指定节点名</span></span><br><span class="line">        nodeName: <span class="function"><span class="keyword">function</span>(<span class="params">elem, name</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> elem.nodeName &amp;&amp; elem.nodeName.toLowerCase() === name.toLowerCase();</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// args参数仅作为内部使用</span></span><br><span class="line">        each: <span class="function"><span class="keyword">function</span>(<span class="params">obj, callback, args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> value,</span><br><span class="line">                i = <span class="number">0</span>,</span><br><span class="line">                length = obj.length,</span><br><span class="line">                isArray = isArraylike(obj);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (args) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isArray) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">                        value = callback.apply(obj[i], args);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (value === <span class="literal">false</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">for</span> (i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">                        value = callback.apply(obj[i], args);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (value === <span class="literal">false</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (isArray) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">                        value = callback.call(obj[i], i, obj[i]);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (value === <span class="literal">false</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">for</span> (i <span class="keyword">in</span> obj) &#123;</span><br><span class="line">                        value = callback.call(obj[i], i, obj[i]);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (value === <span class="literal">false</span>) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        trim: <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> text == <span class="literal">null</span> ? <span class="string">""</span> : core_trim.call(text);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// results仅作为内部使用</span></span><br><span class="line">        <span class="comment">// 将伪数组转化为真正的数组</span></span><br><span class="line">        makeArray: <span class="function"><span class="keyword">function</span>(<span class="params">arr, results</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> ret = results || [];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (arr != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isArraylike(<span class="built_in">Object</span>(arr))) &#123;</span><br><span class="line">                    jQuery.merge(ret,</span><br><span class="line">                        <span class="keyword">typeof</span> arr === <span class="string">"string"</span> ? [arr] : arr</span><br><span class="line">                    );</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    core_push.call(ret, arr);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        inArray: <span class="function"><span class="keyword">function</span>(<span class="params">elem, arr, i</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> arr == <span class="literal">null</span> ? <span class="number">-1</span> : core_indexOf.call(arr, elem, i);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        merge: <span class="function"><span class="keyword">function</span>(<span class="params">first, second</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> l = second.length,</span><br><span class="line">                i = first.length,</span><br><span class="line">                j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> l === <span class="string">"number"</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (; j &lt; l; j++) &#123;</span><br><span class="line">                    first[i++] = second[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (second[j] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                    first[i++] = second[j++];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            first.length = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> first;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        grep: <span class="function"><span class="keyword">function</span>(<span class="params">elems, callback, inv</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> retVal,</span><br><span class="line">                ret = [],</span><br><span class="line">                i = <span class="number">0</span>,</span><br><span class="line">                length = elems.length;</span><br><span class="line">            inv = !!inv;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">                retVal = !!callback(elems[i], i);</span><br><span class="line">                <span class="keyword">if</span> (inv !== retVal) &#123;</span><br><span class="line">                    ret.push(elems[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// arg参数仅作为内部使用</span></span><br><span class="line">        map: <span class="function"><span class="keyword">function</span>(<span class="params">elems, callback, arg</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> value,</span><br><span class="line">                i = <span class="number">0</span>,</span><br><span class="line">                length = elems.length,</span><br><span class="line">                isArray = isArraylike(elems),</span><br><span class="line">                ret = [];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (isArray) &#123;</span><br><span class="line">                <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">                    value = callback(elems[i], i, arg);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">                        ret[ret.length] = value;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (i <span class="keyword">in</span> elems) &#123;</span><br><span class="line">                    value = callback(elems[i], i, arg);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">                        ret[ret.length] = value;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> core_concat.apply([], ret);</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        guid: <span class="number">1</span>, <span class="comment">//GUID</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 绑定函数到指定的上下文</span></span><br><span class="line">        proxy: <span class="function"><span class="keyword">function</span>(<span class="params">fn, context</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> tmp, args, proxy;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> context === <span class="string">"string"</span>) &#123;</span><br><span class="line">                tmp = fn[context];</span><br><span class="line">                context = fn;</span><br><span class="line">                fn = tmp;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!jQuery.isFunction(fn)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            args = core_slice.call(<span class="built_in">arguments</span>, <span class="number">2</span>);</span><br><span class="line">            proxy = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> fn.apply(context || <span class="keyword">this</span>, args.concat(core_slice.call(<span class="built_in">arguments</span>)));</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            proxy.guid = fn.guid = fn.guid || jQuery.guid++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> proxy;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        access: <span class="function"><span class="keyword">function</span>(<span class="params">elems, fn, key, value, chainable, emptyGet, raw</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> i = <span class="number">0</span>,</span><br><span class="line">                length = elems.length,</span><br><span class="line">                bulk = key == <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Sets many values</span></span><br><span class="line">            <span class="keyword">if</span> (jQuery.type(key) === <span class="string">"object"</span>) &#123;</span><br><span class="line">                chainable = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">for</span> (i <span class="keyword">in</span> key) &#123;</span><br><span class="line">                    jQuery.access(elems, fn, i, key[i], <span class="literal">true</span>, emptyGet, raw);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Sets one value</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                chainable = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!jQuery.isFunction(value)) &#123;</span><br><span class="line">                    raw = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (bulk) &#123;</span><br><span class="line">                    <span class="comment">// Bulk operations run against the entire set</span></span><br><span class="line">                    <span class="keyword">if</span> (raw) &#123;</span><br><span class="line">                        fn.call(elems, value);</span><br><span class="line">                        fn = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// ...except when executing function values</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        bulk = fn;</span><br><span class="line">                        fn = <span class="function"><span class="keyword">function</span>(<span class="params">elem, key, value</span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> bulk.call(jQuery(elem), value);</span><br><span class="line">                        &#125;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (fn) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (; i &lt; length; i++) &#123;</span><br><span class="line">                        fn(elems[i], key, raw ? value : value.call(elems[i], i, fn(elems[i], key)));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> chainable ?</span><br><span class="line">                elems :</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Gets</span></span><br><span class="line">                bulk ?</span><br><span class="line">                fn.call(elems) :</span><br><span class="line">                length ? fn(elems[<span class="number">0</span>], key) : emptyGet;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        now: <span class="built_in">Date</span>.now,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// A method for quickly swapping in/out CSS properties to get correct calculations.</span></span><br><span class="line">        swap: <span class="function"><span class="keyword">function</span>(<span class="params">elem, options, callback, args</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> ret, name,</span><br><span class="line">                old = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Remember the old values, and insert the new ones</span></span><br><span class="line">            <span class="keyword">for</span> (name <span class="keyword">in</span> options) &#123;</span><br><span class="line">                old[name] = elem.style[name];</span><br><span class="line">                elem.style[name] = options[name];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ret = callback.apply(elem, args || []);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Revert the old values</span></span><br><span class="line">            <span class="keyword">for</span> (name <span class="keyword">in</span> options) &#123;</span><br><span class="line">                elem.style[name] = old[name];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    jQuery.ready.promise = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!readyList) &#123;</span><br><span class="line"></span><br><span class="line">            readyList = jQuery.Deferred();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Catch cases where $(document).ready() is called after the browser event has already occurred.</span></span><br><span class="line">            <span class="comment">// we once tried to use readyState "interactive" here, but it caused issues like the one</span></span><br><span class="line">            <span class="comment">// discovered by ChrisS here: http://bugs.jquery.com/ticket/12282#comment:15</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">document</span>.readyState === <span class="string">"complete"</span>) &#123;</span><br><span class="line">                <span class="comment">// Handle it asynchronously to allow scripts the opportunity to delay ready</span></span><br><span class="line">                setTimeout(jQuery.ready);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">document</span>.addEventListener(<span class="string">"DOMContentLoaded"</span>, completed, <span class="literal">false</span>);</span><br><span class="line">                <span class="built_in">window</span>.addEventListener(<span class="string">"load"</span>, completed, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> readyList.promise(obj);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算class2type map</span></span><br><span class="line">    jQuery.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span>(<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">        class2type[<span class="string">"[object "</span> + name + <span class="string">"]"</span>] = name.toLowerCase();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isArraylike</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> length = obj.length,</span><br><span class="line">            type = jQuery.type(obj);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (jQuery.isWindow(obj)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (obj.nodeType === <span class="number">1</span> &amp;&amp; length) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> type === <span class="string">"array"</span> || type !== <span class="string">"function"</span> &amp;&amp;</span><br><span class="line">            (length === <span class="number">0</span> ||</span><br><span class="line">                <span class="keyword">typeof</span> length === <span class="string">"number"</span> &amp;&amp; length &gt; <span class="number">0</span> &amp;&amp; (length - <span class="number">1</span>) <span class="keyword">in</span> obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">window</span> === <span class="string">"object"</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">window</span>.document === <span class="string">"object"</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = jQuery;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="built_in">window</span>);</span><br></pre></td></tr></table></figure><h4 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h4><p>jquery的定位是为了简化繁琐的DOM操作，选择器是一个十分关键的模块。而jquery是采用的Sizzle引擎（一个独立全新的选择器引擎）实现的选择器功能。下面我们来看看Sizzle的设计思路：</p><blockquote><p>在需要递进式匹配时，比如$(“div a”) 这样的匹配时，执行的操纵都是先匹配页面中div然后再匹配它的节点下的a标签，之后返回结果。我们知道CSS的匹配规则是从右边向左筛选，jQuery在Sizzle中延续了这样的算法，先搜寻页面中所有的a标签，在之后的操纵中再往后判定它的父节点（包括父节点以上）是否为div，一层一层往上过滤，最后返回该操纵序列。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Sizzle =</span><br><span class="line">    (<span class="function"><span class="keyword">function</span>(<span class="params">window</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        Sizzle.matches = <span class="function"><span class="keyword">function</span>(<span class="params">expr, elements</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Sizzle(expr, <span class="literal">null</span>, <span class="literal">null</span>, elements);</span><br><span class="line">        &#125;;</span><br><span class="line">        Sizzle.matchesSelector = <span class="function"><span class="keyword">function</span>(<span class="params">elem, expr</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">            <span class="keyword">return</span> Sizzle(expr, <span class="built_in">document</span>, <span class="literal">null</span>, [elem]).length &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        Sizzle.contains = <span class="function"><span class="keyword">function</span>(<span class="params">context, elem</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="keyword">return</span> contains(context, elem);</span><br><span class="line">        &#125;;</span><br><span class="line">        Sizzle.attr = <span class="function"><span class="keyword">function</span>(<span class="params">elem, name</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//...</span></span><br><span class="line">        &#125;;</span><br><span class="line">        Sizzle.escape = <span class="function"><span class="keyword">function</span>(<span class="params">sel</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (sel + <span class="string">""</span>).replace(rcssescape, fcssescape);</span><br><span class="line">        &#125;;</span><br><span class="line">        Sizzle.error = <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Syntax error, unrecognized expression: "</span> + msg);</span><br><span class="line">        &#125;;</span><br><span class="line">        Sizzle.uniqueSort = <span class="function"><span class="keyword">function</span>(<span class="params">results</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="keyword">return</span> results;</span><br><span class="line">        &#125;;</span><br><span class="line">        getText = Sizzle.getText = <span class="function"><span class="keyword">function</span>(<span class="params">elem</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;;</span><br><span class="line">        Expr = Sizzle.selectors = &#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        tokenize = Sizzle.tokenize = <span class="function"><span class="keyword">function</span>(<span class="params">selector, parseOnly</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        compile = Sizzle.compile = <span class="function"><span class="keyword">function</span>(<span class="params">selector, match <span class="regexp">/* Internal Use Only */</span> </span>) </span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        select = Sizzle.select = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context, results, seed</span>) </span>&#123;</span><br><span class="line">                <span class="comment">//...</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">return</span> Sizzle;</span><br><span class="line">    &#125;)(<span class="built_in">window</span>);</span><br><span class="line"></span><br><span class="line">jQuery.find = Sizzle;</span><br><span class="line">jQuery.expr = Sizzle.selectors;</span><br><span class="line">jQuery.expr[<span class="string">":"</span>] = jQuery.expr.pseudos;</span><br><span class="line">jQuery.uniqueSort = jQuery.unique = Sizzle.uniqueSort;</span><br><span class="line">jQuery.text = Sizzle.getText;</span><br><span class="line">jQuery.isXMLDoc = Sizzle.isXML;</span><br><span class="line">jQuery.contains = Sizzle.contains;</span><br><span class="line">jQuery.escapeSelector = Sizzle.escape;</span><br></pre></td></tr></table></figure><h4 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h4><p>在数据请求的过程中，我们可能会遇到如下问题：</p><ol><li>跨域</li><li>json的格式</li><li>dataType</li><li>AJAX乱码问题</li><li>页面缓存</li><li>状态的跟踪</li><li>不同平台兼容</li></ol><p>jquery解决了以上这些问题，并且在此基础上做了扩展。jq实现了以下的属性和方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">readyState</span><br><span class="line">status</span><br><span class="line">statusText</span><br><span class="line">responseXML and/or responseText 当底层的请求分别作出XML和/或文本响应</span><br><span class="line">setRequestHeader(name, value) 从标准出发，通过替换旧的值为新的值，而不是替换的新值到旧值</span><br><span class="line">getAllResponseHeaders()</span><br><span class="line">getResponseHeader()</span><br><span class="line">abort()</span><br></pre></td></tr></table></figure><p>为了实现以上这些功能，jQuery 在对 jqXHR 做2个处理：</p><ol><li>异步队列 deferred</li><li>回调队列 Callbacks</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Deferreds</span></span><br><span class="line">deferred = jQuery.Deferred(),</span><br><span class="line"><span class="comment">//所有的回调队列，不管任何时候增加的回调保证只触发一次</span></span><br><span class="line">completeDeferred = jQuery.Callbacks(<span class="string">"once memory"</span>),</span><br></pre></td></tr></table></figure><p>jq源码中实现的ajax封装：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><br><span class="line">    active: <span class="number">0</span>,</span><br><span class="line">    lastModified: &#123;&#125;,</span><br><span class="line">    etag: &#123;&#125;,</span><br><span class="line">    ajaxSettings: &#123;</span><br><span class="line">        url: location.href,</span><br><span class="line">        type: <span class="string">"GET"</span>,</span><br><span class="line">        isLocal: rlocalProtocol.test(location.protocol),</span><br><span class="line">        global: <span class="literal">true</span>,</span><br><span class="line">        processData: <span class="literal">true</span>,</span><br><span class="line">        <span class="keyword">async</span>: <span class="literal">true</span>,</span><br><span class="line">        contentType: <span class="string">"application/x-www-form-urlencoded; charset=UTF-8"</span>,</span><br><span class="line">        accepts: &#123;</span><br><span class="line">            <span class="string">"*"</span>: allTypes,</span><br><span class="line">            text: <span class="string">"text/plain"</span>,</span><br><span class="line">            html: <span class="string">"text/html"</span>,</span><br><span class="line">            xml: <span class="string">"application/xml, text/xml"</span>,</span><br><span class="line">            json: <span class="string">"application/json, text/javascript"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        contents: &#123;</span><br><span class="line">            xml: <span class="regexp">/\bxml\b/</span>,</span><br><span class="line">            html: <span class="regexp">/\bhtml/</span>,</span><br><span class="line">            json: <span class="regexp">/\bjson\b/</span></span><br><span class="line">        &#125;,</span><br><span class="line">        responseFields: &#123;</span><br><span class="line">            xml: <span class="string">"responseXML"</span>,</span><br><span class="line">            text: <span class="string">"responseText"</span>,</span><br><span class="line">            json: <span class="string">"responseJSON"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        converters: &#123;</span><br><span class="line">            <span class="string">"* text"</span>: <span class="built_in">String</span>,</span><br><span class="line">            <span class="string">"text html"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"text json"</span>: <span class="built_in">JSON</span>.parse,</span><br><span class="line">            <span class="string">"text xml"</span>: jQuery.parseXML</span><br><span class="line">        &#125;,</span><br><span class="line">        flatOptions: &#123;</span><br><span class="line">            url: <span class="literal">true</span>,</span><br><span class="line">            context: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    ajaxSetup: <span class="function"><span class="keyword">function</span>(<span class="params">target, settings</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> settings ?</span><br><span class="line">            ajaxExtend(ajaxExtend(target, jQuery.ajaxSettings), settings) :</span><br><span class="line">            ajaxExtend(jQuery.ajaxSettings, target);</span><br><span class="line">    &#125;,</span><br><span class="line">    ajaxPrefilter: addToPrefiltersOrTransports(prefilters),</span><br><span class="line">    ajaxTransport: addToPrefiltersOrTransports(transports),</span><br><span class="line">    ajax: <span class="function"><span class="keyword">function</span>(<span class="params">url, options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> url === <span class="string">"object"</span>) &#123;</span><br><span class="line">            options = url;</span><br><span class="line">            url = <span class="literal">undefined</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        options = options || &#123;&#125;;</span><br><span class="line">        <span class="keyword">var</span> transport,</span><br><span class="line">            cacheURL,</span><br><span class="line">            responseHeadersString,</span><br><span class="line">            responseHeaders,</span><br><span class="line">            timeoutTimer,</span><br><span class="line">            urlAnchor,</span><br><span class="line">            completed,</span><br><span class="line">            fireGlobals,</span><br><span class="line">            i,</span><br><span class="line">            uncached,</span><br><span class="line">            s = jQuery.ajaxSetup(&#123;&#125;, options),</span><br><span class="line">            callbackContext = s.context || s,</span><br><span class="line">            globalEventContext = s.context &amp;&amp;</span><br><span class="line">            (callbackContext.nodeType || callbackContext.jquery) ?</span><br><span class="line">            jQuery(callbackContext) :</span><br><span class="line">            jQuery.event,</span><br><span class="line">            deferred = jQuery.Deferred(),</span><br><span class="line">            completeDeferred = jQuery.Callbacks(<span class="string">"once memory"</span>),</span><br><span class="line">            statusCode = s.statusCode || &#123;&#125;,</span><br><span class="line">            requestHeaders = &#123;&#125;,</span><br><span class="line">            requestHeadersNames = &#123;&#125;,</span><br><span class="line">            strAbort = <span class="string">"canceled"</span>,</span><br><span class="line">            jqXHR = &#123;</span><br><span class="line">                readyState: <span class="number">0</span>,</span><br><span class="line">                getResponseHeader: <span class="function"><span class="keyword">function</span>(<span class="params">key</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> match;</span><br><span class="line">                    <span class="keyword">if</span> (completed) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (!responseHeaders) &#123;</span><br><span class="line">                            responseHeaders = &#123;&#125;;</span><br><span class="line">                            <span class="keyword">while</span> ((match = rheaders.exec(responseHeadersString))) &#123;</span><br><span class="line">                                responseHeaders[match[<span class="number">1</span>].toLowerCase() + <span class="string">" "</span>] =</span><br><span class="line">                                    (responseHeaders[match[<span class="number">1</span>].toLowerCase() + <span class="string">" "</span>] || [])</span><br><span class="line">                                    .concat(match[<span class="number">2</span>]);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        match = responseHeaders[key.toLowerCase() + <span class="string">" "</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> match == <span class="literal">null</span> ? <span class="literal">null</span> : match.join(<span class="string">", "</span>);</span><br><span class="line">                &#125;,</span><br><span class="line">                getAllResponseHeaders: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> completed ? responseHeadersString : <span class="literal">null</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                setRequestHeader: <span class="function"><span class="keyword">function</span>(<span class="params">name, value</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (completed == <span class="literal">null</span>) &#123;</span><br><span class="line">                        name = requestHeadersNames[name.toLowerCase()] =</span><br><span class="line">                            requestHeadersNames[name.toLowerCase()] || name;</span><br><span class="line">                        requestHeaders[name] = value;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                overrideMimeType: <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (completed == <span class="literal">null</span>) &#123;</span><br><span class="line">                        s.mimeType = type;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                statusCode: <span class="function"><span class="keyword">function</span>(<span class="params">map</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> code;</span><br><span class="line">                    <span class="keyword">if</span> (map) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (completed) &#123;</span><br><span class="line">                            jqXHR.always(map[jqXHR.status]);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">for</span> (code <span class="keyword">in</span> map) &#123;</span><br><span class="line">                                statusCode[code] = [statusCode[code], map[code]];</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                abort: <span class="function"><span class="keyword">function</span>(<span class="params">statusText</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> finalText = statusText || strAbort;</span><br><span class="line">                    <span class="keyword">if</span> (transport) &#123;</span><br><span class="line">                        transport.abort(finalText);</span><br><span class="line">                    &#125;</span><br><span class="line">                    done(<span class="number">0</span>, finalText);</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h4 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h4><p>jQuery 中有一个 Queue 队列的接口，是内部专门为动画服务的。<code>$(&quot;#card&quot;).slideUp().fadeIn()</code>是定义的一组动画链式序列，当 slideUp 运行时，fadeIn 被放到 fx 队列中，当 slideUp 完成后，从队列中被取出运行。jquery提供了队列操作的API，来看看代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">jQuery.extend(&#123;</span><br><span class="line">       queue: <span class="function"><span class="keyword">function</span>(<span class="params">elem, type, data</span>) </span>&#123;</span><br><span class="line">           <span class="keyword">var</span> queue;</span><br><span class="line">           <span class="keyword">if</span> (elem) &#123;</span><br><span class="line">               type = (type || <span class="string">"fx"</span>) + <span class="string">"queue"</span>;</span><br><span class="line">               queue = dataPriv.get(elem, type);</span><br><span class="line">               <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                   <span class="keyword">if</span> (!queue || <span class="built_in">Array</span>.isArray(data)) &#123;</span><br><span class="line">                       queue = dataPriv.access(elem, type, jQuery.makeArray(data));</span><br><span class="line">                   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                       queue.push(data);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">return</span> queue || [];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       dequeue: <span class="function"><span class="keyword">function</span>(<span class="params">elem, type</span>) </span>&#123;</span><br><span class="line">           type = type || <span class="string">"fx"</span>;</span><br><span class="line">           <span class="keyword">var</span> queue = jQuery.queue(elem, type),</span><br><span class="line">               startLength = queue.length,</span><br><span class="line">               fn = queue.shift(),</span><br><span class="line">               hooks = jQuery._queueHooks(elem, type),</span><br><span class="line">               next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                   jQuery.dequeue(elem, type);</span><br><span class="line">               &#125;;</span><br><span class="line">           <span class="keyword">if</span> (fn === <span class="string">"inprogress"</span>) &#123;</span><br><span class="line">               fn = queue.shift();</span><br><span class="line">               startLength--;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (fn) &#123;</span><br><span class="line">               <span class="keyword">if</span> (type === <span class="string">"fx"</span>) &#123;</span><br><span class="line">                   queue.unshift(<span class="string">"inprogress"</span>);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">delete</span> hooks.stop;</span><br><span class="line">               fn.call(elem, next, hooks);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (!startLength &amp;&amp; hooks) &#123;</span><br><span class="line">               hooks.empty.fire();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       <span class="comment">// dequeue不仅是取出来还需要执行，在执行的时候把next与hooks传递给外部的回调，在内部可以传递一个引用出去，又能提供外部调用或者执行。</span></span><br><span class="line">       _queueHooks: <span class="function"><span class="keyword">function</span>(<span class="params">elem, type</span>) </span>&#123;</span><br><span class="line">           <span class="keyword">var</span> key = type + <span class="string">"queueHooks"</span>;</span><br><span class="line">           <span class="keyword">return</span> dataPriv.get(elem, key) || dataPriv.access(elem, key, &#123;</span><br><span class="line">               empty: jQuery.Callbacks(<span class="string">"once memory"</span>).add(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                   dataPriv.remove(elem, [type + <span class="string">"queue"</span>, key]);</span><br><span class="line">               &#125;)</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   jQuery.fn.extend(&#123;</span><br><span class="line">       queue: <span class="function"><span class="keyword">function</span>(<span class="params">type, data</span>) </span>&#123;</span><br><span class="line">           <span class="keyword">var</span> setter = <span class="number">2</span>;</span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">typeof</span> type !== <span class="string">"string"</span>) &#123;</span><br><span class="line">               data = type;</span><br><span class="line">               type = <span class="string">"fx"</span>;</span><br><span class="line">               setter--;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (<span class="built_in">arguments</span>.length &lt; setter) &#123;</span><br><span class="line">               <span class="keyword">return</span> jQuery.queue(<span class="keyword">this</span>[<span class="number">0</span>], type);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span> data === <span class="literal">undefined</span> ?</span><br><span class="line">               <span class="keyword">this</span> :</span><br><span class="line">               <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                   <span class="keyword">var</span> queue = jQuery.queue(<span class="keyword">this</span>, type, data);</span><br><span class="line">                   jQuery._queueHooks(<span class="keyword">this</span>, type);</span><br><span class="line">                   <span class="keyword">if</span> (type === <span class="string">"fx"</span> &amp;&amp; queue[<span class="number">0</span>] !== <span class="string">"inprogress"</span>) &#123;</span><br><span class="line">                       jQuery.dequeue(<span class="keyword">this</span>, type);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">       &#125;,</span><br><span class="line">       dequeue: <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">this</span>.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">               jQuery.dequeue(<span class="keyword">this</span>, type);</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125;,</span><br><span class="line">       clearQueue: <span class="function"><span class="keyword">function</span>(<span class="params">type</span>) </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">this</span>.queue(type || <span class="string">"fx"</span>, []);</span><br><span class="line">       &#125;,</span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure><p>举个栗子：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">book.animate(&#123;</span><br><span class="line">    left: <span class="string">'+=50'</span>,</span><br><span class="line">&#125;).animate(&#123;</span><br><span class="line">    left: <span class="string">'+=100'</span>,</span><br><span class="line">&#125;).animate(&#123;</span><br><span class="line">    left: <span class="string">'-=50'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>jquery是如何处理这一组动画的？</strong></p><ol><li>设置一个队列，在执行第一个 animate 方法的时候加入队列就开始执行动画，因为动画自己在执行的时候就会产生异步的时间差</li><li>在这个时间差里继续去加入之后的动画 animate 进去队列，然后在每一个动画结束之后去取出队列中的第一个 animate 方法开始执行，依次循环下去</li></ol><p>jquery是通过 queue 调度动画的之间的衔接，Animation 方法执行单个动画的封装。</p><p><strong>动画的设计可以考虑以下几点：</strong></p><ol><li>参数的多形式传递</li><li>基于 promise 的事件反馈</li><li>增加属性的 show/hide/toggle 的快捷方式</li><li>可以给 css 属性设置独立的缓动函数</li></ol><p><strong>如何实现动画效果呢？我们应该考虑：</strong></p><ul><li>起点位置</li><li>终点位置</li><li>运动的时间</li><li>每次定时器改变的坐标值</li><li>单位的换算(px、em、%)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Tween</span>(<span class="params">value, prop, animation</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.elem    = animation.elem;</span><br><span class="line">	<span class="keyword">this</span>.prop    = prop;</span><br><span class="line">	<span class="keyword">this</span>.easing  = <span class="string">"swing"</span>; <span class="comment">//动画缓动算法</span></span><br><span class="line">	<span class="keyword">this</span>.options = animation.options;</span><br><span class="line">	<span class="comment">//获取初始值</span></span><br><span class="line">	<span class="keyword">this</span>.start   = <span class="keyword">this</span>.now = <span class="keyword">this</span>.get();</span><br><span class="line">	<span class="comment">//动画最终值</span></span><br><span class="line">	<span class="keyword">this</span>.end     = value;</span><br><span class="line">	<span class="comment">//单位</span></span><br><span class="line">	<span class="keyword">this</span>.unit    = <span class="string">"px"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStyles</span>(<span class="params">elem</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> elem.ownerDocument.defaultView.getComputedStyle(elem, <span class="literal">null</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">swing</span>(<span class="params">p</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0.5</span> - <span class="built_in">Math</span>.cos(p * <span class="built_in">Math</span>.PI) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Tween.prototype = &#123;</span><br><span class="line">	<span class="comment">//获取元素的当前属性</span></span><br><span class="line">	<span class="keyword">get</span>: function() &#123;</span><br><span class="line">		<span class="keyword">var</span> computed = getStyles(<span class="keyword">this</span>.elem);</span><br><span class="line">		<span class="keyword">var</span> ret = computed.getPropertyValue(<span class="keyword">this</span>.prop) || computed[<span class="keyword">this</span>.prop];</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parseFloat</span>(ret);</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//运行动画</span></span><br><span class="line">	run:<span class="function"><span class="keyword">function</span>(<span class="params">percent</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> eased</span><br><span class="line">		<span class="comment">//根据缓动算法改变percent</span></span><br><span class="line">		<span class="keyword">this</span>.pos = eased = swing(percent);</span><br><span class="line">		<span class="comment">//获取具体的改变坐标值</span></span><br><span class="line">		<span class="keyword">this</span>.now = (<span class="keyword">this</span>.end - <span class="keyword">this</span>.start) * eased + <span class="keyword">this</span>.start;</span><br><span class="line">		<span class="comment">//最终改变坐标</span></span><br><span class="line">		<span class="keyword">this</span>.elem.style[<span class="keyword">this</span>.prop] = <span class="keyword">this</span>.now + <span class="string">"px"</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animation</span>(<span class="params">elem, properties, options</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//动画对象</span></span><br><span class="line">	<span class="keyword">var</span> animation = &#123;</span><br><span class="line">		elem            : elem,</span><br><span class="line">		props           : properties,</span><br><span class="line">		originalOptions : options,</span><br><span class="line">		options         : options,</span><br><span class="line">		startTime       : Animation.fxNow || createFxNow(),<span class="comment">//动画开始时间</span></span><br><span class="line">		tweens          : [] <span class="comment">//存放每个属性的缓动对象，用于动画</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//生成属性对应的动画算法对象</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> properties) &#123;</span><br><span class="line">		<span class="comment">// tweens保存每一个属性对应的缓动控制对象</span></span><br><span class="line">		animation.tweens.push( <span class="keyword">new</span> Tween(properties[k], k, animation) )</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//动画状态</span></span><br><span class="line">	<span class="keyword">var</span> stopped;</span><br><span class="line">	<span class="comment">//动画的定时器调用包装器</span></span><br><span class="line">	<span class="keyword">var</span> tick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (stopped) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//动画时间算法</span></span><br><span class="line">		<span class="keyword">var</span> currentTime = Animation.fxNow || createFxNow</span><br><span class="line">			<span class="comment">//运动时间递减</span></span><br><span class="line">			remaining = <span class="built_in">Math</span>.max(<span class="number">0</span>, animation.startTime + animation.options.duration - currentTime),</span><br><span class="line">			temp = remaining / animation.options.duration || <span class="number">0</span>,</span><br><span class="line">			percent = <span class="number">1</span> - temp;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> index = <span class="number">0</span>,</span><br><span class="line">			length = animation.tweens.length;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//执行动画改变</span></span><br><span class="line">		<span class="keyword">for</span> (; index &lt; length; index++) &#123;</span><br><span class="line">			<span class="comment">//percent改变值</span></span><br><span class="line">			animation.tweens[index].run(percent);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//是否继续，还是停止</span></span><br><span class="line">		<span class="keyword">if</span> (percent &lt;= <span class="number">1</span> &amp;&amp; length) &#123;</span><br><span class="line">			<span class="keyword">return</span> remaining;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//停止</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	tick.elem = elem;</span><br><span class="line">	tick.anim = animation</span><br><span class="line"></span><br><span class="line">	Animation.fx.timer(tick)</span><br><span class="line">&#125;	</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建开始时间</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFxNow</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		Animation.fxNow = <span class="literal">undefined</span>;</span><br><span class="line">	&#125;);</span><br><span class="line">	<span class="keyword">return</span> (Animation.fxNow = <span class="built_in">Date</span>.now());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//用于定时器调用</span></span><br><span class="line">Animation.timers =[]</span><br><span class="line"></span><br><span class="line">Animation.fx = &#123;</span><br><span class="line">	<span class="comment">//开始动画队列</span></span><br><span class="line">	timer: <span class="function"><span class="keyword">function</span>(<span class="params">timer</span>) </span>&#123;</span><br><span class="line">		Animation.timers.push(timer);</span><br><span class="line">		<span class="keyword">if</span> (timer()) &#123;</span><br><span class="line">			<span class="comment">//开始执行动画</span></span><br><span class="line">			Animation.fx.start();</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			Animation.timers.pop();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//开始循环</span></span><br><span class="line">	start: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!Animation.timerId) &#123;</span><br><span class="line">			Animation.timerId = setInterval(Animation.fx.tick, <span class="number">13</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//停止循环</span></span><br><span class="line">	stop:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		clearInterval(Animation.timerId);</span><br><span class="line">		Animation.timerId = <span class="literal">null</span>;</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">//循环的的检测</span></span><br><span class="line">	tick: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">var</span> timer,</span><br><span class="line">			i = <span class="number">0</span>,</span><br><span class="line">			timers = Animation.timers;</span><br><span class="line"></span><br><span class="line">		Animation.fxNow = <span class="built_in">Date</span>.now();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> (; i &lt; timers.length; i++) &#123;</span><br><span class="line">			timer = timers[i];</span><br><span class="line">			<span class="keyword">if</span> (!timer() &amp;&amp; timers[i] === timer) &#123;</span><br><span class="line">				<span class="comment">//如果完成了就删除这个动画</span></span><br><span class="line">				timers.splice(i--, <span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!timers.length) &#123;</span><br><span class="line">			Animation.fx.stop();</span><br><span class="line">		&#125;</span><br><span class="line">		Animation.fxNow = <span class="literal">undefined</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><div class="post-share"><a href="javascript:;" id="share-sub" class="post-share-fab"><i class="fa fa-share-alt"></i></a><div class="post-share-list" id="share-list"><ul class="share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://localhost:4000/2020/06/29/jquery源码解读/&title=《jquery源码解读》 — blog&pic=/images/banner.jpg" data-title="微博"><i class="fa fa-weibo"></i></a></li><li><a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信"><i class="fa fa-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://localhost:4000/2020/06/29/jquery源码解读/&title=《jquery源码解读》 — blog&source=一个专注前端智能化开发技术的网站" data-title="QQ"><i class="fa fa-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2020/06/29/jquery源码解读/" data-title="Facebook"><i class="fa fa-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《jquery源码解读》 — blog&url=http://localhost:4000/2020/06/29/jquery源码解读/&via=http://localhost:4000" data-title="Twitter"><i class="fa fa-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://localhost:4000/2020/06/29/jquery源码解读/" data-title="Google+"><i class="fa fa-google-plus"></i></a></li></ul></div></div><div class="post-modal wx-share" id="wxShare"><a class="close" href="javascript:;" id="wxShare-close">×</a><p>扫一扫，分享到微信</p><img src="//api.qrserver.com/v1/create-qr-code/?data=http://localhost:4000/2020/06/29/jquery源码解读/" alt="微信分享二维码"></div><div class="mask"></div><ul class="article-footer-menu"></ul></footer></div></article><aside class="post-toc-pos post-toc-top" id="post-toc"><nav class="post-toc-wrap"><ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#关于如何读源码"><span class="post-toc-text">关于如何读源码</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#jquery架构设计"><span class="post-toc-text">jquery架构设计</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#问题解答"><span class="post-toc-text">问题解答</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#模块解读"><span class="post-toc-text">模块解读</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#定义一系列变量和函数"><span class="post-toc-text">定义一系列变量和函数</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#给jQuery对象添加一些方法和属性"><span class="post-toc-text">给jQuery对象添加一些方法和属性</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-extend继承方法实现"><span class="post-toc-text">3. extend继承方法实现</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4-工具方法汇总"><span class="post-toc-text">4. 工具方法汇总</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#选择器"><span class="post-toc-text">选择器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#AJAX"><span class="post-toc-text">AJAX</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#动画"><span class="post-toc-text">动画</span></a></li></ol></li></ol></nav></aside><nav id="article-nav"><a href="/2020/07/03/前端智能化方向思考与解读/" id="article-nav-newer" class="article-nav-link-wrap"><span class="article-nav-title"><i class="fa fa-hand-o-left" aria-hidden="true"></i> 前端智能化方向思考与解读 </span></a><a href="/2020/06/15/git基础与进阶/" id="article-nav-older" class="article-nav-link-wrap"><span class="article-nav-title">git基础与进阶</span> <i class="fa fa-hand-o-right" aria-hidden="true"></i></a></nav><div id="lv-container" data-id="city" data-uid="MTAyMC81MDE5Mi8yNjY4Mg=="><script type="text/javascript">!function(e,t){var n,c=e.getElementsByTagName(t)[0];"function"!=typeof LivereTower&&((n=e.createElement(t)).src="https://cdn-city.livere.com/js/embed.dist.js",n.async=!0,c.parentNode.insertBefore(n,c))}(document,"script")</script><noscript>为正常使用来必力评论功能请激活JavaScript</noscript></div></section></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner"><p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a> &copy; 2020 Yang Pei<br></p></div></div></footer><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script>var mihoConfig={root:"http://localhost:4000",animate:"true",isHome:"false",share:"true"}</script><div class="sidebar"><div id="sidebar-top"><span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span></div></div><div class="sidebar-menu-box" id="sidebar-menu-box"><div class="sidebar-menu-box-container"><div id="sidebar-menu-box-categories"><a class="category-link" href="/categories/AI/">AI</a><a class="category-link" href="/categories/CV/">CV</a><a class="category-link" href="/categories/ML/">ML</a><a class="category-link" href="/categories/NLP/">NLP</a><a class="category-link" href="/categories/专题/">专题</a><a class="category-link" href="/categories/前端/">前端</a><a class="category-link" href="/categories/感想/">感想</a><a class="category-link" href="/categories/源码/">源码</a><a class="category-link" href="/categories/计算机/">计算机</a><a class="category-link" href="/categories/语言/">语言</a></div><div id="sidebar-menu-box-tags"></div></div><a href="javascript:;" class="sidebar-menu-box-close">&times;</a></div>ß<div class="mobile-header-menu-nav" id="mobile-header-menu-nav"><div class="mobile-header-menu-container"><span class="title">Menus</span><ul class="mobile-header-menu-navbar"><li><a href="/"><i class="fa fa-home"></i><span>主页</span></a></li><li><a href="/categories/前端/"><i class="fa fa-前端"></i><span>前端</span></a></li><li><a href="/categories/源码/"><i class="fa fa-源码"></i><span>源码</span></a></li><li><a href="/categories/ML/"><i class="fa fa-ML"></i><span>ML</span></a></li><li><a href="/categories/CV/"><i class="fa fa-CV"></i><span>CV</span></a></li><li><a href="/categories/NLP/"><i class="fa fa-NLP"></i><span>NLP</span></a></li><li><a href="/categories/计算机/"><i class="fa fa-计算机"></i><span>计算机</span></a></li><li><a href="/categories/专题/"><i class="fa fa-专题"></i><span>专题</span></a></li><li><a href="/categories/感想/"><i class="fa fa-感想"></i><span>感想</span></a></li><li><a href="/categories/语言/"><i class="fa fa-语言"></i><span>语言</span></a></li></ul></div><div class="mobile-header-tag-container"><span class="title">Tags</span><div id="mobile-header-container-tags"></div></div></div><div class="search-wrap"><span class="search-close">&times;</span> <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i> </a><input class="search-field" placeholder="Search..." id="keywords"> <a id="search-submit" href="javascript:;"><i class="fa fa-search"></i></a><div class="search-container" id="search-container"><ul class="search-result" id="search-result"></ul></div></div><div id="search-tpl"><li class="search-result-item"><a href="{url}" class="search-item-li"><span class="search-item-li-title" title="{title}">{title}</span></a></li></div><script src="/js/search.js"></script><script src="/js/main.js"></script><script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script><div id="particles"></div><script src="/js/particles.js"></script><link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css"><script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script><script src="/js/animate.js"></script><script src="/js/pop-img.js"></script><script>$(".article-entry p img").popImg()</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>